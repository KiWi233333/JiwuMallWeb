import{gn as S,u as k,go as O,h as H}from"./entry.t-rqPOs0.js";import{E as D}from"./notification.YJSnxgg5.js";import{a as o}from"./swiper-vue.Dj7aAS3P.js";var A=(e=>(e[e.CHECK_TOKEN=1]="CHECK_TOKEN",e[e.HEARTBEAT=2]="HEARTBEAT",e))(A||{}),l=(e=>(e[e.OPEN=1]="OPEN",e[e.SAFE_CLOSE=2]="SAFE_CLOSE",e[e.CLOSE=3]="CLOSE",e))(l||{}),t=(e=>(e[e.MESSAGE=1]="MESSAGE",e[e.ONLINE_OFFLINE_NOTIFY=2]="ONLINE_OFFLINE_NOTIFY",e[e.RECALL=3]="RECALL",e[e.APPLY=4]="APPLY",e[e.MEMBER_CHANGE=5]="MEMBER_CHANGE",e[e.TOKEN_EXPIRED_ERR=6]="TOKEN_EXPIRED_ERR",e[e.DELETE=8]="DELETE",e))(t||{}),w=(e=>(e[e.JOIN=1]="JOIN",e[e.LEAVE=2]="LEAVE",e[e.DEL=3]="DEL",e))(w||{});const G=S("chat_websocket",()=>{const e=o(null),i=o(""),_=o(!1),E=o(l.CLOSE),c=o({newMsg:[],onlineNotice:[],recallMsg:[],deleteMsg:[],applyMsg:[],memberMsg:[],tokenMsg:[],other:[]});function C(n){var r;const a=k();if(!a.getToken)return(r=e.value)==null||r.close(),E.value=l.SAFE_CLOSE,!1;f(O,a.getToken),s(n),v(),R()}function f(n=O,a=""){return e.value&&E.value===l.OPEN||(i.value=`${n}?Authorization=${a}`,e.value=new WebSocket(i.value),E.value=l.OPEN),e.value}function s(n){e.value&&(e.value.onopen=n)}function v(){e.value&&e.value.addEventListener("error",n=>{E.value=l.CLOSE,e.value=null})}function R(){e.value&&e.value.addEventListener("close",n=>{E.value=l.SAFE_CLOSE,e.value=null})}const L={[t.MESSAGE]:"newMsg",[t.ONLINE_OFFLINE_NOTIFY]:"onlineNotice",[t.RECALL]:"recallMsg",[t.DELETE]:"deleteMsg",[t.APPLY]:"applyMsg",[t.MEMBER_CHANGE]:"memberMsg",[t.TOKEN_EXPIRED_ERR]:"tokenMsg"};function F(n){e.value&&e.value.addEventListener("message",a=>{if(a&&!a.data)return!1;try{const r=JSON.parse(a.data);if(r){const u=r.data,d=u.data;L[u.type]!==void 0&&c.value[L[u.type]].push(d),n(u)}}catch{return null}})}function I(){e.value&&H.confirm("是否断开会话？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"el-button--danger shadow border-default ",lockScroll:!1,center:!0,callback:async n=>{if(n==="confirm"){if(!e.value)return;e.value.close(),E.value=l.SAFE_CLOSE,D.success("断开成功！")}}})}function P(){N({type:A.HEARTBEAT,data:null})}function N(n){var a,r;(a=e.value)!=null&&a.OPEN&&((r=e.value)==null||r.send(JSON.stringify(n)))}return{webSocketHandler:e,status:E,isWindBlur:_,wsMsgList:c,onerror:v,initDefault:C,link:f,open:s,send:N,close:I,sendHeart:P,onMessage:F}},{persist:!1});export{w as W,l as a,t as b,G as u};
