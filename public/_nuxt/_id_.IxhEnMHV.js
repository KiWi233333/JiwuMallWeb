import{_ as ie}from"./Switch.CiJ5_qW7.js";import{u as se,w as H,E as x,S as B,g as J,ab as ce,a8 as de,ac as ue,f as ae,B as me,b as pe,ad as G,c as fe,v as _e,a9 as ve,n as K,ae as ge,h as he,_ as ye,e as be,a as we,z as ke,y as Q}from"./entry.HuYbGiLS.js";import{E as xe}from"./progress.UYU20Rtn.js";import{E as Ie}from"./upload.0ACO-yOs.js";import{E as Ee}from"./dialog.jW0LsHVx.js";import{j as A,a as m,L as I,M as S,Z as l,a0 as g,N as t,aa as L,a9 as O,u as s,a5 as Se,x as $e,aB as Ce,am as le,an as ne,a3 as W,r as Te,b as Ve,k as De,a4 as F,_ as Be,ar as Re}from"./swiper-vue.4ZhlhtKr.js";import{g as X,O as Y,b as ee,d as oe}from"./index.Rr0j-bh8.js";import{_ as Ue}from"./ElImage.H3VTC2Vd.js";import{E as Fe}from"./rate.YTGIEK9x.js";import{E as Oe}from"./checkbox.yoNbs0Nb.js";import{_ as ze}from"./nuxt-link.eZ5kOSgI.js";import{ElText as Me}from"./index.2AyaIaz8.js";import{E as te}from"./notification.mMgfY760.js";import{a as Ne}from"./fetch.3IR0ILJ_.js";import{g as Le,O as Ae,t as Pe}from"./index.xV7eTSBk.js";import"./useToggleThemeAnima.rqlolBiN.js";import"./category.sBcSORba.js";import"./composables.QNi8Zuou.js";import"./cloneDeep.3YksgvLn.js";import"./isEqual.gU3elsgQ.js";import"./isUndefined.IZwZ21d-.js";import"./PreLoading.vue.RcEKquDI.js";import"./debounce.4-I_Xkye.js";import"./hasIn.gQarB0Dl.js";import"./flatten.lVx7POvc.js";const Z=w=>(le("data-v-ee64029b"),w=w(),ne(),w),je={class:"upload-group flex"},Ge=Z(()=>t("i",{"i-solar:camera-linear":"","p-1rem":"","opacity-70":""},null,-1)),Je={class:"group relative h-6rem w-6rem cursor-pointer"},Ze=["src"],qe={class:"absolute left-0 top-0 h-full w-full flex-row-c-c bg-dark-100 opacity-0 transition-300 group-hover:opacity-80"},He={class:"absolute top-0 z-1 h-full w-full flex-row-c-c bg-light dark:bg-dark-1"},Ke=Z(()=>t("small",{class:"absolute top-0 z-10 text-[var(--el-color-danger)]"},"上传失败",-1)),Qe=Z(()=>t("i",{"i-solar:video-library-line-duotone":"","p-1rem":"","opacity-70":""},null,-1)),We={class:"group relative"},Xe=["src"],Ye={class:"absolute left-0 top-0 h-full w-full flex-row-c-c bg-dark-100 opacity-0 transition-300 group-hover:opacity-80"},eo=["src"],oo=["src"],to=A({__name:"Upload",props:{isDisable:{type:Boolean}},setup(w,{expose:E}){const o=se(),p=m([]),c=m([]),_=m(""),d=m(""),h=m(!1),a=m(!0),k=m();function R(e){return e.url}function $(e){_.value=e.url,h.value=!0,a.value=!0}function D(e){d.value=e.url||"",h.value=!0,a.value=!1}m({url:"",key:"",uploadToken:"",endDateTime:-1});function u(e,n,y){return e.size&&e.size/1024/1024>n?(x.error(`${y||"文件"}大小需小于${n}MB!`),!1):!0}async function f(e,n){if(!u(e,3,"图片"))return;if(p.value.findIndex(r=>r.uid===e.uid)===-1){const{data:r,code:T}=await X(Y.IMAGE,o.getToken);if(T===B.SUCCESS){e.key=r.key,p.value.push(e);const v=p.value.length-1;ee(e.raw,r.key,r.uploadToken,{next(V){p.value[v].status="uploading",p.value[v].percentage=Number.parseFloat(V.total.percent.toFixed(2)),V.total.percent===100&&(p.value[v].status="success")},error(){p.value[v].status="fail"},complete(){p.value[v].status="success"}})}else x.error("获取上传操作频繁，请5分钟后再试")}else n.splice(n.length-1,1),x.warning("文件已存在！")}async function i(e,n){if(!u(e,6,"视频"))return;if(c.value.findIndex(r=>r.name===e.name)===-1){const{data:r,code:T}=await X(Y.VIDEO,o.getToken);if(T===B.SUCCESS){e.key=r.key,c.value.push(e);const v=c.value.length-1;ee(e.raw,r.key,r.uploadToken,{next(V){c.value[v].status="uploading",c.value[v].percentage=Number.parseFloat(V.total.percent.toFixed(2)),V.total.percent===100&&(c.value[v].status="success")},error(){c.value[v].status="fail"},complete(){c.value[v].status="success"}})}else x.error("获取上传操作频繁，请5分钟后再试")}else n.splice(n.length-1,1),x.warning("文件已存在！")}const C=m();async function P(e){const n=p.value.findIndex(r=>r.uid===e.uid);if(n===-1)return;const y=p.value[n];J.confirm("确定删除该图片?","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",lockScroll:!1}).then(async()=>{const{code:r}=await oe(y.key,o.getToken);C.value.handleRemove(e),r===B.SUCCESS&&x.success("删除成功！")}).catch(()=>{})}const z=m();function U(e){J.confirm("确定删除该视频?","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",lockScroll:!1,type:"warning"}).then(async()=>{const{code:n}=await oe(e.key,o.getToken);c.value.splice(0),z.value.handleRemove(e),n===B.SUCCESS&&x.success("删除成功！")}).catch(()=>{})}const M=m([]),N=m("");return H(c,e=>{e.length&&(N.value=e[0].key)},{deep:!0}),H(p,e=>{if(e.length){const n=e.map(y=>y.key?y.key:!1);M.value=n}},{deep:!0}),E({images:M,video:N}),(e,n)=>{const y=ce,r=de,T=xe,v=Ie,V=ue,re=Ee;return I(),S("div",je,[l(v,{ref_key:"imageRef",ref:C,"file-list":s(p),multiple:"",accept:"image/*",limit:3,draggable:"","list-type":"picture-card",disabled:e.isDisable,"auto-upload":!1,onPreview:$,onExceed:n[0]||(n[0]=()=>("ElMessage"in e?e.ElMessage:s(x)).warning("只能上传3张图片！")),onChange:f},{file:g(({file:b})=>[t("div",Je,[t("img",{class:"h-full w-full",style:{"object-fit":"cover"},src:b.url,alt:"预览",loading:"lazy",fit:"cover"},null,8,Ze),O(t("div",qe,[l(y,{class:"h-1.2rem w-1.2rem cursor-pointer text-[#fff] hover:text-[var(--el-color-primary)]",onClick:j=>$(b)},null,8,["onClick"]),l(r,{class:"absolute right-2 top-2 h-1rem w-1rem cursor-pointer text-[#fff] hover:text-[var(--el-color-danger)]",onClick:j=>P(b)},null,8,["onClick"])],512),[[L,b.status==="success"]]),O(t("div",He,[l(T,{width:60,indeterminate:"",type:"circle",percentage:b.percentage,status:b.status==="success"?"success":""},null,8,["percentage","status"])],512),[[L,b.status==="uploading"]]),Ke])]),default:g(()=>[Ge]),_:1},8,["file-list","disabled"]),l(v,{ref_key:"videoInputRef",ref:z,class:"upload-video ml-3","file-list":s(c),accept:"video/*",limit:1,"list-type":"picture-card",disabled:e.isDisable,"auto-upload":!1,onPreview:$,onExceed:n[1]||(n[1]=()=>("ElMessage"in e?e.ElMessage:s(x)).warning("只能上传一个视频！")),onChange:i},{default:g(()=>[Qe]),file:g(({file:b})=>[t("div",We,[t("video",{src:R(b),"h-full":"","w-full":""},null,8,Xe),t("div",Ye,[l(V,{class:"h-1.6rem w-1.6rem cursor-pointer text-[#fff] hover:text-[var(--el-color-primary)]",onClick:j=>D(b)},null,8,["onClick"]),l(r,{class:"absolute right-2 top-2 h-1rem w-1rem cursor-pointer text-[#fff] hover:text-[var(--el-color-danger)]",onClick:j=>U(b)},null,8,["onClick"])])])]),_:1},8,["file-list","disabled"]),(I(),Se(Ce,{to:"body"},[l(re,{modelValue:s(h),"onUpdate:modelValue":n[2]||(n[2]=b=>$e(h)?h.value=b:null)},{default:g(()=>[O(t("img",{"w-full":"",src:s(_),alt:"Kiwi2333 极物圈"},null,8,eo),[[L,s(a)]]),O(t("video",{ref_key:"videoRef",ref:k,src:s(d),preload:"auto",controls:"","h-full":"","w-full":""},null,8,oo),[[L,!s(a)]])]),_:1},8,["modelValue"])]))])}}}),so=ae(to,[["__scopeId","data-v-ee64029b"]]),ao={class:"goods flex"},lo={class:"flex flex-col justify-around px-4"},no={"opacity-60":""},ro=A({__name:"Goods",props:{orderItem:{}},setup(w){function E(o){return`${(o==null?void 0:o.size)||""} ${(o==null?void 0:o.color)||""} ${(o==null?void 0:o.combo)||""}`}return(o,p)=>{const c=Ue;return I(),S("div",ao,[l(c,{loading:"lazy",fit:"cover",class:"h-4rem w-4rem overflow-hidden rounded-6px border-default",src:`${("BaseUrlImg"in o?o.BaseUrlImg:s(me))+o.orderItem.goodsSku.image}?imageView2/0/w/100/h/100/format/webp/interlace/1/q/50`},null,8,["src"]),t("div",lo,[t("small",null,W(o.orderItem.goods.name),1),t("small",no,W(E(o.orderItem.goodsSku)),1)])])}}}),q=w=>(le("data-v-b427f6bc"),w=w(),ne(),w),io={class:"card"},co={class:"flex"},uo={"mt-4":"","flex-row-bt-c":""},mo={class:"flex items-center"},po=q(()=>t("small",{"opacity-80":""},"评分：",-1)),fo={class:"flex opacity-70"},_o=q(()=>t("small",null,"推 荐",-1)),vo=q(()=>t("small",null,"匿 名",-1)),go=A({__name:"CommentCard",props:{orderItem:{},isDisable:{type:Boolean},index:{}},setup(w,{expose:E}){const{orderItem:o,index:p,isDisable:c}=w,_=m({images:[],video:""}),d=pe(`jiwu_order_comment_${o.id}`,Te({orderItemId:o.id,skuId:o.skuId,content:"",rate:0,images:[],video:"",isRecommend:0,isAnonymous:0}),sessionStorage);Ve([()=>_.value.images,()=>_.value.video],a=>{a[0]&&(d.value.images=a[0]),a[1]&&(d.value.video=a[1])},{deep:!0});async function h(){_.value.images=[],_.value.video="",d.value={orderItemId:o.id,skuId:o.skuId,content:"",rate:0,images:[],video:"",isRecommend:0,isAnonymous:0}}return E({dto:d,clearData:h}),(a,k)=>{const R=fe,$=so,D=ro,u=Fe,f=Oe;return I(),S("div",io,[l(R,{modelValue:s(d).content,"onUpdate:modelValue":k[0]||(k[0]=i=>s(d).content=i),modelModifiers:{lazy:!0},class:"mb-4 rounded-10px shadow",disabled:a.isDisable,type:"textarea",rows:6,"show-word-limit":!0,"max-length":250,size:"large",placeholder:"写下你对商品的真实评价！"},null,8,["modelValue","disabled"]),t("div",co,[l($,{ref_key:"uploadFilesRef",ref:_,"is-disable":a.isDisable},null,8,["is-disable"])]),l(D,{"order-item":a.orderItem,class:"mt-4"},null,8,["order-item"]),t("div",uo,[t("div",mo,[po,l(u,{modelValue:s(d).rate,"onUpdate:modelValue":k[1]||(k[1]=i=>s(d).rate=i),modelModifiers:{lazy:!0},disabled:a.isDisable,"allow-half":"","show-text":"",colors:["var(--el-color-black-light-5)","var(--el-color-warning-light-3)","var(--el-color-warning)"],icons:["ElIconStarFilled"in a?a.ElIconStarFilled:s(G),"ElIconStarFilled"in a?a.ElIconStarFilled:s(G),"ElIconStarFilled"in a?a.ElIconStarFilled:s(G)],texts:["很差","差","还行","满意","非常满意"]},null,8,["modelValue","disabled","colors","icons"])]),t("div",fo,[l(f,{modelValue:s(d).isRecommend,"onUpdate:modelValue":k[2]||(k[2]=i=>s(d).isRecommend=i),disabled:a.isDisable},{default:g(()=>[_o]),_:1},8,["modelValue","disabled"]),l(f,{modelValue:s(d).isAnonymous,"onUpdate:modelValue":k[3]||(k[3]=i=>s(d).isAnonymous=i),disabled:a.isDisable},{default:g(()=>[vo]),_:1},8,["modelValue","disabled"])])])])}}}),ho=ae(go,[["__scopeId","data-v-b427f6bc"]]),yo=""+globalThis.__publicAssetsURL("images/icon/success_cone.svg"),bo={key:0,class:"layout-default md:w-650px"},wo={"my-4":"",flex:"","items-center":""},ko=t("i",{"i-solar:dialog-2-line-duotone":"","ml-2":"","p-0.6em":""},null,-1),xo={class:"tra sticky bottom-1rem mt-4 flex items-center rounded-10px p-3 shadow v-card"},Io=t("i",{"i-solar:headphones-round-sound-line-duotone":"","mr-2":"","p-.8em":""},null,-1),Eo={key:1,class:"h-90vh w-full flex-row-c-c animate-[bounceIn_0.4s_ease-in] overflow-hidden","flex-col":"","leading-2em":"","tracking-0.2em":""},So=t("img",{src:yo,"w-8rem":"",alt:"🎉"},null,-1),$o=t("h3",null,"评价已完成",-1),Co={class:"mt-2"},To={key:2,class:"h-90vh w-full flex-row-c-c"},ot=A({__name:"[id]",setup(w){var D;const E=se(),o=_e(),p=m((D=o.params.id)==null?void 0:D.toString()),c=Ne(async()=>{const{data:u,code:f}=await Le(p.value,E.getToken);return f===B.SUCCESS?u.status!==Ae.RECEIVED?(ge(),null):u:null},"$frtncmxQS1");ve({title:`${Q} - 订单评价`,meta:[{name:"description",content:`${Q} - 订单评价`}]});const _=m([]),d=m(!1),h=m(!1),a=m(!1),k=De(()=>E.isLogin&&o.params.id&&c.data.value&&!h.value);async function R(){var f;if(_.value.length!==((f=c.data.value)==null?void 0:f.ordersItems.length))return x.warning("评论列表个数缺失！");for(let i=0;i<_.value.length;i++){const C=_.value[i];if(C.dto.rate){if(!C.dto.orderItemId)return x.warning("评论表单错误，请稍后再试！")}else return x.warning("评论星级不能为空！")}d.value=!0,h.value=!1,a.value=!0;const{code:u}=await Pe(c.data.value.id,JSON.parse(JSON.stringify(_.value.map(i=>i.dto))),E.getToken);u===B.SUCCESS?(te.success({title:"评价成功 🎉",message:"感谢您的评价，欢迎下次继续选购~"}),h.value=!0):(te.error({title:"评价失败，请稍后再试！"}),h.value=!1),_.value.forEach(i=>{i.clearData&&i.clearData()}),a.value=!1}async function $(u){J.confirm("确认提交评价？","提示",{confirmButtonText:"确定",lockScroll:!1,cancelButtonText:"取消",type:"info",center:!0,callback:async f=>{f==="confirm"&&u&&u()}})}return(u,f)=>{const i=ie,C=ho,P=ze,z=Me,U=he,M=ye,N=be,e=we,n=ke;return I(),S("div",null,[l(e,{name:"second",header:!1,"left-menu":!1,footer:!1,menu:["back","service"]},{default:g(()=>[l(N,null,{default:g(()=>{var y;return[s(k)?O((I(),S("div",bo,[t("h3",wo,[F(" 订单评价 "),ko,l(i,{class:"ml-a mr-0"})]),(I(!0),S(Be,null,Re((y=s(c).data.value)==null?void 0:y.ordersItems,(r,T)=>(I(),S("div",{key:r.id,class:"mb-4 rounded-10px p-4 shadow-sm v-card"},[l(C,{ref_for:!0,ref_key:"dtoList",ref:_,index:T,"order-item":r,"is-disable":s(d)},null,8,["index","order-item","is-disable"])]))),128)),t("div",xo,[l(z,{"flex-row-c-c":""},{default:g(()=>[l(P,{to:"/chat?type=service",class:"hidden md:inline"},{default:g(()=>[Io,F(" 客服 ")]),_:1})]),_:1}),l(U,{class:"ml-a",type:"primary",style:{"font-weight":"600",padding:"1.1rem"},"shadow-lg":"",onClick:f[0]||(f[0]=r=>$(()=>R()))},{default:g(()=>[F(" 提 交 ")]),_:1})])])),[[n,s(a),void 0,{fullscreen:!0,lock:!0}]]):s(h)?(I(),S("div",Eo,[So,$o,t("div",Co,[l(U,{type:"primary",onClick:f[1]||(f[1]=r=>("navigateTo"in u?u.navigateTo:s(K)).length>0?u.$router.back():("navigateTo"in u?u.navigateTo:s(K))("/order/list"))},{default:g(()=>[F(" 关闭 ")]),_:1}),l(U,{plain:"",type:"primary"},{default:g(()=>[F(" 主页 ")]),_:1})])])):(I(),S("div",To,[l(M,{msg:"抱歉，订单不存在",class:"text-[var(--el-color-primary)]"})]))]}),_:1})]),_:1})])}}});export{ot as default};
