import{go as F,u as I,gp as s}from"./entry.HuYbGiLS.js";import{a as o}from"./swiper-vue.4ZhlhtKr.js";var A=(e=>(e[e.CHECK_TOKEN=1]="CHECK_TOKEN",e[e.HEARTBEAT=2]="HEARTBEAT",e))(A||{}),t=(e=>(e[e.OPEN=1]="OPEN",e[e.SAFE_CLOSE=2]="SAFE_CLOSE",e[e.CLOSE=3]="CLOSE",e))(t||{}),E=(e=>(e[e.MESSAGE=1]="MESSAGE",e[e.ONLINE_OFFLINE_NOTIFY=2]="ONLINE_OFFLINE_NOTIFY",e[e.RECALL=3]="RECALL",e[e.APPLY=4]="APPLY",e[e.MEMBER_CHANGE=5]="MEMBER_CHANGE",e[e.TOKEN_EXPIRED_ERR=6]="TOKEN_EXPIRED_ERR",e))(E||{});const d=F("chat_websocket",()=>{const e=o(null),i=o(""),l=o(t.CLOSE),c=o({newMsg:[],onlineNotice:[],recallMsg:[],applyMsg:[],memberMsg:[],tokenMsg:[],other:[]});function _(n){var r;const a=I();if(!a.getToken)return(r=e.value)==null||r.close(),l.value=t.SAFE_CLOSE,!1;v(s,a.getToken),N(n),O(),S()}function v(n=s,a=""){return e.value&&l.value===t.OPEN||(i.value=`${n}?Authorization=${a}`,e.value=new WebSocket(i.value),l.value=t.OPEN),e.value}function N(n){e.value&&(e.value.onopen=n)}function O(){e.value&&e.value.addEventListener("error",n=>{l.value=t.CLOSE,e.value=null})}function S(){e.value&&e.value.addEventListener("close",n=>{l.value=t.SAFE_CLOSE,e.value=null})}const f={[E.MESSAGE]:"newMsg",[E.ONLINE_OFFLINE_NOTIFY]:"onlineNotice",[E.RECALL]:"recallMsg",[E.APPLY]:"applyMsg",[E.MEMBER_CHANGE]:"memberMsg",[E.TOKEN_EXPIRED_ERR]:"tokenMsg"};function C(n){e.value&&e.value.addEventListener("message",a=>{if(a&&!a.data)return!1;try{const r=JSON.parse(a.data);if(r){const u=r.data,P=u.data;f[u.type]!==void 0&&c.value[f[u.type]].push(P),n(u)}}catch{return null}})}function R(){L({type:A.HEARTBEAT,data:null})}function L(n){var a,r;(a=e.value)!=null&&a.OPEN&&((r=e.value)==null||r.send(JSON.stringify(n)))}return{webSocketHandler:e,status:l,wsMsgList:c,onerror:O,initDefault:_,link:v,open:N,send:L,sendHeart:R,onMessage:C}},{persist:!1});export{t as W,d as u};
