import{b as I,_ as C}from"./index.tpBqOViH.js";import{_ as $}from"./nuxt-link.eZ5kOSgI.js";import{_ as M}from"./AutoIncre.vue.KpzenuDu.js";import{j as V,a as u,r as j,k as y,L as _,a5 as h,a0 as r,U as w,a9 as D,aa as O,u as s,M as x,a3 as B,a6 as P,Z as b,ar as R,N as L,a4 as A,_ as E,X as F,a7 as U,am as X,an as Z}from"./swiper-vue.4ZhlhtKr.js";import{aa as q,w as H,f as J}from"./entry.HuYbGiLS.js";import"./ElImage.H3VTC2Vd.js";import"./PreLoading.vue.RcEKquDI.js";import"./debounce.4-I_Xkye.js";import"./fetch.3IR0ILJ_.js";const K=n=>(X("data-v-5ed468e7"),n=n(),Z(),n),Q={class:"ml-a mt-2px text-blueGray"},W=K(()=>L("i",{"i-solar:fire-bold-duotone":"","bg-red-5":"","p-0.6em":""},null,-1)),Y=V({__name:"GoodsList",props:{dto:{default:()=>({})},class:{},size:{default:10},limit:{},load:{type:Boolean},isTimer:{type:Boolean,default:!0},showMoreText:{type:Boolean,default:!0},immediate:{type:Boolean,default:!0},autoStop:{type:Boolean,default:!0},transiton:{default:"fade-bt-list"}},setup(n,{expose:T}){const e=n,l=u(!1),i=u([]),d=u(0),k=u(e.limit||e.size||10),a=j({total:-1,pages:-1,current:-1}),g=y(()=>a.total===0&&a.pages===0),c=y(()=>a.pages>0&&d.value>=a.pages);async function m(){if(c.value||g.value)return;if(e.limit!==void 0&&i.value.length>=e.limit){l.value=!1;return}l.value=!0,d.value++;const{data:t}=await I(d.value,k.value,e==null?void 0:e.dto);if(a.total=t.total,a.current=t.current,a.pages=t.pages,e.isTimer)for await(const o of t.records)o.images=typeof o.images=="string"?o.images.split(","):[],i.value.push(Object.freeze(o));else i.value.push(...Object.freeze(t.records.map(o=>(o.images=typeof o.images=="string"?o.images.split(","):[],o))));e.immediate?l.value=!1:setTimeout(()=>{l.value=!1},300)}function v(){i.value.splice(0),a.total=-1,a.pages=-1,a.current=-1,d.value=0}const N=q(e.dto),p=u();return H(N,async()=>{p.value||(v(),await m(),p.value=setTimeout(()=>{clearTimeout(p.value),p.value=null},400))},{}),e.immediate&&m(),T({clearResult:v,loadGoodsPage:m,goodsList:i,pageInfo:a}),(t,o)=>{const S=C,z=$,G=M;return _(),h(G,{immediate:t.immediate,"no-more":s(c)||s(g),loading:s(l)||!t.immediate,"auto-stop":t.autoStop,onLoad:m},{load:r(()=>[w(t.$slots,"load",{},void 0,!0)]),done:r(()=>[t.showMoreText?D((_(),x("p",{key:0,class:"w-1/1 py-8","text-center":"","text-bluegray":"","tracking-1":""},B(s(c)?"暂无更多商品":"暂无商品"),513)),[[O,s(c)||s(g)]]):P("",!0)]),default:r(()=>[w(t.$slots,"pre",{},void 0,!0),b(U,{tag:"div",name:t.transiton,class:F(["pb-4",e.class!==null?e.class:"flex flex-wrap"])},{default:r(()=>[(_(!0),x(E,null,R(s(i),f=>(_(),h(z,{key:f.id,to:`/goods/detail/${f.id}`},{default:r(()=>[b(S,{class:"mt-4/100 transition-300 v-card",goods:f},{default:r(()=>[L("small",Q,[W,A(" "+B(f.sales),1)])]),_:2},1032,["goods"])]),_:2},1032,["to"]))),128))]),_:1},8,["name","class"])]),_:3},8,["immediate","no-more","loading","auto-stop"])}}}),ue=J(Y,[["__scopeId","data-v-5ed468e7"]]);export{ue as default};
