import{u as M,b as ke,s as $e,B as j,E as Y,c as xe,d as Z,e as Ce,f as O,w as Fe,g as Te,h as ae,S as V,i as Ie,n as Se,j as Le,k as Ee,a as Be,l as Ue}from"./entry.t-rqPOs0.js";import{E as Ae}from"./tag.C0ahusY6.js";import{_ as G}from"./ElImage.MMEIiX96.js";import{_ as K}from"./AutoIncre.vue.cpfunnOh.js";import{E as ne}from"./scrollbar.VqFpSCdd.js";import{E as re}from"./empty.RhpDpTy5.js";import{j as I,a as m,r as Oe,k as le,ap as q,O as c,P as v,Q as o,$ as p,u as e,x as ie,ak as oe,a2 as f,a6 as A,ad as ze,a0 as N,a5 as x,a7 as B,as as D,ab as U,ac as R,a8 as J,an as ee,ao as te,b as ce,X as Ne,Y as se,t as De,n as Me,a3 as Pe,Z as Ve}from"./swiper-vue.Dj7aAS3P.js";import{g as Re,a as de,F as C,C as X,b as je,c as Ge,d as Ke,i as We}from"./friend.psniISnN.js";import{E as He}from"./index.8LNiojwe.js";/* empty css                    */import{u as z,g as Qe,R as Xe}from"./contact.O0MKBF5K.js";import{u as Ye}from"./useWs.cWBkfbdz.js";import{E as ue}from"./notification.YJSnxgg5.js";import{E as Ze}from"./divider.Ixn223Qv.js";import{_ as qe}from"./ApplyDialog.vue.xGx-IahS.js";import{g as Je}from"./index.nPWTgw9q.js";import"./debounce.0E-5_dMF.js";import"./dialog.W1fDsdND.js";const W=_=>(ee("data-v-a482a47e"),_=_(),te(),_),et={class:"h-full w-full flex flex-col",relative:""},tt={class:"v-input","flex-row-c-c":""},st={key:0,class:"absolute left-0 top-2rem z-1 h-80vh w-full flex-1 bg-color"},ot={class:"tags transform-origin-top-center scale-y-0 op-0 transition-200 transition-all group-hover:scale-y-100 group-hover:op-100",absolute:"","top-0":"","top-40px":"","z-0":"",flex:"","flex-nowrap":"","cursor-pointer":"","flex-items-center":"","py-1":""},at=W(()=>o("small",{"mt-2":"","op-60":""},"历史记录：",-1)),nt={"pr-0.3em":""},rt={class:"mt-2 flex-row-bt-c px-2"},lt={"pt-4":""},it=["onClick"],ct={class:"relative flex-row-c-c"},dt=W(()=>o("span",{class:"g-avatar"},null,-1)),ut=W(()=>o("p",{"text-center":"","text-0.7em":"","op-70":""}," 暂无更多 ",-1)),pt=W(()=>o("i",{"i-solar:users-group-two-rounded-bold-duotone":"","p-2rem":"","op-40":""},null,-1)),_t=I({__name:"ApplySearch",emits:["submit"],setup(_,{emit:r}){const u=r,t=m(""),n=m(!1),l=m({total:0,pages:0,size:0,current:0}),d=Oe([]),h=M(),s=m(!1),$=m(0),y=m(10),g=le(()=>l.value.total>0&&d.length>=l.value.total),w=ke("jiwu_chat_friend_user",[]);async function i(){if(!t.value)return Y.error({message:"搜索内容不能为空！"});await L(),!w.value.includes(t.value)&&w.value.length<=6?w.value.unshift(t.value.trim()):w.value.pop(),await a()}async function a(){if(g.value||s.value)return;s.value=!0,$.value++;const b=await Re($.value,y.value,{keyWord:t.value},h.getToken);l.value={total:b.data.total,pages:b.data.pages,size:b.data.size,current:b.data.current},d.push(...b.data.records),s.value=!1,n.value=!0}function S(){n.value=!1,t.value="",d.splice(0),l.value={total:0,pages:0,size:0,current:0}}function L(){d.splice(0),l.value={total:0,pages:0,size:0,current:0},$.value=0}function E(b){w.value.splice(w.value.indexOf(b),1)}function H(b,T){w.value.splice(T,1),w.value.push(b),t.value=b,i()}const F=m(!1);return m(),(b,T)=>{const pe=xe,_e=Z,me=Ae,fe=Ce,ve=G,he=K,ge=ne,ye=re,we=q("auto-animate");return c(),v("div",et,[o("div",tt,[p(pe,{modelValue:e(t),"onUpdate:modelValue":T[0]||(T[0]=k=>ie(t)?t.value=k:null),modelModifiers:{trim:!0},class:"mr-2",type:"text",clearable:"",autocomplete:"off","prefix-icon":"ElIconSearch"in b?b.ElIconSearch:e($e),minlength:"2",maxlength:"30","on-search":i,placeholder:"搜索好友",onFocus:T[1]||(T[1]=k=>F.value=!0),onKeyup:[oe(S,["esc"]),oe(i,["enter"])]},null,8,["modelValue","prefix-icon"]),p(_e,{type:"primary",class:"w-5rem shadow",style:{position:"relative",transition:"0.2s"},loading:e(s),"icon-class":"i-solar:magnifer-outline mr-2",onFocus:T[2]||(T[2]=k=>F.value=!0),onClick:ze(i,["self"])},{default:f(()=>[A(" 搜索 ")]),_:1},8,["loading"])]),e(F)?(c(),v("div",st,[p(fe,null,{default:f(()=>[o("div",ot,[at,(c(!0),v(N,null,D(e(w),(k,Q)=>(c(),B(me,{key:k+Q,closable:"",class:"mr-1 mt-2 transition-300",onClose:be=>E(k),onClick:be=>H(k,Q)},{default:f(()=>[o("span",nt,x(k),1)]),_:2},1032,["onClose","onClick"]))),128))])]),_:1}),o("div",rt,[U(o("span",{class:"text-0.7rem"},x(` 找到 ${e(l).total} 个匹配好友`),513),[[R,e(d).length>0]]),o("i",{"i-solar:close-circle-bold":"",class:"ml-a p-2 btn-danger",onClick:T[3]||(T[3]=k=>F.value=!1)})]),U(p(ge,{"wrap-class":"pb-6 flex-1 px-2 overflow-hidden",class:"h-full pb-6"},{default:f(()=>[p(he,{immediate:!1,"no-more":e(g),onLoad:a},{done:f(()=>[ut]),default:f(()=>[U((c(),v("div",lt,[(c(!0),v(N,null,D(e(d),k=>(c(),v("div",{key:k.id,class:"relative mb-2 flex cursor-pointer items-center gap-4 truncate truncate rounded-2rem p-2 transition-300 transition-all active:scale-96 border-default hover:border-[var(--el-color-primary)] hover:bg-white hover:op-100 hover:shadow hover:shadow-inset hover:dark:bg-dark-9 v-card",onClick:Q=>u("submit",k)},[o("div",ct,[p(ve,{src:("BaseUrlImg"in b?b.BaseUrlImg:e(j))+k.avatar,fit:"cover",class:"h-2em w-2em flex-shrink-0 overflow-auto rounded-1/2 object-cover border-default"},null,8,["src"]),dt]),o("small",null,x(k.nickname||k.username),1)],8,it))),128))])),[[we]])]),_:1},8,["no-more"])]),_:1},512),[[R,e(n)&&e(l).current&&e(d).length>0]]),U(p(ye,{"mt-10":"","image-size":80,description:e(d).length<=0&&e(l).current>0?"没有找到好友":"好友查找"},{image:f(()=>[pt]),_:1},8,["description"]),[[R,!e(l).total]])])):J("",!0)])}}}),mt=O(_t,[["__scopeId","data-v-a482a47e"]]),ft={"w-full":"",flex:"","flex-col":""},vt=I({__name:"GroupList",setup(_){const r=m(!1),u=M(),t=m({cursor:null,isLast:!1,size:10,total:-1}),n=m([]);async function l(){if(r.value||t.value.isLast)return;r.value=!0;const{data:h}=await de(t.value.size,t.value.cursor,u.getToken);h.list&&n.value.push(...h.list),t.value.isLast=h.isLast,t.value.cursor=h.cursor,r.value=!1}l();const d=z();return Fe(()=>d.delUserId,h=>{h&&(n.value=n.value.filter(s=>s.userId!==h),d.setDelUserId(""))},{debounce:300}),(h,s)=>{const $=K,y=He;return c(),B(y,{class:"w-full"},{default:f(()=>[o("div",ft,[p($,{immediate:!0,"auto-stop":!0,"no-more":e(t).isLast,loading:e(r),onLoad:l},{default:f(()=>[(c(!0),v(N,null,D(e(n),g=>(c(),v("div",{key:g.uid},x(g.nickName)+" "+x(g.activeStatus),1))),128))]),_:1},8,["no-more","loading"])])]),_:1})}}}),ht=O(vt,[["__scopeId","data-v-d01ad81d"]]),gt={"w-full":"",flex:"","flex-col":""},yt=["onClick"],wt={class:"avatar-icon"},bt=I({__name:"FriendList",setup(_){const r=m(!1),u=M(),t=m({cursor:null,isLast:!1,size:10,total:-1}),n=m([]);async function l(){if(r.value||t.value.isLast)return;r.value=!0;const{data:s}=await de(t.value.size,t.value.cursor,u.getToken);s.list&&n.value.push(...s.list),t.value.isLast=s.isLast,t.value.cursor=s.cursor,r.value=!1}l();const d=z();ce(()=>d.isAddNewFriend,s=>{s&&!r.value&&(h(),d.isAddNewFriend=!1)});function h(){t.value.cursor=null,t.value.isLast=!1,n.value=[],l()}return(s,$)=>{const y=G,g=K,w=q("auto-animate");return U((c(),v("div",gt,[p(g,{immediate:!0,"auto-stop":!0,"no-more":e(t).isLast,loading:e(r),onLoad:l},{default:f(()=>[(c(!0),v(N,null,D(e(n),i=>(c(),v("div",{key:i.id,class:"item",onClick:a=>e(d).setTheFriendOpt(("FriendOptType"in s?s.FriendOptType:e(C)).User,{id:i.userId})},[o("div",wt,[p(y,{class:"h-full w-full overflow-hidden rounded-6px",src:("BaseUrlImg"in s?s.BaseUrlImg:e(j))+i.avatar,fit:"cover"},null,8,["src"])]),o("small",null,x(i.nickName||"未填写"),1)],8,yt))),128))]),_:1},8,["no-more","loading"])])),[[w]])}}}),kt=O(bt,[["__scopeId","data-v-33444f6d"]]),P=_=>(ee("data-v-68733a71"),_=_(),te(),_),$t={class:"list"},xt={class:"py-2 hover:bg-transparent"},Ct={class:"list"},Ft=P(()=>o("small",{"op-90":""},"新的朋友",-1)),Tt=P(()=>o("div",{class:"avatar-icon bg-[var(--el-color-warning)]"},[o("i",{"i-solar:user-plus-bold":"","bg-light":"","p-3":""})],-1)),It=P(()=>o("small",null,"新的朋友",-1)),St={class:"list pb-4"},Lt=P(()=>o("small",{"op-90":""},"群聊",-1)),Et={class:"list"},Bt=P(()=>o("small",{"op-90":""},"好友",-1)),Ut=I({__name:"Tabs",setup(_){const r=z(),u=Ye();function t(){r.setTheFriendOpt(C.NewFriend,{}),u.wsMsgList.applyMsg.splice(0)}return(n,l)=>{const d=mt,h=Te,s=ht,$=kt;return c(),v("div",se({class:"border-0 border-r-1px transition-200 transition-width border-default"},n.$attrs),[Ne(n.$slots,"top",{},()=>[o("div",$t,[o("div",xt,[p(d,{onSubmit:l[0]||(l[0]=y=>{e(r).setTheFriendOpt(("FriendOptType"in n?n.FriendOptType:e(C)).User,y)})})])]),o("div",Ct,[Ft,o("div",{class:"item",onClick:t},[p(h,{value:e(u).wsMsgList.applyMsg.length||0,hidden:!e(u).wsMsgList.applyMsg.length,max:99},{default:f(()=>[Tt]),_:1},8,["value","hidden"]),It])])],!0),o("div",St,[Lt,p(s)]),o("div",Et,[Bt,p($)])],16)}}}),At=O(Ut,[["__scopeId","data-v-68733a71"]]),Ot=I({__name:"GroupFriend",props:{data:{}},setup(_){return(r,u)=>(c(),v("div",null,x(r.data),1))}}),zt={"w-full":"",flex:"","flex-col":""},Nt={class:"item"},Dt=["onClick"],Mt={class:"flex flex-col truncate"},Pt={"cursor-pointer":""},Vt={"cursor-pointer":""},Rt={class:"ml-a flex-row-c-c flex-shrink-0"},jt={key:1},Gt={class:"py-1rem text-center op-70"},Kt=I({__name:"ApplyList",setup(_){const r=m(!1),u=M(),t=m({cursor:null,isLast:!1,size:10,page:0,total:-1}),n=m([]);async function l(){if(r.value||t.value.isLast)return;t.value.page++,r.value=!0;const{data:s}=await je(t.value.page,t.value.size,u.getToken);s.records&&n.value.push(...s.records),t.value.isLast=!!s.isLast,t.value.page=s.current||1,r.value=!1}l();const d=z();function h(s){ae.confirm("是否同意好友申请？",{confirmButtonText:"确定",cancelButtonText:"取消",lockScroll:!1,callback:async $=>{if($==="confirm"){const y=await Ge({applyId:s},u.getToken);if(y.code===V.SUCCESS){ue.success("已添加好友！");for(const g of n.value)g.userId&&(g.status=X.Argee);d.setIsAddNewFriend(!0)}else Y.error(y.message)}}})}return(s,$)=>{const y=G,g=Ie,w=K,i=q("auto-animate");return U((c(),v("div",zt,[p(w,{immediate:!0,"auto-stop":!0,"no-more":e(t).isLast,loading:e(r),onLoad:l},{done:f(()=>[o("div",Gt,x(e(n).length?"没有更多了":"快去认识其他人"),1)]),default:f(()=>[(c(!0),v(N,null,D(e(n),a=>{var S,L;return c(),v("div",{key:a.applyId,class:"mb-3 border-0 border-b-1px pb-3 border-default"},[o("div",Nt,[o("div",{class:"avatar-icon cursor-pointer",onClick:E=>e(d).setTheFriendOpt(("FriendOptType"in s?s.FriendOptType:e(C)).User,{id:a.userId})},[p(y,{class:"h-full w-full overflow-hidden rounded-6px",src:("BaseUrlImg"in s?s.BaseUrlImg:e(j))+((S=a.user)==null?void 0:S.avatar),fit:"cover"},null,8,["src"])],8,Dt),o("div",Mt,[o("p",Pt,x(((L=a.user)==null?void 0:L.nickName)||"未填写"),1),o("small",Vt,x(a.msg||""),1)]),o("div",Rt,[a.status===("ChatApplyStatusType"in s?s.ChatApplyStatusType:e(X)).Load?(c(),B(g,{key:0,onClick:E=>h(a.applyId)},{default:f(()=>[A(" 同意 ")]),_:2},1032,["onClick"])):a.status===("ChatApplyStatusType"in s?s.ChatApplyStatusType:e(X)).Argee?(c(),v("small",jt,"已同意")):J("",!0)])])])}),128))]),_:1},8,["no-more","loading"])])),[[i]])}}}),Wt=O(Kt,[["__scopeId","data-v-8cb9882f"]]),Ht={class:"relative flex flex-col"},Qt=o("h4",{class:"flex-row-bt-c border-0 border-b-1 rounded-0 p-4 border-default bg-color md:p-4"}," 新的朋友 ",-1),Xt=I({__name:"NewFriend",props:{data:{}},setup(_){return(r,u)=>{const t=Wt,n=ne;return c(),v("div",Ht,[Qt,p(n,{class:"bg-white dark:bg-dark-7","view-class":"p-2rem md:w-1/2 mx-a","wrap-class":"w-full flex-1 h-full"},{default:f(()=>[p(t)]),_:1})])}}}),Yt={flex:"","gap-4":""},Zt={class:"text-0.8rem leading-1.5em"},qt={"text-1.4rem":""},Jt={"op-60":""},es={"op-60":""},ts={class:"animate-[0.3s_fade-in]"},ss=I({__name:"User",props:{data:{}},setup(_){const u=De(_.data),t=m(!1),n=m(!1),l=m({}),d=M();async function h(i){if(t.value)return;n.value=!1,t.value=!0;const a=await Je(i,d.getToken);a.code===V.SUCCESS&&(l.value=a.data),setTimeout(()=>{t.value=!1},400),We({uidList:[i]},d.getToken).then(S=>{const L=S.data.checkedList.find(E=>E.uid===i);n.value=L&&L.isFriend===Le.TRUE}).catch(()=>{})}const s=z();function $(i){ae.confirm("是否删除该好友？",{confirmButtonText:"删除",cancelButtonText:"取消",lockScroll:!1,type:"warning",callback:async a=>{a==="confirm"&&((await Ke(i,d.getToken)).code===V.SUCCESS&&(ue.success("删除成功！"),s.setTheFriendOpt(C.Empty,{}),s.setDelUserId(i),s.setIsAddNewFriend(!0)),s.setIsAddNewFriend(!0))}})}const y=m(!1),g=le(()=>u.value.data.id);ce(g,i=>{i&&h(i)},{immediate:!0,deep:!0});async function w(i){if(!n.value)return;const a=await Qe(i,Xe.SELFT,d.getToken);if(a){if(a&&a.code!==V.SUCCESS)return Y.error(a?a.message:"没有找到对应好友！");s.setContact(a.data),Me(()=>{Se({path:"/chat"})})}}return(i,a)=>{const S=G,L=Ze,E=Z,H=qe;return c(),v("div",se(i.$attrs,{"h-full":"","w-full":"",flex:"","flex-1":"","flex-col":"","items-center":"","gap-1rem":"","pt-6rem":"","bg-color":""}),[o("div",Yt,[p(S,{src:("BaseUrlImg"in i?i.BaseUrlImg:e(j))+e(l).avatar,fit:"cover",class:"h-3.8rem w-3.8rem flex-shrink-0 overflow-auto object-cover shadow-sm border-default v-card"},null,8,["src"]),o("div",Zt,[o("strong",qt,x(e(l).nickname),1),o("p",Jt," ID："+x(e(g))+" "+x(e(l).gender||""),1),o("p",es," 邮箱："+x(e(l).email||"未填写"),1)])]),p(L,{style:{margin:"2rem auto",width:"30%"}}),U(o("div",ts,[e(n)?(c(),B(E,{key:0,"icon-class":"i-solar:trash-bin-trash-bold-duotone p-2 mr-2",class:"op-80",type:"danger",plain:"",onClick:a[0]||(a[0]=F=>$(e(g)))},{default:f(()=>[A(" 删除好友  ")]),_:1})):J("",!0),e(n)?(c(),B(E,{key:1,"icon-class":"i-solar:chat-line-line-duotone p-2 mr-2",class:"border-default",type:"info",onClick:a[1]||(a[1]=F=>w(e(g)))},{default:f(()=>[A(" 发消息  ")]),_:1})):(c(),B(E,{key:2,"icon-class":"i-solar:user-plus-bold p-2 mr-2",class:"op-80",type:"primary",onClick:a[2]||(a[2]=F=>y.value=!0)},{default:f(()=>[A(" 添加好友  ")]),_:1}))],512),[[R,!e(t)]]),p(H,{show:e(y),"onUpdate:show":a[3]||(a[3]=F=>ie(y)?y.value=F:null),"user-id":e(g),onSubmit:a[4]||(a[4]=F=>e(s).setTheFriendOpt(("FriendOptType"in i?i.FriendOptType:e(C)).Empty,{}))},null,8,["show","user-id"])],16)}}}),os=I({__name:"Index",props:{data:{}},setup(_){const r={[C.User]:ss,[C.NewFriend]:Xt,[C.GroupFriend]:Ot};return(u,t)=>(c(),B(Pe(r[u.data.type||("FriendOptType"in u?u.FriendOptType:e(C)).User]),se({data:u.data},u.$attrs),null,16,["data"]))}}),as=_=>(ee("data-v-a60beb15"),_=_(),te(),_),ns={relative:""},rs={class:"absolute pl-5rem sm:relative sm:mx-auto sm:w-1/4 sm:p-0 card-default"},ls={key:1,class:"flex-row-c-c flex-1 flex-shrink-0 bg-color"},is=as(()=>o("i",{"i-solar:users-group-two-rounded-bold-duotone":"","p-2rem":"","op-40":""},null,-1)),cs=I({__name:"friend",setup(_){Ee({title:"极物聊天 - 极物圈 👑",description:"极物聊天 - 极物圈 开启你的极物之旅！",keywords:Ue});const r=z();return(u,t)=>{const n=At,l=Z,d=os,h=re,s=Be;return c(),v("div",ns,[p(s,{name:"chat"},{default:f(()=>[o("div",rs,[p(n,{class:"relative mx-a h-full flex-shrink-0 p-4"})]),o("div",{class:Ve(["relative z-1 h-full flex-1 flex-shrink-0 flex-col sm:w-3/4 card-default",e(r).showTheFriendPanel?"flex":"hidden sm:flex"])},[p(l,{"icon-class":"i-solar:power-bold","transition-icon":"",size:"small",class:"absolute right-1rem top-1rem z-2 block sm:hidden",onClick:t[0]||(t[0]=$=>e(r).showTheFriendPanel=!1)},{default:f(()=>[A(" 关闭 ")]),_:1}),e(r).theFriendOpt.type!==("FriendOptType"in u?u.FriendOptType:e(C)).Empty?(c(),B(d,{key:0,data:e(r).theFriendOpt,class:"mx-a h-full w-full flex-1 flex-shrink-0 bg-color"},null,8,["data"])):(c(),v("div",ls,[p(h,{"mt-10":"","image-size":80,description:"找到你想要聊天的朋友吧"},{image:f(()=>[is]),_:1})]))],2)]),_:1})])}}}),Is=O(cs,[["__scopeId","data-v-a60beb15"]]);export{Is as default};
