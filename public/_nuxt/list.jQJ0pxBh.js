import{E as fe}from"./divider.Dj8BMgcW.js";import{G as N,n as Q,B as pe,k as L,e as ee,h as te,f as ae,u as se,S as U,E as _e,g as P,a9 as ve,a as ye,z as he,y as ge}from"./entry.HuYbGiLS.js";import{E as be}from"./date-picker.UhiU1TEx.js";import{_ as Ee}from"./DelayTimer.vue.C1IdBqmv.js";import{ElText as De}from"./index.2AyaIaz8.js";import{_ as ke}from"./ElImage.H3VTC2Vd.js";import{E as Se}from"./tag.Q9i6oaRN.js";import{j as H,ao as ne,L as f,M as v,N as n,a3 as E,a9 as R,a4 as Y,X as A,a6 as $,C as Ce,k as V,Z as l,a0 as d,u as a,_ as J,ar as K,a5 as z,am as oe,an as le,a as k,aa as W,x as re}from"./swiper-vue.4ZhlhtKr.js";import{u as xe}from"./useOrderStore._PjEUjF8.js";import{O as o,f as we,h as Ie,c as Te,e as Oe,r as Ye,d as Ne}from"./index.xV7eTSBk.js";import{_ as Le}from"./AutoIncre.vue.KpzenuDu.js";import{E as $e}from"./scrollbar.ylZGouLy.js";import"./popper.TZrEXPn8.js";import{E as I}from"./notification.mMgfY760.js";import{E as Be,a as Me}from"./tabs.hIqoD_La.js";import"./localeData.Oasa6b5P.js";import"./arrays.9GuX8ZvT.js";import"./flatten.lVx7POvc.js";import"./index.RtMxj6Hn.js";import"./debounce.4-I_Xkye.js";import"./index.O6n8D2HD.js";import"./isEqual.gU3elsgQ.js";import"./PreLoading.vue.RcEKquDI.js";import"./isUndefined.IZwZ21d-.js";import"./strings.PBHHvk2X.js";import"./index.gOl6WcbK.js";const Ue={class:"cursor-pointer transition-300 hover:text-[var(--el-color-info)]"},Pe={inline:""},Re={"ml-a":"",inline:""},Ve=H({__name:"CopyText",props:{text:{},pretext:{},icon:{}},setup(y){return(h,g)=>{const r=ne("copying");return f(),v("small",Ue,[n("div",Pe,E(h.pretext),1),R((f(),v("div",Re,[Y(E(h.text),1)])),[[r,h.text,void 0,{toast:!0}]]),h.icon?(f(),v("i",{key:0,class:A(["ml-1 p-0.5em opacity-60",h.icon])},null,2)):$("",!0)])}}}),F=y=>(oe("data-v-6f0e1f95"),y=y(),le(),y),Ae={class:"group mb-6 rounded-10px bg-white p-4 tracking-0.1em shadow-none backdrop-blur-2rem transition-300 border-default dark:bg-dark-400 active:shadow hover:shadow"},ze={class:"flex items-center border-0 border-b-1px pb-2 border-default"},He=F(()=>n("i",{class:"i-solar:shop-bold-duotone mr-2 bg-[var(--el-color-primary)] p-2 opacity-50"},null,-1)),Fe=F(()=>n("small",{"font-600":""},"极物圈",-1)),qe={"ml-a":""},je={key:0,flex:"","items-center":""},Xe={class:"center flex flex-1 flex-col overflow-hidden truncate px-2 text-0.8rem leading-1.6em md:px-4 md:text-1rem md:leading-1.8em"},Ge={"flex-1":"",truncate:""},Ze={truncate:""},Je={"ml-a":"",inline:"",flex:"","flex-col":"","justify-end":""},Ke={"ml-a":"",hidden:"","line-through":"","opacity-80":"","md:block":""},Qe={"ml-4":"","h-full":"",flex:"","items-center":"","font-600":""},We={class:"mt-4 w-full flex flex-col"},et={"flex-row-bt-c":""},tt={key:0,class:"mb-2 ml-a"},at={"flex-row-bt-c":""},st={"ml-a":"",flex:"","text-1.2rem":"","font-600":""},nt=F(()=>n("small",{"text-0.85rem":""},"总计：",-1)),ot={"mt-3":"","flex-row-bt-c":"","tracking-0.3em":""},lt=F(()=>n("div",{class:"left flex cursor-pointer items-center"},[n("i",{"i-solar:headphones-square-broken":"","bg-dark":"","p-1.8":"","dark:bg-light":""}),n("small",{class:"mx-2 hover:text-[var(--el-color-primary)] hover:underline"},"客服")],-1)),rt={class:"btns"},it=H({__name:"InfoLine",props:{order:{}},emits:["submit"],setup(y,{emit:h}){const g=y,r=h,{order:e}=Ce(g),i=xe(),b=V(()=>{const t={banner:"",type:"",btns:[]};switch(e.value.status){case o.UN_PAID:t.banner="待付款",t.btns=[{title:"取 消",type:"default",fn:()=>{r("submit","cancel",e.value)}},{title:"修 改",type:"default",fn:()=>{m(e.value)}},{title:"立即付款",type:"danger",fn:()=>{m(e.value)}}],t.type="danger";break;case o.PAID:t.banner="已付款，等待发货",t.type="primary",t.btns=[{title:"退 款",type:"default",fn:()=>{r("submit","pushRefund",e)}},{title:"催发货",type:"primary",fn:()=>{r("submit","toastDelivery")}}];break;case o.DELIVERED:t.banner="已发货，请等待物流",t.type="info",t.btns=[{title:"退 款",type:"default",fn:()=>{r("submit","pushRefund",e)}},{title:"确认收货",type:"info",fn:()=>{r("submit","checkDelivery",e)}}];break;case o.RECEIVED:t.banner="已确认收货，期待你的评价！",t.type="info",t.btns=[{title:"再来一单",type:"default",fn:()=>{m(e.value)}},{title:"去评价",type:"info",fn:()=>{D()}}];break;case o.COMMENTED:t.banner="已完成评论，欢迎下次光临！",t.type="success",t.btns=[{title:"再来一单",type:"default",fn:()=>{m(e.value)}}];break;case o.CANCELED:t.banner="订单已取消",t.type="danger",t.btns=[{title:"删除订单",type:"danger",fn:()=>{r("submit","toDelete",e.value)}},{title:"再来一单",type:"default",fn:()=>{m(e.value)}}];break;case o.DELAY_CANCELED:t.banner="订单超时，已自动取消",t.type="danger",t.btns=[{title:"删除订单",type:"danger",fn:()=>{r("submit","toDelete",e.value)}},{title:"再来一单",type:"default",fn:()=>{m(e.value)}}];break;case o.REFUND:t.banner="发起退款中，等等卖家处理...",t.type="",t.btns=[{title:"处理中，请稍后",type:"default",fn:()=>{m(e.value)}}];break;case o.REFUND_SUCCESS:t.banner="退款成功，请注意到账！",t.type="info",t.btns=[{title:"已退款",type:"default",fn:()=>{m(e.value)}}];break}return t}),T=V(()=>`text-[var(--el-color-${b.value.type||"default"})]`);function m(t=e.value){i.$patch({orderId:t.id,status:t.status,orderInfo:{...t},pushOrderItems:[...t.ordersItems.map(_=>({skuId:_.skuId,quantity:_.quantity,shopId:_==null?void 0:_.shopId,activityId:_==null?void 0:_.activityId}))],unPaidVO:{finalPrice:t.totalPrice,reducePrice:N(t.totalPrice).subtract(t.spendPrice).value}}),setTimeout(()=>{Q(`/order/detail?id=${t.id}`,{open:{target:"_blank"}})},50)}function D(){e.value.status===o.RECEIVED&&Q({path:`/order/comment/${e.value.id}`})}const p=V(()=>e.value.spendPrice?N(e.value.totalPrice).subtract(e.value.spendPrice):null);function O(){e.value.status=o.DELAY_CANCELED,e.value.updateTime=L(Date.now(),"YYYY-MM-DD HH:mm:ss").value.toString()}return(t,_)=>{const S=Ee,B=De,q=ke,j=ee,X=Se,G=Ve,Z=te;return f(),v("div",Ae,[n("span",ze,[He,Fe,n("div",qe,[l(B,{type:a(b).type,class:"flex"},{default:d(()=>[a(e).status===("OrdersStatus"in t?t.OrdersStatus:a(o)).UN_PAID?(f(),v("span",je,[l(S,{date:new Date(a(e).createTime),onDelay:O},null,8,["date"]),Y(" ， ")])):$("",!0),n("span",null,E(a(b).banner),1)]),_:1},8,["type"])])]),(f(!0),v(J,null,K(a(e).ordersItems,c=>(f(),v("div",{key:c.skuId,class:"flex cursor-pointer items-center","my-4":"",onClick:_[0]||(_[0]=C=>m(a(e)))},[l(j,null,{default:d(()=>[l(q,{loading:"lazy",fit:"cover",src:("BaseUrlImg"in t?t.BaseUrlImg:a(pe))+c.goodsSku.image,class:"h-4.5rem w-4.5rem overflow-hidden rounded-8px transition-300 md:h-7.2rem md:w-7.2rem border-default hover:shadow"},null,8,["src"])]),_:2},1024),n("div",Xe,[n("strong",Ge,[Y(E(c.goods.name)+" ",1),c.activityId?(f(),z(X,{key:0,type:"danger",size:"small","opacity-80":""},{default:d(()=>[Y(" 活动 ")]),_:1})):$("",!0)]),n("small",Ze,E([c.goodsSku.size,c.goodsSku.color,c.goodsSku.combo].filter(C=>C).join(" | ")),1),n("small",Je,[n("div",Ke," ￥"+E(a(N)(c.goodsSku.price)),1),n("div",{class:A(["text-1.2em font-600",a(T)]),"opacity-80":""}," ￥"+E(a(N)(c.goodsSku.price)),3)])]),n("span",Qe," X"+E(c.quantity),1)]))),128)),n("div",We,[n("div",et,[l(G,{hidden:"","md:inline":"",class:"opacity-0 opacity-80 hover:underline group-hover:opacity-70",text:a(e).id,pretext:"订单号："},null,8,["text"]),a(p)&&a(p).value>0?(f(),v("small",tt," -￥"+E(a(p)),1)):$("",!0)]),n("div",at,[n("span",st,[nt,n("div",{class:A(a(T))}," ￥"+E(a(p)?a(N)(a(e).spendPrice):a(N)(a(e).totalPrice)),3)])])]),n("div",ot,[lt,n("div",rt,[(f(!0),v(J,null,K(a(b).btns,c=>(f(),z(Z,{key:c.title,class:"ml-2 hover:-translate-y-0.15em",type:c.type||"default",onClick:C=>(c.fn||m)()},{default:d(()=>[Y(E(c.title),1)]),_:2},1032,["type","onClick"]))),128))])])])}}}),ct=ae(it,[["__scopeId","data-v-6f0e1f95"]]),ut={class:"mb-4 ml-a flex cursor-pointer items-center opacity-60 group-hover:opacity-100"},dt=n("small",{"w-6rem":""},"筛选：",-1),mt={class:"relative"},ft={class:"w-1/1 py-4","text-center":"","text-bluegray":"","tracking-1":""},pt={class:"w-1/1 py-4","text-center":"","text-bluegray":"","tracking-1":""},_t=H({__name:"InfoList",props:{dto:{default:()=>({})},status:{default:()=>-1}},setup(y){const h=y,g=k({id:void 0,endTime:void 0,startTime:void 0}),r=se(),e=k(!1),i=k([]),b=k(0),T=k(10),m=k({total:-1,pages:-1,current:-1}),D=V(()=>b.value===m.value.pages),p=V(()=>m.value.pages===0);async function O(){if(D.value||p.value||e.value)return;e.value=!0,b.value++;const{data:s,code:u}=h.status===-1?await we(b.value,T.value,g.value||{},r.getToken):await Ie(h.status,b.value,T.value,g.value||{},r.getToken);u===U.SUCCESS?(s.records.length&&i.value.push(...s.records),m.value={total:s.total,pages:s.pages,current:s.current}):_e.error({grouping:!0,message:"获取失败，请稍后再试！"}),setTimeout(()=>{e.value=!1},120)}O();function t(){b.value=0,m.value={total:-1,pages:-1,current:-1},i.value.splice(0),O()}function _(){g.value.startTime=void 0,g.value.endTime=void 0,t()}const S=k(!1);function B(s,u){switch(s){case"cancel":q(u);break;case"toastDelivery":j();break;case"pushRefund":G(u);break;case"checkDelivery":Z(u);break;case"toDelete":X(u);break}}async function q(s){if(s.status===o.UN_PAID)try{if(await P.confirm("是否确认取消订单？","取消提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0})==="confirm"){S.value=!0;const{code:x}=await Te(s.id,r.getToken);S.value=!1,x===U.SUCCESS?(s.updateTime=L(Date.now(),"YYYY-MM-DD HH:mm:ss").value.toString(),s.status=o.CANCELED,I.success({title:"取消成功",message:"订单取消成功，优惠卷等优惠也将原路退回！"})):I.error({title:"订单取消失败，请稍后再试！"})}}catch{S.value=!1}finally{S.value=!1}}function j(){P.alert("我们已收到您的订单，将尽快处理并安排发货！","提 醒",{lockScroll:!1,confirmButtonText:"好 的",center:!0}).catch()}async function X(s){if(!(s.status!==o.REFUND_SUCCESS&&s.status!==o.CANCELED&&s.status!==o.DELAY_CANCELED&&s.status!==o.COMMENTED))try{if(await P.confirm("删除将永久移除该订单及其相关信息，是否确定删除？","删除操作",{center:!0,lockScroll:!1,confirmButtonText:"删 除",confirmButtonClass:"el-button--danger border-default shadow-sm",cancelButtonText:"取 消"})==="confirm"){e.value=!0;const{code:x}=await Oe(s.id,r.getToken);if(e.value=!1,x===U.SUCCESS){for(let w=0;w<i.value.length;w++)if(i.value[w].id===s.id){i.value.splice(w,1);return}I.success({title:"删除提示",message:"订单和相关信息移除成功！"})}else I.error({title:"删除失败，请稍后再试！"})}}catch{e.value=!1}finally{e.value=!1}}async function G(s){if(!(s.status!==o.PAID&&s.status!==o.RECEIVED&&s.status!==o.DELIVERED))try{if(await P.confirm("确认发起退款？😢","退款提示",{center:!0,lockScroll:!1,confirmButtonText:"退 款",confirmButtonClass:"el-button--danger border-default shadow-sm",cancelButtonText:"取 消"})==="confirm"){e.value=!0;const{message:x,code:w}=await Ye(s.id,r.getToken);e.value=!1,w===U.SUCCESS?(s.updateTime=L(Date.now(),"YYYY-MM-DD HH:mm:ss").value.toString(),s.status===o.RECEIVED?(s.status=o.REFUND,I.success({title:"发起退款成功",message:x})):(s.status=o.REFUND_SUCCESS,I.success({title:"发起退款成功",message:"未发货，正在自动退款，请等待！"}))):I.error({title:"发起退款失败，请稍后再试！"})}}catch{e.value=!1}finally{e.value=!1}}async function Z(s){if(s.status===o.DELIVERED)try{if(await P.confirm("是否确认收货？","收货提示",{center:!0,confirmButtonText:"确 认",lockScroll:!1,confirmButtonClass:"el-button--success border-default shadow-sm",cancelButtonText:"取 消"})==="confirm"){e.value=!0;const{code:x}=await Ne(s.id,r.getToken);e.value=!1,x===U.SUCCESS?(s.updateTime=L(Date.now(),"YYYY-MM-DD HH:mm:ss").value.toString(),s.status=o.RECEIVED,I.success({title:"收货成功",message:"收货确认成功！如有任何问题，请随时联系我们的客服。"})):I.error({title:"确认收货失败，请稍后再试！"})}}catch{}finally{e.value=!1}}const c=k(!1),C=k("");function ie(){const s=L(C.value[0],"YYYY-MM-DD HH:mm:ss").value.toString(),u=L(C.value[1],"YYYY-MM-DD HH:mm:ss").value.toString();g.value.startTime=s,g.value.endTime=u,t()}return(s,u)=>{const x=be,w=te,ce=ct,ue=Le,de=$e,me=ne("auto-animate");return f(),z(de,{height:"70vh",class:"group px-2",style:{overflow:"auto"}},{default:d(()=>[l(ue,{immediate:!0,"no-more":a(D)||a(p),loading:a(e),onLoad:O},{done:d(()=>[R(n("p",ft," 暂无更多订单 ",512),[[W,!a(p)]]),R(n("p",pt," 暂无订单，快去下单吧 ~ ",512),[[W,a(p)]])]),default:d(()=>[n("div",ut,[dt,n("div",{class:A(["ml-a flex-row-c-c transform-origin-right scale-x-0 truncate py-1 transition-300 transition-transform",{"scale-x-100":a(c)}])},[l(x,{modelValue:a(C),"onUpdate:modelValue":u[0]||(u[0]=M=>re(C)?C.value=M:null),format:"YYYY-MM-DD HH:mm:ss",type:"datetimerange",size:"small","start-placeholder":"起 始","time-arrow-control":!0,"end-placeholder":"结 束",onChange:ie},null,8,["modelValue"]),l(w,{size:"small","ml-1":"","md:ml-2":"",onClick:_},{default:d(()=>[Y(" 重置 ")]),_:1})],2),l(w,{size:"small","ml-1":"","md:ml-2":"",type:a(c)?"danger":"default",onClick:u[1]||(u[1]=M=>c.value=!a(c))},{default:d(()=>[Y(E(a(c)?"收起":"展开"),1)]),_:1},8,["type"])]),R((f(),v("ul",mt,[(f(!0),v(J,null,K(a(i),M=>(f(),z(ce,{key:M.id,order:M,onSubmit:B},null,8,["order"]))),128))])),[[me,{duration:300,easing:"cubic-bezier(0.61, 0.225, 0.195, 1.19)"}]])]),_:1},8,["no-more","loading"])]),_:1})}}}),vt=y=>(oe("data-v-1d167f00"),y=y(),le(),y),yt={key:0,class:"group min-h-80vh layout-default-se"},ht={class:"top my-4 mb-6 flex-row-bt-c"},gt={flex:"","items-center":""},bt=vt(()=>n("span",{"mr-2":""},"我的订单",-1)),Et={"ml-2":"","text-0.8em":"","opacity-80":""},Dt={key:0,class:"rounded-10px p-6 shadow v-card"},kt=H({__name:"list",setup(y){ve({title:`订单 - ${ge}`,meta:[{name:"description",content:"极物圈 - 我的订单"}]});const h=se(),g=k("all"),r=k(!1);function e(){r.value||(r.value=!0,setTimeout(()=>{r.value=!1},300))}return(i,b)=>{const T=fe,m=ee,D=_t,p=Be,O=Me,t=ye,_=he;return f(),v("div",null,[l(t,{name:"second","left-menu":!1,footer:!1,menu:["back","service"]},{default:d(()=>[n("div",null,[l(m,null,{default:d(()=>{var S;return[(S=a(h))!=null&&S.isLogin?R((f(),v("div",yt,[n("div",ht,[n("h2",gt,[bt,l(T,{direction:"vertical"}),l(m,null,{default:d(()=>[n("span",Et,E(a(h).userInfo.nickname),1)]),_:1})]),n("i",{"opacity-0":"","transition-300":"","group-hover:opacity-100":"",class:"i-solar:refresh-outline block cursor-pointer bg-[var(--el-color-info)] p-0.8em transition-300 hover:rotate-180",onClick:e})]),a(r)?$("",!0):(f(),v("div",Dt,[l(O,{modelValue:a(g),"onUpdate:modelValue":b[0]||(b[0]=B=>re(g)?g.value=B:null),"tab-position":"top",stretch:!0},{default:d(()=>[l(p,{name:"all",label:"全部"},{default:d(()=>[l(D)]),_:1}),l(p,{lazy:"",name:"unpaid",label:"待付款"},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).UN_PAID},null,8,["status"])]),_:1}),l(p,{lazy:"",name:"paid",label:"待发货"},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).PAID},null,8,["status"])]),_:1}),l(p,{name:"received",label:"待收货",lazy:""},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).DELIVERED},null,8,["status"])]),_:1}),l(p,{name:"comment",label:"待评价",lazy:""},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).RECEIVED},null,8,["status"])]),_:1}),l(p,{name:"commented",label:"已评价",lazy:""},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).COMMENTED},null,8,["status"])]),_:1}),l(p,{name:"canceled",label:"已取消",lazy:""},{default:d(()=>[l(D,{status:("OrdersStatus"in i?i.OrdersStatus:a(o)).CANCELED},null,8,["status"])]),_:1})]),_:1},8,["modelValue"])]))])),[[_,a(r),void 0,{fullscreen:!0}]]):$("",!0)]}),_:1})])]),_:1})])}}}),Jt=ae(kt,[["__scopeId","data-v-1d167f00"]]);export{Jt as default};
