import{u as fe,m as pe,S as j,o as we,p as Ue,s as We,B as Q,q as $e,C as Ie,c as Oe,d as ke,g as He,r as Le,h as ue,n as Be,f as se,t as Xe,E as J,v as qe,x as Ye,w as Ke,y as Je,k as Qe,a as Ze,l as et}from"./entry.t-rqPOs0.js";import{_ as ge}from"./ElImage.MMEIiX96.js";import{a as tt,E as ot}from"./index.8LNiojwe.js";import{_ as De}from"./AutoIncre.vue.cpfunnOh.js";import{j as Y,a as S,k as W,D as st,ap as nt,O as w,P as U,Q as C,$ as y,u as o,x as Z,a2 as M,a0 as te,ad as be,a5 as H,Z as ie,a7 as V,as as re,ab as ze,at as Te,an as xe,ao as Me,I as Ge,E as Ae,b as X,X as ve,a8 as q,Y as Ne,n as me,a6 as ee,ac as at,ak as lt,o as rt}from"./swiper-vue.Dj7aAS3P.js";/* empty css              *//* empty css                    */import{E as de}from"./notification.YJSnxgg5.js";import{u as oe,R as $,g as ye,a as it,M as K,b as ct,c as ut}from"./contact.O0MKBF5K.js";import{e as Fe,_ as dt,g as mt,C as ft,a as F,b as pt,c as gt,d as _t,f as ht,h as vt}from"./Main.vue.XLnSog5g.js";import{F as Ve,i as yt}from"./friend.psniISnN.js";import{u as _e,W as Ce,a as Ct}from"./useWs.cWBkfbdz.js";import{E as Se}from"./tag.C0ahusY6.js";import{E as Pe}from"./scrollbar.VqFpSCdd.js";import{E as bt,a as wt}from"./select.CPu1gYEQ.js";import{_ as It}from"./OssFileUpload.AYjrnYRm.js";import{_ as kt}from"./nuxt-link.AUBdcVxd.js";import"./popper.b7Al0Wsi.js";import{O as Lt,d as Tt}from"./index.keDQovFV.js";import"./debounce.0E-5_dMF.js";import"./strings.Y1vdtDWm.js";import"./isEqual.OSnr_sHV.js";import"./hasIn.6fummut8.js";import"./index.dh5FAeg5.js";import"./progress.FoUIz2xX.js";const xt=Te(()=>Le(()=>import("./NewGroupDialog.ByLeF4p0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url).then(I=>I.default||I)),je=I=>(xe("data-v-32c1d647"),I=I(),Me(),I),Mt={relative:""},St={class:"mb-4 py-2 v-card","flex-row-c-c":""},Et=je(()=>C("i",{"i-carbon:add-large":"","p-2":""},null,-1)),Rt={"w-full":"",flex:"","flex-col":""},$t=["onContextmenu"],Ut={class:"flex flex-1 flex-col justify-between truncate"},Ot={truncate:""},Bt={class:"flex"},Dt={"ml-a":"","mt-a":"",hidden:"","w-7em":"","flex-shrink-0":"",truncate:"","text-right":"","text-0.7em":"","op-35":"","sm:block":"","group-hover:op-70":""},zt=je(()=>C("small",{class:"block w-full text-center text-0.8rem opacity-60"}," 暂无更多 ",-1)),Gt=Y({__name:"ContactList",props:{dto:{}},setup(I){const x=I,c=S(!1),n=fe(),a=oe(),l=S({cursor:null,isLast:!1,size:10}),i=S(""),L=W(()=>a.contactList.sort((m,t)=>t.activeTime-m.activeTime).filter(m=>m.name.includes(i.value)));async function g(m){if(c.value||l.value.isLast)return;c.value=!0;const{data:t}=await it(l.value.size,l.value.cursor,n.getToken);t.list&&((m==null?void 0:m.type)===$.GROUP?t.list.forEach(e=>{e.type===$.GROUP&&a.contactList.push(e)}):(m==null?void 0:m.type)===$.SELFT?t.list.forEach(e=>{e.type===$.SELFT&&a.contactList.push(e)}):a.contactList.push(...t.list)),l.value.isLast=t.isLast,l.value.cursor=t.cursor,c.value=!1}st(()=>{k()});const A=pe(),O=Date.now();function z(m){return O-+m>24*3600?$e(m,"YYYY-MM-DD").value.toString():$e(m,"HH:mm:ss").value.toString()}const T=oe(),_=W({get(){return T.theContact.roomId},set(m){const t=a.contactList.find(e=>e.roomId===m);t&&(t.type===$.SELFT?T.setContact(t):(async()=>{var s,u;const e=await ye(m,t==null?void 0:t.type,n.getToken);e&&e.code===j.SUCCESS&&(T.setContact(e==null?void 0:e.data),t&&(t.roomGroup=(s=e==null?void 0:e.data)==null?void 0:s.roomGroup,t.member=(u=e==null?void 0:e.data)==null?void 0:u.member))})(),A.isOpenContact=!1)}});function k(m=15,t,e=!0,s){e?(a.contactList=[],l.value.cursor=null,l.value.isLast=!1,l.value.size=m,g(t||x.dto)):s&&f(s)}async function f(m){if(!m)return;const t=a.contactList.findIndex(s=>s.roomId===m);if(t===-1)return;const e=await ye(m,$.GROUP,n.getToken);e&&(a.contactList[t]=e.data)}T.onReloadContact=k;const r=S(!1),p=S(),b=we();function d(m,t){m.preventDefault();const e={x:m.x,y:m.y,theme:b.preference==="dark"?"mac dark":"wind10",items:[]};t.type===$.GROUP?e.items=[{customClass:"group",icon:"i-solar:user-speak-broken group-btn-warning group-hover:i-solar:user-speak-bold-duotone",label:"邀请好友",onClick:()=>{var s,u,v;(s=p.value)!=null&&s.reload&&((u=p.value)==null||u.reload()),(v=p.value)!=null&&v.form&&(p.value.form.roomId=t.roomId,r.value=!0)}},{icon:"i-solar:logout-3-broken group-btn-error group-hover:i-solar:logout-3-bold-duotone",label:"退出群聊",customClass:"group",onClick:()=>{ue.confirm("是否退出该群聊？",{confirmButtonText:"退出",center:!0,cancelButtonText:"取消",lockScroll:!1,callback:async s=>{s==="confirm"&&(await Fe(t.roomId,n.getToken)).code===j.SUCCESS&&(de.success("退出成功！"),a.theContact.roomId===t.roomId&&a.setContact(),a.contactList=a.contactList.filter(v=>v.roomId!==t.roomId))}})}}]:t.type===$.SELFT&&(e.items=[{customClass:"group",icon:"i-solar:user-outline group-btn-info group-hover:i-solar:user-bold-duotone",label:"联系人",onClick:()=>{a.setTheFriendOpt(Ve.Empty),Be("/chat/friend")}}]),Ie.showContextMenu(e)}const h=_e();return Ue(()=>h.wsMsgList.memberMsg,async m=>{if(m.length){for(const t of m)if(t.changeType===Ce.JOIN){const e=a.contactList.findIndex(u=>u.roomId===t.roomId),s=await ye(t.roomId,$.GROUP,n.getToken);s&&(e>-1?a.contactList[e]=s.data:(s.data.unreadCount=1,a.contactList[e]&&a.contactList.unshift(s.data)))}else if(t.changeType===Ce.LEAVE){for(let e=0;e<a.onOfflineList.length;e++)if(a.onOfflineList[e].userId===t.uid){a.onOfflineList.splice(e,1);break}}else if(t.changeType===Ce.DEL){for(let e=0;e<a.contactList.length;e++)if(a.contactList[e].roomId===t.roomId){a.contactList.splice(e,1);break}}h.wsMsgList.memberMsg.splice(0)}},{deep:!0,immediate:!0}),(m,t)=>{const e=Oe,s=ke,u=ge,v=He,D=tt,G=De,N=ot,P=xt,ne=nt("auto-animate");return w(),U("div",Mt,[C("div",St,[y(e,{modelValue:o(i),"onUpdate:modelValue":t[0]||(t[0]=E=>Z(i)?i.value=E:null),modelModifiers:{lazy:!0},class:"mr-2",type:"text",clearable:"",autocomplete:"off","prefix-icon":"ElIconSearch"in m?m.ElIconSearch:o(We),minlength:"2",maxlength:"30",placeholder:"搜索"},null,8,["modelValue","prefix-icon"]),y(s,{plain:"",style:{width:"2rem",transition:"200ms"},loading:o(c),onClick:t[1]||(t[1]=E=>r.value=!0)},{default:M(()=>[Et]),_:1},8,["loading"])]),y(N,{modelValue:o(_),"onUpdate:modelValue":t[3]||(t[3]=E=>Z(_)?_.value=E:null),class:"w-full"},{default:M(()=>[ze((w(),U("div",Rt,[y(G,{immediate:!0,"auto-stop":!1,"no-more":o(l).isLast,loading:o(c),onLoad:t[2]||(t[2]=E=>g(m.dto))},{done:M(()=>[zt]),default:M(()=>[(w(!0),U(te,null,re(o(L),E=>(w(),V(D,{key:E.roomId,style:{overflow:"hidden"},border:"",label:E.roomId},{default:M(()=>[C("div",{class:"group flex gap-2 truncate bg-white p-2 transition-200 transition-shadow sm:w-full dark:bg-dark md:p-4 text-color",onContextmenu:be(B=>d(B,E),["stop"])},[y(v,{hidden:!E.unreadCount,max:99,value:E.unreadCount,class:"h-2.6rem w-2.6rem flex-shrink-0"},{default:M(()=>[y(u,{src:("BaseUrlImg"in m?m.BaseUrlImg:o(Q))+E.avatar,fit:"cover",class:"h-2.6rem w-2.6rem object-cover border-default card-default"},null,8,["src"])]),_:2},1032,["hidden","value"]),C("div",Ut,[C("p",Ot,H(E.name),1),C("div",Bt,[C("small",{"overflow-hidden":"",truncate:"","op-70":"",class:ie({"text-[var(--el-color-info)] font-600":E.unreadCount})},H(E.text),3),C("span",Dt,H(z(E.activeTime)),1)])])],40,$t)]),_:2},1032,["label"]))),128))]),_:1},8,["no-more","loading"])])),[[ne]])]),_:1},8,["modelValue"]),y(P,{ref_key:"ChatNewGroupDialogRef",ref:p,modelValue:o(r),"onUpdate:modelValue":t[4]||(t[4]=E=>Z(r)?r.value=E:null)},null,8,["modelValue"])])}}}),At=se(Gt,[["__scopeId","data-v-32c1d647"]]),Nt=Y({__name:"ContactTabs",setup(I){S("all"),S([{name:"all",title:"全部"},{name:"group",title:"群聊",dto:{type:$.GROUP}},{name:"self",title:"个人",dto:{type:$.SELFT}}]);const x=pe();return(c,n)=>{const a=At;return w(),U("div",{class:ie(["group absolute z-4 h-full w-0 flex-shrink-0 overflow-hidden pl-4.5rem transition-300 transition-property-all sm:relative sm:left-0 sm:top-0 sm:w-1/4 sm:pl-0",o(x).isOpenContact?"w-100% sm:w-1/4":""])},[y(a,{class:"p-4"})],2)}}}),Ft={key:"load","w-full":"","flex-row-c-c":"","py-2":"","text-center":"","text-bluegray":""},Vt={key:1,class:"animate-fade-in"},Pt=Y({__name:"DisAutoIncre",props:{noMore:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0},delay:{default:400},loading:{type:Boolean,default:!1},loadingClass:{default:"mx-a my-0.6em h-1.4rem w-1.4rem animate-[spin_2s_infinite_linear] rounded-6px bg-[var(--el-color-primary)]"},autoStop:{type:Boolean,default:!0}},emits:["load"],setup(I,{expose:x,emit:c}){const n=I,a=c,l=S();Ge(()=>{n.immediate&&a("load")});const i=S(!1);let L=null;const{stop:g,isSupported:A}=Xe(l,([T])=>{i.value=T.isIntersecting,T.isIntersecting?(clearInterval(L),O&&O(),L=setInterval(O,n.delay*2)):clearInterval(L)});function O(){n.noMore&&n.autoStop?(cancelAnimationFrame(L),clearInterval(L),g&&g()):a("load")}n.immediate&&a("load"),Ae(()=>{cancelAnimationFrame(L),clearInterval(L),g(),L=null}),X(()=>n.noMore,T=>{T&&n.autoStop&&(cancelAnimationFrame(L),g&&g())}),X(()=>n.loading,T=>{T&&requestAnimationFrame(O)});const z=W(()=>n.loading||!n.noMore);return x({stop:g,loadMoreRef:l}),(T,_)=>(w(),U(te,null,[o(z)?(w(),U("div",{ref_key:"loadMoreRef",ref:l,key:"loadMoreRef",class:"min-h-1em"},[ve(T.$slots,"load",{},()=>[C("div",Ft,[C("div",{class:ie(T.loadingClass)},null,2)])])],512)):(w(),U("div",Vt,[ve(T.$slots,"done",{},()=>[!T.noMore&&!T.loading?(w(),U("div",{key:"done","h-2":"","w-full":"","text-center":"","text-bluegray":"",onClick:_[0]||(_[0]=k=>!o(A)&&T.$emit("load"))})):q("",!0)])])),ve(T.$slots,"default")],64))}}),jt=Y({__name:"MessageList",setup(I,{expose:x}){const c=oe(),n=S(!1),a=fe(),l=_e(),i=S({cursor:null,isLast:!1,size:20});async function L(f){n.value||i.value.isLast||!c.theContact.roomId||(n.value=!0,ct(c.theContact.roomId,i.value.size,i.value.cursor,a.getToken).then(({data:r})=>{r.list&&r.list.length&&c.theContact.msgList.unshift(...r.list);const p=c.scrollTopSize;me(()=>{if(c.saveScrollTop&&c.saveScrollTop(),i.value.cursor===null)f&&f();else{const d=c.scrollTopSize-p;d>0&&c.scrollTop(d)}i.value.isLast=r.isLast,i.value.cursor=r.cursor,n.value=!1})}).catch(()=>{n.value=!1,i.value.isLast=!1,i.value.cursor=null}))}X(()=>c.theContact.roomId,f=>{g(),f&&(c.setReadList(f),c.scrollBottom())},{immediate:!0});function g(){c.theContact.msgList=[],i.value={cursor:null,isLast:!1,size:20},c.scrollTopSize=0,L(()=>{c.scrollBottom()})}X(()=>l.wsMsgList.newMsg,f=>{A(f)},{deep:!0}),X(()=>l.wsMsgList.recallMsg,f=>{O(f)},{deep:!0}),X(()=>l.wsMsgList.deleteMsg,f=>{z(f)},{deep:!0});function A(f){for(let r=0;r<f.length;r++){const p=f[r];if(T(p.message.roomId,{text:`${p.fromUser.nickName}：${p.message.content}`},!1,d=>{d.roomId!==c.theContact.roomId&&(d.unreadCount+=1),d.activeTime=Date.now()}),p.message.roomId!==c.theContact.roomId)continue;l.wsMsgList.newMsg.splice(r,1),c.setReadList(c.theContact.roomId),k(p.message.id)||c.theContact.msgList.push(p)}}function O(f){for(let r=0;r<f.length;r++){const p=f[r];for(let d=0;d<c.contactList.length;d++){const h=c.contactList[d];if(h.roomId===p.roomId){h.text="撤回了一条消息";break}}if(p.roomId!==c.theContact.roomId)continue;l.wsMsgList.recallMsg.splice(r,1);const b=k(p.msgId);b&&(b.message.type=K.RECALL,b.message.content=`${c.theContact.type===$.GROUP?`"${b.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,b.message.body=void 0,l.wsMsgList.recallMsg=l.wsMsgList.recallMsg.filter(d=>d.msgId!==p.msgId))}}function z(f){for(let r=0;r<f.length;r++){const p=f[r];for(let d=0;d<c.contactList.length;d++){const h=c.contactList[d];if(h.roomId===p.roomId){h.text="删除了一条消息";break}}if(p.roomId!==c.theContact.roomId)continue;l.wsMsgList.deleteMsg.splice(r,1);const b=k(p.msgId);b&&(b.message.type=K.DELETE,b.message.content=`${c.theContact.type===$.GROUP?`"${b.fromUser.nickName}"`:'"对方"'}删除了一条消息`,b.message.body=void 0,l.wsMsgList.deleteMsg=l.wsMsgList.deleteMsg.filter(d=>d.msgId!==p.msgId))}}function T(f,r,p=!1,b){for(let d=0;d<c.contactList.length;d++){const h=c.contactList[d];h.roomId===f&&(h.text=r.text||h.text,h.unreadCount=r.unreadCount||h.unreadCount,h.activeTime=r.activeTime||h.activeTime,h.avatar=r.avatar||h.avatar,b&&b(h))}}function _(f){f&&c.theContact.msgList.push(f)}function k(f){for(const r of c.theContact.msgList)if(r.message.id===f)return r}return x({reload:g,appendMsg:_,findMsg:k}),(f,r)=>{const p=dt,b=Pt;return w(),U("div",Ne({relative:""},f.$attrs,{flex:"","flex-col":"",class:"msg-list"}),[y(b,{"auto-stop":!1,"no-more":o(i).isLast,loading:o(n),"loading-class":"mx-a mb-2 h-1rem w-1rem animate-[spin_2s_infinite_linear] rounded-4px bg-[var(--el-color-primary)] py-0.4em",onLoad:L},{default:M(()=>[(w(!0),U(te,null,re(o(c).theContact.msgList,(d,h)=>(w(),V(p,{id:`chat-msg-${d.message.id}`,key:d.message.id,index:h,class:"animate-[0.2s_zoom-in]",data:d},null,8,["id","index","data"]))),128))]),_:1},8,["no-more","loading"])],16)}}}),Wt=se(jt,[["__scopeId","data-v-e67e74db"]]),Ht=Y({__name:"MsgContentCard",props:{data:{}},setup(I){return(x,c)=>{var n,a,l,i;return w(),U("div",null,H(`${(a=(n=x.data)==null?void 0:n.fromUser)==null?void 0:a.nickName}:${(i=(l=x.data)==null?void 0:l.message)==null?void 0:i.content}`),1)}}}),Xt=se(Ht,[["__scopeId","data-v-7491fff6"]]),qt=I=>(xe("data-v-c54b18ee"),I=I(),Me(),I),Yt={class:"w-full flex animate-[300ms_fade-in] items-center rounded-6px bg-[#ffffff9c] p-2 shadow backdrop-blur-10px border-default dark:bg-dark"},Kt={class:"flex flex-col rounded-b-0 px-4 py-2 shadow card-default"},Jt={class:"relative flex grid-gap-4"},Qt=qt(()=>C("i",{"i-solar:double-alt-arrow-down-line-duotone":"","p-3":""},null,-1)),Zt=[Qt],eo={"my-4":"",flex:"","items-end":"","gap-3":""},to=Y({__name:"MsgForm",emits:["submit"],setup(I,{emit:x}){const c=x,n=fe(),a=oe(),l=S({roomId:a.theContact.roomId,msgType:K.TEXT,content:"",body:{}}),i=S();X(()=>{var t,e;return(e=(t=a.replyMsg)==null?void 0:t.message)==null?void 0:e.id},t=>{l.value.body.replyMsgId=t,me(()=>{var e;i.value&&((e=i.value)==null||e.focus())})});const L=S(),g=S([]);function A(t,e,s){var v;const u=g.value.find(D=>D.key===t);if(t&&(u!=null&&u.file)){const D=window.URL||window.webkitURL;let G=0,N=0;const P=new Image;P.src=D.createObjectURL(u==null?void 0:u.file),P.onload=function(){G=P.width||0,N=P.height||0},l.value={roomId:a.theContact.roomId,msgType:K.IMG,content:l.value.content,body:{url:t,width:G,height:N,size:(v=u==null?void 0:u.file)==null?void 0:v.size}}}}const O=S();function z(){var t,e,s;if((t=l.value.content)==null||t.trim().replace(/\n$/g,""),!((e=l.value.content)!=null&&e.trim())){J.warning("不能发送空白消息！");return}(s=O.value)==null||s.validate(async u=>{var D;if(l.value.msgType===K.TEXT&&(!l.value.content||((D=l.value.content)==null?void 0:D.trim().length)>500)&&J.error("消息内容不能超过500字！"),!u)return;const v=await ut({...l.value,roomId:a.theContact.roomId},n.getToken);v.code===j.SUCCESS&&c("submit",v.data),l.value.content="",_()})}let T=0;X(()=>a.theContact.roomId,()=>{var t;_(),i.value&&((t=i.value)==null||t.focus())}),Ae(()=>{clearTimeout(T),clearInterval(T),T=null});function _(){l.value={roomId:a.theContact.roomId,msgType:K.TEXT,content:"",body:{atUidList:[]}},g.value=[],a.atUserList.splice(0),a.setReplyMsg({})}X(()=>a.theContact.roomId,()=>{_(),h()});function k(){a.theContact.roomId&&(a.setReadList(a.theContact.roomId),a.scrollBottom())}const f=we();function r(t,e,s=0){t.preventDefault();const u={x:t.x,y:t.y,theme:f.preference==="dark"?"mac dark":"wind10",items:[{customClass:"group",icon:"i-solar:trash-bin-minimalistic-outline group-btn-danger",label:"删除图片",onClick:async()=>{if(!e)return;const v=await Tt(e,n.getToken);v.code===j.SUCCESS?(g.value.splice(s,1),J.success("删除成功")):v.code===j.DELETE_ERR&&g.value.splice(s,1),L==null||L.value.resetInput()}}]};Ie.showContextMenu(u)}const p=W(()=>!(n!=null&&n.isLogin)),b=S(),d=S([]);async function h(){var e;if(!a.theContact.roomId||a.theContact.type!==$.GROUP)return;const{data:t}=await mt(a.theContact.roomId,n.getToken);t.value&&t.value.code===j.SUCCESS&&(d.value=((e=t.value)==null?void 0:e.data)||[])}const m=W(()=>a.theContact.unReadLength);return Ge(()=>{h()}),(t,e)=>{const s=Se,u=qe,v=ge,D=Xt,G=bt,N=wt,P=It,ne=kt,E=Oe,B=ke,ae=Ye;return w(),V(ae,{ref_key:"formRef",ref:O,model:o(l),disabled:o(p),class:"w-full",onSubmit:be(z,["prevent"])},{default:M(()=>{var Ee;return[ze(y(u,{class:"w-full cursor-pointer",style:{padding:"0 0.5rem",margin:"0","margin-bottom":"0.4rem",display:"flex","justify-content":"right"},onClick:k},{default:M(()=>[y(s,{type:"warning",effect:"light",round:"",class:"ml-a"},{default:M(()=>[ee(" 有"+H(o(m))+"条新消息 ",1)]),_:1})]),_:1},512),[[at,o(m)]]),o(g).length>0?(w(),V(u,{key:0,class:"w-full cursor-pointer",style:{padding:"0 0.5rem",margin:"0","margin-bottom":"0.4rem",display:"flex","justify-content":"center","grid-gap":"0.2rem","margin-left":"auto"}},{default:M(()=>[(w(!0),U(te,null,re(o(g),(R,le)=>(w(),V(v,{key:le,"preview-teleported":"",loading:"lazy","preview-src-list":[R.id||("BaseUrlImg"in t?t.BaseUrlImg:o(Q))+R.key],src:R.id||("BaseUrlImg"in t?t.BaseUrlImg:o(Q))+R.key,class:"ml-a h-8rem w-8rem overflow-hidden rounded-6px p-2 border-default card-default",onContextmenu:ce=>r(ce,R.key,le)},null,8,["preview-src-list","src","onContextmenu"]))),128))]),_:1})):q("",!0),(Ee=o(a).replyMsg)!=null&&Ee.fromUser?(w(),V(u,{key:1,prop:"body.replyMsgId",class:"w-full",style:{padding:"0.4rem",margin:"0","margin-bottom":"0.2rem",display:"flex"}},{default:M(()=>[C("div",Yt,[y(s,{effect:"dark",class:"mr-2"},{default:M(()=>[ee(" 回复 ")]),_:1}),y(D,{class:"w-4/5 truncate",data:o(a).replyMsg},null,8,["data"]),C("div",{class:"i-solar:close-circle-bold text-dark op-80 transition-200 transition-color btn-default dark:text-light hover:text-[var(--el-color-danger)]","h-2em":"","w-2em":"",onClick:e[0]||(e[0]=R=>o(a).setReplyMsg({}))})])]),_:1})):q("",!0),C("div",Kt,[C("div",Jt,[o(a).theContact.type===("RoomType"in t?t.RoomType:o($)).GROUP?(w(),V(u,{key:0,disabled:o(l).msgType!==("MessageType"in t?t.MessageType:o(K)).TEXT,style:{padding:"0",margin:"0"},prop:"body.atUidList",class:"at-select w-12rem"},{default:M(()=>[y(N,{ref_key:"atSelectRef",ref:b,modelValue:o(a).atUserList,"onUpdate:modelValue":e[1]||(e[1]=R=>o(a).atUserList=R),disabled:o(l).msgType!==("MessageType"in t?t.MessageType:o(K)).TEXT,max:20,"max-collapse-tags":1,clearable:"",filterable:"","collapse-tags":"",multiple:"","default-first-option":"","reserve-keyword":!0,placeholder:"@其他人",onChange:e[2]||(e[2]=R=>o(l).body.atUidList=R)},{default:M(()=>[(w(!0),U(te,null,re(o(d),R=>(w(),V(G,{key:R.userId,value:R.userId,label:`@${R.nickName}`},null,8,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["disabled"])):q("",!0),y(u,{style:{cursor:"pointer",padding:"0",margin:"0"},prop:"body.url",class:"cursor-pointer"},{default:M(()=>[y(P,{ref_key:"inputOssFileUploadRef",ref:L,modelValue:o(g),"onUpdate:modelValue":e[3]||(e[3]=R=>Z(g)?g.value=R:null),multiple:!1,preview:!1,limit:1,class:"i-solar:album-line-duotone h-1.5rem w-1.5rem cursor-pointer","upload-type":("OssFileType"in t?t.OssFileType:o(Lt)).IMAGE,"input-class":"op-0 h-1.5rem w-1.5rem cursor-pointer ","upload-quality":.5,onErrorMsg:e[4]||(e[4]=R=>{("ElMessage"in t?t.ElMessage:o(J)).error(R)}),onSubmit:A},null,8,["modelValue","upload-type"])]),_:1}),C("div",{class:"ml-a w-fit flex-row-c-c px-2 transition-200 btn-primary",onClick:e[5]||(e[5]=R=>o(a).scrollBottom())},Zt)]),C("div",eo,[y(ne,{to:"/user/info",class:"flex-row-c-c"},{default:M(()=>[y(v,{src:o(n).userInfo.avatar?("BaseUrlImg"in t?t.BaseUrlImg:o(Q))+o(n).userInfo.avatar:"",class:"block h-2rem w-2rem rounded-1/2 shadow-sm"},null,8,["src"])]),_:1}),y(u,{prop:"content",style:{padding:"0",margin:"0"},class:"w-full",rules:[{min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"change"}]},{default:M(()=>{var R,le,ce;return[y(E,{ref_key:"inputRef",ref:i,modelValue:o(l).content,"onUpdate:modelValue":e[6]||(e[6]=Re=>o(l).content=Re),modelModifiers:{lazy:!0},autosize:{minRows:1,maxRows:4},rows:(R=o(l))!=null&&R.content&&((ce=(le=o(l))==null?void 0:le.content)==null?void 0:ce.length)>30?4:1,maxlength:500,placeholder:"来聊点什么吧 ✨",type:"textarea",class:ie(["input",{focused:o(l).content}]),onKeyup:e[7]||(e[7]=lt(be(Re=>z(),["prevent"]),["enter"]))},null,8,["modelValue","rows","class"])]}),_:1}),y(B,{round:"",disabled:!o(n).isLogin,"transition-icon":"",class:"group ml-a","icon-class":"i-solar:map-arrow-right-bold-duotone block -rotate-45 mr-1",type:"info",onClick:e[8]||(e[8]=R=>z())},{default:M(()=>[ee(" 发送  ")]),_:1},8,["disabled"])])])]}),_:1},8,["model","disabled"])}}}),oo=se(to,[["__scopeId","data-v-c54b18ee"]]),so={class:"relative flex flex-col"},no={class:"flex-row-bt-c border-0 border-b-1 rounded-0 p-4 border-default card-default md:p-4"},ao={"w-full":"",flex:"","flex-shrink-0":"","items-center":"","gap-3":""},lo={class:"relative mt-a flex-1 bg-light-5 shadow-sm dark:bg-dark-9"},ro={key:1,class:"h-full w-full flex items-center justify-center"},io={flex:"","flex-col":""},co=Y({__name:"Content",props:{roomId:{}},setup(I){const x=oe(),c=_e(),n=pe(),a=W(()=>{var k;let _="";switch((k=x==null?void 0:x.theContact)==null?void 0:k.type){case $.GROUP:_="群";break;case $.SELFT:_="私";break;case $.AICHAT:_="AI";break}return _}),l=S(),i=S();function L(_){O()}const g=S(0);function A(_,k=0){if(!_)return;const f=-10,r=document.querySelector(`#chat-msg-${_}`);if(r)clearTimeout(g.value),g.value=null;else{g.value=setTimeout(()=>{var p;(p=i==null?void 0:i.value)==null||p.setScrollTop(0),A(_,k),r&&(g.value&&clearTimeout(g.value),g.value=null)},500);return}me(()=>{var p,b,d,h,m;r&&(clearTimeout(g.value),(b=(p=i.value)==null?void 0:p.wrapRef)!=null&&b.scrollTo?(h=(d=i.value)==null?void 0:d.wrapRef)==null||h.scrollTo({top:((r==null?void 0:r.offsetTop)||0)+f,behavior:"smooth"}):(m=i.value)==null||m.setScrollTop(((r==null?void 0:r.offsetTop)||0)+f),r.classList.add("reply-shaing"),g.value=setTimeout(()=>{r.classList.remove("reply-shaing"),g.value=null},3e3))})}function O(_=!0){g.value=setTimeout(()=>{var k,f,r,p,b,d,h;_?(p=(k=i.value)==null?void 0:k.wrapRef)==null||p.scrollTo({top:((r=(f=i==null?void 0:i.value)==null?void 0:f.wrapRef)==null?void 0:r.scrollHeight)||0,behavior:"smooth"}):(h=i.value)==null||h.setScrollTop(((d=(b=i==null?void 0:i.value)==null?void 0:b.wrapRef)==null?void 0:d.scrollHeight)||0)},200)}function z(){var _,k;x.scrollTopSize=(k=(_=i==null?void 0:i.value)==null?void 0:_.wrapRef)==null?void 0:k.scrollHeight}function T(_){var k;(k=i.value)==null||k.scrollTo({top:_||0})}return me(()=>{x.scrollBottom=O,x.scrollReplyMsg=A,x.saveScrollTop=z,x.scrollTop=T,O()}),rt(()=>{g.value&&clearTimeout(g.value),g.value=null}),(_,k)=>{const f=ge,r=Se,p=Wt,b=Pe,d=oo;return w(),U("div",so,[C("h4",no,[C("div",ao,[y(f,{src:("BaseUrlImg"in _?_.BaseUrlImg:o(Q))+o(x).theContact.avatar,class:"h-2.2rem w-2.2rem object-cover border-default card-default"},null,8,["src"]),C("span",null,H(o(x).theContact.name),1),y(r,{effect:"dark",size:"small"},{default:M(()=>[ee(H(o(a)),1)]),_:1}),o(c).status===o(Ct).OPEN?(w(),U("i",{key:0,circle:"",plain:"",class:"ml-a btn-danger",transition:"all  op-60 group-hover:op-100 300  cubic-bezier(0.61, 0.225, 0.195, 1.3)","i-solar:power-bold":"","p-2.2":"",onClick:k[0]||(k[0]=h=>o(c).close())})):q("",!0),o(x).theContact.type===("RoomType"in _?_.RoomType:o($)).GROUP?(w(),U("i",{key:1,class:"flex-row-c-c grid-gap-2 btn-primary",transition:"all  op-60 group-hover:op-100 300  cubic-bezier(0.61, 0.225, 0.195, 1.3)","i-solar:users-group-two-rounded-bold-duotone":"","p-2.2":"",onClick:k[1]||(k[1]=h=>o(n).isOpenGroupMember=!o(n).isOpenGroupMember)})):q("",!0)])]),C("div",lo,[y(b,{ref_key:"scrollbarRef",ref:i,class:"stop-transition","wrap-class":"h-65vh px-0 sm:px-2","view-class":"msg-list h-65vh"},{default:M(()=>[o(x).theContact.roomId?(w(),V(p,{key:0,ref_key:"ChatMessageListRef",ref:l,class:"pb-7rem pt-2rem sm:pb-8rem",onScrollBottom:O},null,512)):(w(),U("div",ro," 开启聊天吧 "))]),_:1},512),C("div",io,[y(d,{class:"absolute bottom-0 left-0 z-2",onSubmit:L})])])])}}}),uo=se(co,[["__scopeId","data-v-6fcfcf7f"]]),mo=Te(()=>Le(()=>import("./NewGroupDialog.ByLeF4p0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33]),import.meta.url).then(I=>I.default||I)),fo=Te(()=>Le(()=>import("./ApplyDialog.D1NickFR.js"),__vite__mapDeps([34,35,4,2,3,5,21,22,23,24,31]),import.meta.url).then(I=>I.default||I)),he=I=>(xe("data-v-2db30174"),I=I(),Me(),I),po=he(()=>C("i",{class:"sm:h-1.8em sm:w-1.8em"},null,-1)),go=he(()=>C("span",null," 群成员 ",-1)),_o=["onContextmenu","onClick"],ho={class:"relative flex-row-c-c"},vo=he(()=>C("span",{class:"g-avatar"},null,-1)),yo={hidden:"",truncate:"","md:inline-block":""},Co={class:"tags ml-a block hidden pl-1 sm:block"},bo=he(()=>C("p",{"mx-a":"",hidden:"",truncate:"","text-center":"","text-0.8em":"","op-60":"","sm:block":""}," 暂无更多 ",-1)),wo={hidden:"","sm:block":""},Io=Y({__name:"RoomGroup",setup(I){const x=pt,c=_e(),n=oe(),a=pe(),l=S(!1),i=fe(),L=S({cursor:null,isLast:!1,size:15});n.onOfflineList.splice(0);async function g(){if(l.value||L.value.isLast||n.theContact.type!==$.GROUP)return;l.value=!0;const{data:e}=await gt(n.theContact.roomId,L.value.size,L.value.cursor,i.getToken);L.value.isLast=e.isLast,L.value.cursor=e.cursor,e.list&&n.onOfflineList.push(...e.list),l.value=!1}function A(){n.onOfflineList=[],L.value={cursor:null,isLast:!1,size:15},l.value||(l.value=!1,g())}const O=S(),z=S(),T=W(()=>{var e,s;return(s=(e=n.theContact)==null?void 0:e.member)==null?void 0:s.role}),_=W(()=>{var e,s;return((s=(e=n.theContact)==null?void 0:e.member)==null?void 0:s.role)===F.OWNER}),k=W(()=>{var e,s,u,v;return((s=(e=n.theContact)==null?void 0:e.member)==null?void 0:s.role)===F.OWNER||((v=(u=n.theContact)==null?void 0:u.member)==null?void 0:v.role)===F.ADMIN}),f=we();function r(e,s){e.preventDefault();const u=i.userInfo.id===s.userId;Ie.showContextMenu({x:e.x,y:e.y,theme:f.preference==="dark"?"mac dark":"wind10",items:[{label:"@ 他",hidden:u,onClick:()=>{n.setAtUid(s.userId)}},{icon:"btn-info i-solar:user-bold ",label:"联系他",hidden:u,onClick:()=>{n.setTheFriendOpt(Ve.User,{id:s.userId}),Be({path:"/chat/friend",query:{id:s.userId},replace:!1})}},{label:"添加好友",icon:"i-carbon:add-large btn-info",hidden:u,onClick:()=>{yt({uidList:[s.userId]},i.getToken).then(v=>{if(v.code!==j.SUCCESS)return J.error(v.msg||"申请失败，请稍后再试！");const D=v.data.checkedList.find(G=>G.uid===s.userId);if(D&&D.isFriend)return J.error("申请失败，和对方已是好友！");O.value=s,z.value=!0}).catch(()=>{})}},{label:"管理员",icon:"i-solar:shield-user-bold-duotone btn-warning",hidden:u||!_.value,children:[{label:"添加",hidden:s.roleType===F.ADMIN,icon:"i-carbon:add-large btn-info",onClick:()=>{p({userId:s.userId,roomId:n.theContact.roomId},F.ADMIN)}},{label:"移除",hidden:!s.roleType||s.roleType!==F.ADMIN,onClick:()=>{p({userId:s.userId,roomId:n.theContact.roomId},F.MEMBER)}}]},{label:"其他",children:[{label:"分享",icon:"i-solar:share-line-duotone",onClick:async()=>{await Je(`${window.location.origin}/user/info?id=${s.userId}`),J.success({message:"成功复制至剪贴板！",grouping:!0})}}]},{label:"踢出群聊",icon:"i-solar:logout-3-broken",hidden:u||!k.value,onClick:()=>{ue.confirm("是否将该用户踢出群聊？",{center:!0,confirmButtonText:"踢出",cancelButtonText:"取消",confirmButtonClass:"btn-error",lockScroll:!1,callback:async v=>{v==="confirm"&&(await _t(n.theContact.roomId,s.userId,i.getToken)).code===j.SUCCESS&&(de.success("踢出成功！"),n.onOfflineList=n.onOfflineList.filter(G=>G.userId!==s.userId))}})}}]})}function p(e,s){const u=s===F.ADMIN;ue.confirm(`是否将该用户${u?"设为":"取消"}管理员？`,{center:!0,confirmButtonText:"确定",cancelButtonText:"取消",lockScroll:!1,callback:async v=>{if(v==="confirm"&&(await(u?ht:vt)(e,i.getToken)).code===j.SUCCESS){de.success("操作成功！");for(const N of n.onOfflineList)if(N.userId===e.userId)return N.roleType=s}}})}Ke(()=>n.theContact.roomId,e=>{e&&n.theContact.type===$.GROUP&&A()}),Ue(()=>c.wsMsgList.onlineNotice,e=>{if(e.length)for(const s of e){if(!s.changeList)return;for(const u of n.onOfflineList)for(const v of s.changeList)if(v.userId===u.userId){u.activeStatus=v.activeStatus;break}}},{deep:!0,immediate:!0});const b=W(()=>n.onOfflineList.sort((e,s)=>s.activeStatus-e.activeStatus)),d=S(),h=S(!1);function m(){var e,s;d.value&&((e=d.value)==null||e.reload(),(s=d.value)!=null&&s.form&&(d.value.form.roomId=n.theContact.roomId),h.value=!0)}function t(){ue.confirm(_.value?"是否解散该群聊？":"是否退出该群聊？",{center:!0,confirmButtonText:_.value?"解散":"退出",cancelButtonText:"取消",lockScroll:!1,callback:async e=>{e==="confirm"&&(await Fe(n.theContact.roomId,i.getToken)).code===j.SUCCESS&&(de.success("操作成功！"),n.setContact(),n.contactList=n.contactList.filter(u=>u.roomId!==n.theContact.roomId))}})}return(e,s)=>{var E;const u=ge,v=Se,D=De,G=Pe,N=ke,P=mo,ne=fo;return o(n).theContact.type===("RoomType"in e?e.RoomType:o($)).GROUP&&o(a).isOpenGroupMember?(w(),U("div",Ne({key:0},e.$attrs,{class:"group flex flex-col animate-[fade-in-right_300ms] gap-2 p-2 transition-200 transition-width sm:relative sm:w-1/5 sm:flex-col sm:p-4"}),[C("div",{"flex-row-bt-c":"","flex-col":"","gap-4":"",truncate:"","pb-1rem":"","pt-2":"","sm:flex-row":""},[po,go,C("div",{class:"rounded-2rem p-1.5 transition-all border-default sm:border-0 group-hover:op-100 sm:op-0"},[C("i",{class:"block h-1.8em w-1.8em rounded-2rem btn-info sm:h-1.6em sm:w-1.6em border-default","i-carbon:add-large":"",onClick:m})])]),y(G,{height:"100%",class:"mx-a h-70vh max-w-full w-fit w-full md:w-full","view-class":"max-w-full mx-a  tracking-0.1em flex flex-col gap-2","wrap-class":"w-full mx-a"},{default:M(()=>[y(D,{immediate:!0,"auto-stop":!0,"no-more":o(L).isLast,loading:o(l),onLoad:g},{done:M(()=>[bo]),default:M(()=>[(w(!0),U(te,null,re(o(b),B=>(w(),U("div",{key:B.userId,class:ie([B.activeStatus===("ChatOfflineType"in e?e.ChatOfflineType:o(ft)).ONLINE?"live":"op-50 filter-grayscale filter-grayscale-100 ","user-card flex-shrink-0"]),onContextmenu:ae=>r(ae,B),onClick:ae=>r(ae,B)},[C("div",ho,[y(u,{src:("BaseUrlImg"in e?e.BaseUrlImg:o(Q))+B.avatar,fit:"cover",class:"h-2.2em w-2.2em flex-shrink-0 overflow-auto rounded-1/2 object-cover border-default"},null,8,["src"]),vo]),C("small",yo,H(B.nickName||"未填写"),1),C("div",Co,[B.userId===o(i).userInfo.id?(w(),V(v,{key:0,class:"mr-1",style:{"font-size":"0.6em"},size:"small",type:"warning"},{default:M(()=>[ee(" 我 ")]),_:1})):q("",!0),B.roleType!==null&&B.roleType!==o(F).MEMBER?(w(),V(v,{key:1,class:"mr-1",style:{"font-size":"0.6em"},size:"small",effect:"dark",type:"info"},{default:M(()=>[ee(H(o(x)[B.roleType||o(F).MEMBER]),1)]),_:2},1024)):q("",!0)])],42,_o))),128))]),_:1},8,["no-more","loading"])]),_:1}),y(N,{class:"op-0 group-hover:op-100","icon-class":"i-solar:logout-3-broken mr-2",round:"",type:"danger",plain:"",onClick:s[0]||(s[0]=B=>t())},{default:M(()=>[C("span",wo,H(o(T)===o(F).OWNER?"解散群聊":"退出群聊"),1)]),_:1}),y(P,{ref_key:"ChatNewGroupDialogRef",ref:d,modelValue:o(h),"onUpdate:modelValue":s[1]||(s[1]=B=>Z(h)?h.value=B:null)},null,8,["modelValue"]),y(ne,{show:o(z),"onUpdate:show":s[2]||(s[2]=B=>Z(z)?z.value=B:null),"user-id":(E=o(O))==null?void 0:E.userId},null,8,["show","user-id"])],16)):q("",!0)}}}),ko=se(Io,[["__scopeId","data-v-2db30174"]]),Ko=Y({__name:"index",setup(I){return Qe({title:"极物 - 聊天 - 极物圈 👑",description:"极物 - 聊天 - 极物圈 开启你的极物之旅！",keywords:et}),(x,c)=>{const n=Nt,a=uo,l=ko,i=Ze;return w(),U("div",null,[y(i,{name:"chat"},{default:M(()=>[y(n,{class:"card-default"}),y(a,{class:"flex-1 truncate border-0 border-l-1px sm:flex-shrink-0 border-default"}),y(l,{class:"bg-white p-4 dark:bg-dark"})]),_:1})])}}});export{Ko as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./NewGroupDialog.ByLeF4p0.js","./ElImage.MMEIiX96.js","./swiper-vue.Dj7aAS3P.js","./swiper-vue.CRufKKKm.css","./entry.t-rqPOs0.js","./entry.k6-BttGb.css","./debounce.0E-5_dMF.js","./ElImage.dg4y3aGk.css","./checkbox.zfGg0ai0.js","./isEqual.OSnr_sHV.js","./hasIn.6fummut8.js","./flatten.qRdZVAia.js","./checkbox.MJHvI1xB.css","./AutoIncre.vue.cpfunnOh.js","./scrollbar.VqFpSCdd.js","./scrollbar.Smf0pYfu.css","./OssFileUpload.AYjrnYRm.js","./progress.FoUIz2xX.js","./progress.rXLlm_9F.css","./index.keDQovFV.js","./OssFileUpload.-TDo8IgO.css","./dialog.W1fDsdND.js","./dialog.NzY-5hTp.css","./notification.YJSnxgg5.js","./notification.6oJvQm9r.css","./contact.O0MKBF5K.js","./useWs.cWBkfbdz.js","./Main.vue.XLnSog5g.js","./tag.C0ahusY6.js","./tag.ItIytdvz.css","./Main.1Yb3qjBM.css","./friend.psniISnN.js","./NewGroupDialog.VBKd-Cia.css","./checkbox-group.d5XbR8TY.css","./ApplyDialog.D1NickFR.js","./ApplyDialog.vue.xGx-IahS.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
