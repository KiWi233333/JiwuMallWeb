import{b3 as R,u as D,E as y,h as q,S as L,i as F,A,f as M,bk as te,c as O,v as Z,x as H,bl as se,bm as ae,bn as W,bo as X,bp as ne,bq as re,ac as le,aC as ie,B as j,n as de,ah as ce,e as ue,a as me,G}from"./entry.t-rqPOs0.js";import{E as pe}from"./tag.C0ahusY6.js";import{j as V,O as w,P as S,Q as n,a6 as x,a5 as b,a7 as C,a2 as u,a8 as T,X as fe,a as P,ap as _e,ab as B,u as e,$ as d,a0 as ge,as as ve,an as J,ao as Y,r as z,ak as I,ad as ee,ae as we,Z as Q,x as he}from"./swiper-vue.Dj7aAS3P.js";import{E as ye}from"./scrollbar.VqFpSCdd.js";import{E as be}from"./avatar.O_LQjIGj.js";import{E as ke}from"./divider.Ixn223Qv.js";import{ElText as xe}from"./index.Ody5FIGE.js";import{u as $e}from"./useOrderStore.eUMUt3Tv.js";import"./index.T5JhbHk1.js";const Ue={class:"flex flex-col border-2px rounded-8px p-4 leading-1.5em border-default-dashed v-card"},Ee={class:"mb-1 flex-row-bt-c font-600"},Pe={"text-0.7em":""},Se={"text-0.7em":"","opacity-80":""},Ce={"text-0.7em":"","opacity-80":""},Ie={"text-0.7em":"","opacity-80":""},Ve={class:"btns mt-1 flex-row-bt-c opacity-100 transition-300 group-hover:opacity-100 md:opacity-0"},Te=V({__name:"DeviceCard",props:{data:{}},setup(_){return(o,h)=>{const s=pe;return w(),S("div",Ue,[n("small",Ee,[x(b(o.data.country&&o.data.country!=="0"?o.data.country:"未知")+" "+b(o.data.province&&o.data.province!=="0"?o.data.province:"未知")+" "+b(o.data.city&&o.data.city!=="0"?o.data.city:"未知")+" ",1),o.data.isLocal?(w(),C(s,{key:0,type:"info",size:"small",plain:""},{default:u(()=>[x(" 本机 ")]),_:1})):T("",!0)]),n("small",Pe,"IP："+b(o.data.ip),1),n("small",Se," 系统："+b(o.data.operatingSystem),1),n("small",Ce," 浏览器："+b(o.data.browser),1),n("small",Ie," 运营商："+b(o.data.operator),1),n("div",Ve,[fe(o.$slots,"default")])])}}});function Le(_){return R.get("/user/device",{},{headers:{Authorization:_}})}function Be(_,o){return R.deleted("/user/device",{userAgent:_},{headers:{Authorization:o}})}function ze(_,o){return R.get(`/res/ip/info?ip=${_}`,{},{headers:{Authorization:o}})}const oe=_=>(J("data-v-fba7f367"),_=_(),Y(),_),De={class:"group flex flex-col"},qe=oe(()=>n("i",{class:"i-solar:devices-outline mr-2 p-2.5"},null,-1)),Ae={class:"group flex-1 select-none overflow-hidden rounded-14px p-4 shadow-sm border-default v-card"},Fe={class:"relative grid grid-cols-1 grid-gap-3 md:grid-cols-3"},Me=oe(()=>n("div",null,null,-1)),Ke=V({__name:"DeviceList",setup(_){const o=D(),h=P(!1),s=P([]);async function c(){const m=(await Le(o.getToken)).data.sort((a,v)=>v.isLocal-a.isLocal),p=[];for(const a of m)p.push(await ze(a.ip,o.getToken));return(await Promise.all(p)).forEach((a,v)=>{m[v]={...a.data,...m[v]}}),s.value=m.sort((a,v)=>a.isLocal),!0}c();async function l(){if(h.value)return;s.value.splice(0),h.value=!0;const t=await c();setTimeout(()=>{h.value=!1,y.success(t?"刷新成功🎉！":"刷新失败，请稍后重试！")},300)}function g(t){q.confirm("是否确认下线用户?","确认选择",{cancelButtonText:"取消",lockScroll:!1,confirmButtonText:"确认下线",confirmButtonClass:"el-button--danger"}).then(async m=>{var p;if(m==="confirm"){const f=t?[t]:(p=s.value)==null?void 0:p.map(i=>i.userAgentString),{code:a,message:v}=await Be(f,o.getToken);if(a===L.SUCCESS){if(s.value){for(let i=0;i<s.value.length;i++)if(s.value[i].userAgentString===t){s.value.splice(i,1);break}}y.success("下线成功！")}else y.error(v)}}).catch(()=>{})}return(t,m)=>{const p=F,f=Te,a=ye,v=_e("auto-animate"),i=A;return w(),S("div",De,[n("strong",{"my-4":"",block:"","opacity-70":""},[qe,x(" 登录设备 "),n("i",{"opacity-100":"","transition-300":"","group-hover:opacity-100":"","md:opacity-0":"",class:"i-solar:refresh-outline float-right cursor-pointer bg-[var(--el-color-info)] px-3 transition-300 hover:rotate-180",onClick:l})]),B((w(),S("div",Ae,[d(a,{height:"400px"},{default:u(()=>[B((w(),S("div",Fe,[(w(!0),S(ge,null,ve(e(s),r=>(w(),C(f,{key:r.id,class:"cursor-pointer active:scale-97 hover:border-[var(--el-color-info)]",data:r},{default:u(()=>[Me,r.isLocal?T("",!0):(w(),C(p,{key:0,size:"small",type:"danger",style:{padding:"0 8px"},plain:"",onClick:$=>g(r.userAgentString)},{default:u(()=>[x(" 下线 ")]),_:2},1032,["onClick"]))]),_:2},1032,["data"]))),128))])),[[v,{duration:300,easing:"cubic-bezier(0.61, 0.225, 0.195, 1.3)"}]])]),_:1})])),[[i,e(h)]])])}}}),Ne=M(Ke,[["__scopeId","data-v-fba7f367"]]),Re=_=>(J("data-v-275e76e8"),_=_(),Y(),_),Oe=Re(()=>n("h2",{"mb-5":"","mt-4":"","text-center":"","tracking-0.2em":""}," 密码修改 ",-1)),Ze=V({__name:"PwdForm",emits:["close"],setup(_,{emit:o}){const h=o,s=D(),c=P(!1),l=z({password:"",newPassword:""}),g=z({password:[{required:!0,message:"旧密码不能为空！",trigger:"blur"},{min:6,max:20,message:"旧密码长度6-20字符！",trigger:"blur"},{pattern:/^\w{6,20}$/,message:"密码由字母数字下划线组成",trigger:"change"}],newPassword:[{required:!0,message:"新密码不能为空！",trigger:"blur"},{required:!0,message:"新密码不能为空！",trigger:"blur"},{pattern:/^\w{6,20}$/,message:"密码字母数字下划线组成",trigger:"change"},{min:6,max:20,message:"新密码长度6-20字符！",trigger:"blur"},{validator:()=>l.password!==l.newPassword,message:"新旧密码相同！",trigger:"change"},{validator:()=>l.password!==l.newPassword,message:"新旧密码相同！",trigger:"blur"}]}),t=P();async function m(f){!f||c.value||await f.validate(async a=>{if(a){c.value=!0;try{await q.confirm("是否确认修改密码?","修改密码",{confirmButtonText:"确认修改",cancelButtonText:"取消",lockScroll:!1})==="confirm"&&await p()}finally{setTimeout(()=>{c.value=!1},300)}}})}async function p(){return(await te({oldPassword:l.password,newPassword:l.newPassword},s.getToken)).code===L.SUCCESS&&(y.success({message:"修改成功，下次登录请用新密码！",duration:2e3}),h("close")),!0}return(f,a)=>{const v=O,i=Z,r=F,$=H,U=A;return B((w(),C($,{ref_key:"userFormRefs",ref:t,"label-position":"top","hide-required-asterisk":"",rules:e(g),model:e(l),class:"form"},{default:u(()=>[Oe,d(i,{type:"password",label:"旧密码",prop:"password",class:"animated"},{default:u(()=>[d(v,{modelValue:e(l).password,"onUpdate:modelValue":a[0]||(a[0]=k=>e(l).password=k),modelModifiers:{trim:!0},"prefix-icon":"Unlock",size:"large",placeholder:"请输入旧密码",required:"","show-password":"",type:"password",onKeyup:a[1]||(a[1]=I(k=>m(e(t)),["enter"]))},null,8,["modelValue"])]),_:1}),d(i,{type:"password",label:"新密码",prop:"newPassword",class:"animated"},{default:u(()=>[d(v,{modelValue:e(l).newPassword,"onUpdate:modelValue":a[2]||(a[2]=k=>e(l).newPassword=k),modelModifiers:{trim:!0},"prefix-icon":"Unlock",size:"large",placeholder:"请输入新密码",required:"","show-password":"",type:"password",onKeyup:a[3]||(a[3]=I(k=>m(e(t)),["enter"]))},null,8,["modelValue"])]),_:1}),d(i,{"mt-1em":""},{default:u(()=>[d(r,{type:"danger",class:"submit w-full",style:{padding:"20px"},onKeyup:a[4]||(a[4]=I(k=>m(e(t)),["enter"])),onClick:a[5]||(a[5]=k=>m(e(t)))},{default:u(()=>[x(" 修 改 ")]),_:1})]),_:1})]),_:1},8,["rules","model"])),[[U,e(c)]])}}}),He=M(Ze,[["__scopeId","data-v-275e76e8"]]),je={"mb-6":"","mt-4":"","text-center":"","tracking-0.2em":""},Ge=V({__name:"PhoneForm",emits:["close"],setup(_,{emit:o}){const h=o,s=D(),c=P(!1),l=P(0),g=P(),t=z({newPhone:s.userInfo.phone||"",code:""}),m=z({newPhone:[{required:!0,message:"手机号不能为空！",trigger:"blur"},{pattern:/^1(3\d|4[57]|5[0-35-9]|6[56]|7[013678]|8\d|9[89])\d{8}$/g,message:"手机号格式不正确！",trigger:"change"}],code:[{required:!0,message:"验证码6位组成！",trigger:"change"}]});async function p(i){!i||c.value||await i.validate(r=>{r&&(c.value=!0,q.confirm("是否确认修改?","修改手机号",{confirmButtonText:"确认修改",lockScroll:!1,cancelButtonText:"取消"}).then($=>{$==="confirm"&&f()}))})}async function f(){const i=await se({newPhone:t.newPhone,code:t.code},s.getToken);i.code===L.SUCCESS?(y.success({message:"修改手机号成功！",duration:2e3}),s.userInfo.phone=t.newPhone,h("close"),setTimeout(()=>{c.value=!1},300)):y.error(i.message||"修改失败，请稍后重试！")}let a;async function v(){if(l.value>0)return;if(!t.newPhone)return y.warning("新手机号不能为空");if(!ae(t.newPhone))return y.error("新手机号格式不正确!");if(s.userInfo.phone===t.newPhone.trim())return y.error("新旧手机号不能一致!");const{code:i}=await W(t.newPhone,X.PHONE,s.getToken);i===L.SUCCESS&&(l.value=60,y.success("发送成功，请查看手机短信！"),a=setInterval(()=>{l.value--,clearInterval(a),a=void 0},1e3))}return(i,r)=>{const $=F,U=O,k=Z,K=H,N=A;return B((w(),C(K,{ref_key:"formRef",ref:g,"label-position":"top","hide-required-asterisk":"",rules:e(m),model:e(t),class:"form",onSubmit:ee(()=>{},["prevent"])},{default:u(()=>[n("h2",je,b(e(s).userInfo.isPhoneVerified?"更换":"绑定")+"手机号 ",1),d(k,{label:"",prop:"newPhone",class:"animated"},{default:u(()=>[d(U,{modelValue:e(t).newPhone,"onUpdate:modelValue":r[0]||(r[0]=E=>e(t).newPhone=E),modelModifiers:{trim:!0},"prefix-icon":"Iphone",size:"default",clearable:"",type:"tel",placeholder:"请输入新手机号",onKeyup:I(v,["enter"])},{append:u(()=>[d($,{type:"primary",disabled:e(l)>0,onClick:v},{default:u(()=>[x(b(e(l)>0?`${e(l)}s后重新发送`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),d(k,{type:"number",label:"",prop:"code",class:"animated"},{default:u(()=>[d(U,{modelValue:e(t).code,"onUpdate:modelValue":r[1]||(r[1]=E=>e(t).code=E),modelModifiers:{trim:!0},"prefix-icon":"message",size:"default",type:"number",placeholder:"请输入验证码",onKeyup:r[2]||(r[2]=I(E=>p(e(g)),["enter"]))},null,8,["modelValue"])]),_:1}),d(k,{"mt-1em":""},{default:u(()=>[d($,{type:"primary",size:"large",class:"submit w-full",onKeyup:r[3]||(r[3]=I(E=>p(e(g)),["enter"])),onClick:r[4]||(r[4]=E=>p(e(g)))},{default:u(()=>[x(" 立即"+b(e(s).userInfo.isPhoneVerified?"更换":"绑定"),1)]),_:1})]),_:1})]),_:1},8,["rules","model"])),[[N,e(c)]])}}}),Qe=M(Ge,[["__scopeId","data-v-79bf058d"]]),We={"mb-6":"","mt-4":"","text-center":"","tracking-0.2em":""},Xe=V({__name:"EmailForm",emits:["close"],setup(_,{emit:o}){const h=o,s=D(),c=P(!1),l=P(0),g=P(),t=z({newEmail:s.userInfo.email||"",code:""}),m=z({newEmail:[{required:!0,message:"邮箱不能为空！",trigger:"blur"},{pattern:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/g,message:"邮箱格式不正确！",trigger:"change"}],code:[{required:!0,message:"验证码6位组成！",trigger:"change"}]});async function p(i){!i||c.value||await i.validate(r=>{r&&(c.value=!0,q.confirm("是否确认修改?","修改邮箱",{confirmButtonText:"确认修改",cancelButtonText:"取消",lockScroll:!1}).then($=>{$==="confirm"&&f()}))})}async function f(){const i=await ne({newEmail:t.newEmail,code:t.code},s.getToken);i.code===L.SUCCESS?(y.success({message:"修改邮箱成功！",duration:2e3}),s.userInfo.email=t.newEmail,h("close"),setTimeout(()=>{c.value=!1},300)):y.error(i.message||"修改失败，请稍后重试！")}let a;async function v(){if(l.value>0)return;if(!t.newEmail)return y.warning("新邮箱不能为空");if(!re(t.newEmail))return y.error("新邮箱格式不正确!");if(s.userInfo.email===t.newEmail.trim())return y.error("新旧邮箱不能一致!");const{code:i}=await W(t.newEmail,X.EMAIL,s.getToken);i===L.SUCCESS&&(l.value=60,y.success("发送验证码成功！"),a=setInterval(()=>{l.value--,clearInterval(a),a=void 0},1e3))}return(i,r)=>{const $=F,U=O,k=Z,K=H,N=A;return B((w(),C(K,{ref_key:"formRef",ref:g,"label-position":"top","hide-required-asterisk":"",rules:e(m),model:e(t),class:"form",onSubmit:ee(()=>{},["prevent"])},{default:u(()=>[n("h2",We,b(e(s).userInfo.isEmailVerified?"更换":"绑定")+"邮箱 ",1),d(k,{type:"newEmail",label:"",prop:"newEmail",class:"animated"},{default:u(()=>[d(U,{modelValue:e(t).newEmail,"onUpdate:modelValue":r[0]||(r[0]=E=>e(t).newEmail=E),modelModifiers:{trim:!0},"prefix-icon":"Iphone",size:"default",clearable:"",type:"email",placeholder:"请输入新邮箱",onKeyup:I(v,["enter"])},{append:u(()=>[d($,{type:"primary",disabled:e(l)>0,onClick:v},{default:u(()=>[x(b(e(l)>0?`${e(l)}s后重新发送`:"获取验证码"),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),_:1}),d(k,{type:"number",label:"",prop:"code",class:"animated"},{default:u(()=>[d(U,{modelValue:e(t).code,"onUpdate:modelValue":r[1]||(r[1]=E=>e(t).code=E),modelModifiers:{trim:!0},"prefix-icon":"message",size:"default",type:"number",placeholder:"请输入验证码",onKeyup:r[2]||(r[2]=I(E=>p(e(g)),["enter"]))},null,8,["modelValue"])]),_:1}),d(k,{"mt-1em":""},{default:u(()=>[d($,{type:"primary",size:"large",class:"submit w-full",onKeyup:r[3]||(r[3]=I(E=>p(e(g)),["enter"])),onClick:r[4]||(r[4]=E=>p(e(g)))},{default:u(()=>[x(" 立即"+b(e(s).userInfo.isEmailVerified?"更换":"绑定"),1)]),_:1})]),_:1})]),_:1},8,["rules","model"])),[[N,e(c)]])}}}),Je=M(Xe,[["__scopeId","data-v-5bc5454e"]]),Ye={key:0,class:"flex-row-c-c overflow-hidden fixed top-0 left-0 z-1000 w-full h-100vh"},eo=V({__name:"Dialog",props:{modelValue:{}},setup(_){const o=_,h=()=>{o.modelValue.showUpdateEmail=!1,o.modelValue.showUpdatePhone=!1,o.modelValue.showUpdatePwd=!1};return(s,c)=>{const l=He,g=Qe,t=Je;return w(),C(we,{name:"popup"},{default:u(()=>[s.modelValue.showUpdatePwd||s.modelValue.showUpdateEmail||s.modelValue.showUpdatePhone?(w(),S("div",Ye,[n("div",{class:"w-full h-full absolute bg-[#b4b4b459] dark:bg-[#1d1d1d80] backdrop-blur-5px",onClick:h}),s.modelValue.showUpdatePwd?(w(),C(l,{key:0,onClose:c[0]||(c[0]=m=>h())})):T("",!0),s.modelValue.showUpdatePhone?(w(),C(g,{key:1,onClose:c[1]||(c[1]=m=>h())})):T("",!0),s.modelValue.showUpdateEmail?(w(),C(t,{key:2,onClose:c[2]||(c[2]=m=>h())})):T("",!0)])):T("",!0)]),_:1})}}}),oo={class:"card flex flex-col"},to=n("strong",{"my-4":"",block:"","opacity-70":""},[n("i",{"i-solar:shield-check-broken":"","mr-2":"","p-2.5":""}),x(" 修改信息 ")],-1),so={class:"group flex flex-col overflow-hidden rounded-14px p-5 text-1em shadow-sm border-default v-card",flex:"","flex-1":"","flex-col":""},ao={class:"flex items-center"},no={class:"ml-3 block"},ro={"ml-1":"","mt-6":"","flex-row-bt-c":""},lo=n("small",null,[x(" 密 码： "),n("small",{"opacity-80":""},"*******")],-1),io={"ml-1":"","mt-6":"","flex-row-bt-c":""},co={"ml-1":"","mt-6":"","flex-row-bt-c":""},uo={"mt-a":"","w-full":""},mo={"mb-1":"","flex-row-bt-c":"","justify-end":""},po=V({__name:"UpdateCards",setup(_){const o=D(),h=le(),s=$e(),c=ie();async function l(){q.confirm("是否确认退出登录？","退出登录",{confirmButtonText:"确认退出",lockScroll:!1,cancelButtonText:"取消"}).then(async p=>{p==="confirm"&&(await o.onUserExit(o.getToken),setTimeout(()=>{o.$reset(),h.$reset(),s.$reset(),c.$reset()},50),de("/"))})}const g=P(!1);async function t(){g.value=!0,await o.loadUserWallet(o.getToken)?y.success("刷新成功🎉"):y.success("刷新失败，请稍后重试！"),setTimeout(()=>{g.value=!1},300)}const m=P({showUpdatePwd:!1,showUpdatePhone:!1,showUpdateEmail:!1});return(p,f)=>{const a=be,v=ke,i=xe,r=eo,$=A;return w(),S("div",oo,[to,B((w(),S("div",so,[n("div",ao,[d(a,{size:"large",src:e(o).userInfo.avatar?("BaseUrlImg"in p?p.BaseUrlImg:e(j))+e(o).userInfo.avatar:`${"BaseUrlImg"in p?p.BaseUrlImg:e(j)}default.png`},null,8,["src"]),n("strong",no,"用户名："+b(e(o).userInfo.username),1),n("i",{"opacity-0":"","transition-300":"","group-hover:opacity-100":"",class:"i-solar:refresh-outline ml-a cursor-pointer bg-[var(--el-color-info)] px-3 transition-300 hover:rotate-180",onClick:t})]),n("div",ro,[lo,n("small",{class:"cursor-pointer transition-300 hover:text-[var(--el-color-primary)]",onClick:f[0]||(f[0]=U=>e(m).showUpdatePwd=!0)}," 修改密码 ")]),n("div",io,[n("small",null,[x(" 手机号： "),n("small",{"opacity-80":"",class:Q({"text-red-5":e(o).userInfo.isPhoneVerified===0})},b(e(o).userInfo.phone||"还未绑定"),3)]),n("small",{class:"cursor-pointer transition-300 hover:text-[var(--el-color-primary)]",onClick:f[1]||(f[1]=U=>e(m).showUpdatePhone=!0)},b(e(o).userInfo.isPhoneVerified?"修改手机号":"绑定"),1)]),n("div",co,[n("small",null,[x(" 邮 箱： "),n("small",{"opacity-80":"",class:Q({"text-red-5":e(o).userInfo.isEmailVerified===0})},b(e(o).userInfo.email||"还未绑定"),3)]),n("small",{class:"cursor-pointer transition-300 hover:text-[var(--el-color-primary)]",onClick:f[2]||(f[2]=U=>e(m).showUpdateEmail=!0)},b(e(o).userInfo.isEmailVerified?"修改邮箱":"绑定"),1)]),n("div",uo,[d(v,{class:"dark:opacity-20"}),n("div",mo,[d(i,{style:{"margin-left":"1rem"},class:"cursor-pointer transition-300 hover:text-[var(--el-color-primar)y]",onClick:f[3]||(f[3]=U=>("ElMessage"in p?p.ElMessage:e(y)).warning("功能还未开放!"))},{default:u(()=>[x(" 注销 ")]),_:1}),d(i,{style:{"margin-left":"1rem"},class:"cursor-pointer transition-300 hover:text-[var(--el-color-primar)y]",type:"danger",onClick:l},{default:u(()=>[x(" 退出登录 ")]),_:1})])])])),[[$,e(g)]]),d(r,{modelValue:e(m),"onUpdate:modelValue":f[4]||(f[4]=U=>he(m)?m.value=U:null)},null,8,["modelValue"])])}}}),fo={key:0,class:"flex flex-col layout-default"},_o=n("div",{class:"animate__animated title animate-fade-in-down animate-duration-400","mt-3":""},[n("h2",{"tracking-1":""}," 账户与安全 ")],-1),go={class:"flex flex-col-reverse grid-gap-6 md:grid md:grid-cols-2"},Eo=V({__name:"safe",setup(_){const o=D();return ce({title:`账号与安全 - 个人中心 - ${G}`,meta:[{name:"description",content:`账号与安全 - 个人中心 - ${G}`}]}),(h,s)=>{const c=Ne,l=po,g=ue,t=me;return w(),S("div",null,[d(t,{name:"user",menu:["back"],footer:!1},{default:u(()=>[d(g,null,{default:u(()=>[e(o).isLogin?(w(),S("div",fo,[_o,n("div",go,[d(c,{"mt-4":""}),d(l,{"mt-4":""})])])):T("",!0)]),_:1})]),_:1})])}}});export{Eo as default};
