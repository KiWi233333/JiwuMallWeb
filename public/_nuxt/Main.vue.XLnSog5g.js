import{b3 as U,ad as ee,ae as te,u as P,B as H,q as A,f as T,o as se,C as ae,h as J,S as K,E as Z}from"./entry.t-rqPOs0.js";import{u as V,M as b,r as re,R as oe,d as ne}from"./contact.O0MKBF5K.js";import{_ as X}from"./ElImage.MMEIiX96.js";import{E as q}from"./tag.C0ahusY6.js";import{j as E,C as Q,aj as le,O as m,P as g,Q as u,$ as O,u as e,a5 as p,a7 as S,a2 as F,a6 as N,a8 as _,a0 as j,Y as W,k as z,a3 as ce}from"./swiper-vue.Dj7aAS3P.js";function Xe(s=null,a=10,o=null,c){return U.get("/chat/room/group/member/page",{roomId:s,pageSize:a,cursor:o},{headers:{Authorization:c}})}var de=(s=>(s[s.ONLINE=1]="ONLINE",s[s.OFFLINE=0]="OFFLINE",s))(de||{}),G=(s=>(s[s.OWNER=1]="OWNER",s[s.ADMIN=2]="ADMIN",s[s.MEMBER=3]="MEMBER",s))(G||{});const qe={1:"群主",2:"管理员",3:"成员"};function Qe(s,a){return ee(`${te}/chat/room/group/member/list/${s}`,{headers:{Authorization:a}},"$nzaFCPeOAS")}function Je(s,a){return U.post("/chat/room/group",s,{headers:{Authorization:a}})}function Ke(s,a){return U.post("/chat/room/group/member",s,{headers:{Authorization:a}})}function Ze(s,a){return U.deleted(`/chat/room/group/member/exit/${s}`,{},{headers:{Authorization:a}})}function et(s,a,o){return U.deleted(`/chat/room/group/member/${s}/${a}`,{},{headers:{Authorization:o}})}function tt(s,a){return U.put("/chat/room/group/admin",s,{headers:{Authorization:a}})}function st(s,a){return U.deleted("/chat/room/group/admin",{},{headers:{Authorization:a},params:{...s}})}const ie=["label"],me={class:"flex flex-col"},ue={class:"mb-2 block flex flex-row items-center gap-2"},pe={class:"self-child msg-popper w-fit p-2 px-4 leading-1.2em shadow-sm card-default"},fe={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},ge=E({__name:"AiMsg",props:{data:{},index:{}},setup(s){var h;const a=s,{data:o}=Q(a),c=V(),d=P(),$=Date.now();function M(l){return $-+l>24*3600?A(l,"YYYY-MM-DD HH:mm:ss").value.toString():A(l,"HH:mm:ss").value.toString()}const n=((h=a.data.message)==null?void 0:h.body)||{};return(l,t)=>{var y,x,v,k,B,w,I;const r=X,i=q,f=le("v-md-preview");return m(),g(j,null,[u("div",W(l.$attrs,{label:e(o).roomId,class:{self:((x=(y=e(o))==null?void 0:y.fromUser)==null?void 0:x.userId)===((v=e(d))==null?void 0:v.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","flex-shrink-0":"","gap-4":"","p-2":"","py-3":"","transition-300":"","transition-transform":"","active:scale-95":""}),[O(r,{src:("BaseUrlImg"in l?l.BaseUrlImg:e(H))+e(o).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem flex-shrink-0 rounded-1/2 object-cover border-default"},null,8,["src"]),u("div",me,[u("div",ue,[u("small",null,p(e(o).fromUser.nickName),1),e(o).fromUser.userId===e(d).userInfo.id?(m(),S(i,{key:0,class:"op-80",effect:"dark",size:"small"},{default:F(()=>[N(" 自己 ")]),_:1})):_("",!0)]),u("div",pe,[e(o).fromUser.userId===e(d).userInfo.id?(m(),g(j,{key:0},[N(p((k=e(o).message)==null?void 0:k.content),1)],64)):(m(),S(f,{key:1,class:"markdown",text:((B=e(o).message)==null?void 0:B.content)||""},null,8,["text"]))]),(w=e(n))!=null&&w.reply?(m(),g("small",{key:0,"mt-2":"",class:"cursor-pointer truncate px-2 py-1 op-70 border-default card-default",onClick:t[0]||(t[0]=Y=>{var C,D,R,L;return e(c).scrollReplyMsg((D=(C=e(n))==null?void 0:C.reply)==null?void 0:D.id,(L=(R=e(n))==null?void 0:R.reply)==null?void 0:L.gapCount)})}," 回复: "+p(`${e(n).reply.nickName}:${((I=e(n).reply)==null?void 0:I.body)||""}`),1)):_("",!0)])],16,ie),l.index%8===0?(m(),g("p",fe,p(M(e(o).message.sendTime)),1)):_("",!0)],64)}}}),_e=T(ge,[["__scopeId","data-v-1e97d739"]]),he={class:"mx-a my-2 w-fit rounded-1em px-4 py-1 text-0.8rem font-500 op-60 border-default card-default"},be=E({__name:"Delete",props:{data:{}},setup(s){return(a,o)=>{var c,d;return m(),g("span",he,p((d=(c=a.data)==null?void 0:c.message)==null?void 0:d.content),1)}}}),ye=T(be,[["__scopeId","data-v-0bb61cbc"]]),xe=["label"],ve={class:"flex flex-col"},ke={class:"mb-2 block flex flex-row items-center gap-2"},we={class:"msg-popper w-fit shadow-sm",style:{"border-radius":"6px"}},Ie={"mt-2":"","w-fit":"","p-2":"","leading-1.2em":"",class:"text transform-origin-ct transition-300 transition-transform active:scale-95","card-default":""},Ce={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},$e=E({__name:"Img",props:{data:{},index:{}},setup(s){var h;const a=s,{data:o}=Q(a),c=V(),d=P(),$=Date.now();function M(l){return $-+l>24*3600?A(l,"YYYY-MM-DD HH:mm:ss").value.toString():A(l,"HH:mm:ss").value.toString()}const n=((h=a.data.message)==null?void 0:h.body)||{};return(l,t)=>{var f,y,x,v,k;const r=X,i=q;return m(),g(j,null,[u("div",W(l.$attrs,{label:e(o).roomId,class:{self:((y=(f=e(o))==null?void 0:f.fromUser)==null?void 0:y.userId)===((x=e(d))==null?void 0:x.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","gap-4":"","p-2":"","py-3":"","transition-300":"","transition-transform":"","active:scale-95":""}),[O(r,{src:("BaseUrlImg"in l?l.BaseUrlImg:e(H))+e(o).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem rounded-1/2 object-cover border-default"},null,8,["src"]),u("div",ve,[u("div",ke,[u("small",null,p(e(o).fromUser.nickName),1),e(o).fromUser.userId===e(d).userInfo.id?(m(),S(i,{key:0,class:"op-80",effect:"dark",size:"small"},{default:F(()=>[N(" 自己 ")]),_:1})):_("",!0)]),u("div",we,[e(n).url?(m(),S(r,{key:0,src:("BaseUrlImg"in l?l.BaseUrlImg:e(H))+e(n).url,class:"h-8rem w-8rem shadow-sm border-default v-card","preview-teleported":"",alt:e(n).url,"preview-src-list":[("BaseUrlImg"in l?l.BaseUrlImg:e(H))+e(n).url]},null,8,["src","alt","preview-src-list"])):_("",!0),u("p",Ie,p(e(o).message.content),1)]),(v=e(n))!=null&&v.reply?(m(),g("small",{key:0,"mt-2":"",class:"max-h-4rem max-w-20rem w-fit cursor-pointer break-words px-2 py-1 op-70 border-default card-default",onClick:t[0]||(t[0]=B=>{var w,I,Y,C;return e(c).scrollReplyMsg((I=(w=e(n))==null?void 0:w.reply)==null?void 0:I.id,(C=(Y=e(n))==null?void 0:Y.reply)==null?void 0:C.gapCount)})},[O(i,{size:"small"},{default:F(()=>[N("回复")]),_:1}),N(" "+p(`${e(n).reply.nickName}:${((k=e(n).reply)==null?void 0:k.body)||""}`),1)])):_("",!0)])],16,xe),l.index%8===0?(m(),g("p",Ce,p(M(e(o).message.sendTime)),1)):_("",!0)],64)}}}),Me=T($e,[["__scopeId","data-v-503a9b5d"]]),Ue={class:"mx-a my-2 w-fit rounded-1em px-4 py-1 text-0.8rem font-500 op-60 border-default card-default"},Ee=E({__name:"Recall",props:{data:{}},setup(s){return(a,o)=>{var c,d;return m(),g("span",Ue,p((d=(c=a.data)==null?void 0:c.message)==null?void 0:d.content),1)}}}),Be=T(Ee,[["__scopeId","data-v-6ddeba73"]]),Ne={"w-full":"","flex-row-c-c":"",truncate:"","p-2":"","text-center":""},Ae={class:"rounded-1em px-4 py-1 text-0.8rem font-500 op-60"},Se=E({__name:"System",props:{data:{}},setup(s){return(a,o)=>{var c,d;return m(),g("div",Ne,[u("span",Ae,p((d=(c=a.data)==null?void 0:c.message)==null?void 0:d.content),1)])}}}),Te=T(Se,[["__scopeId","data-v-80902259"]]),De=["label"],Re={class:"flex flex-col"},Le={class:"mb-2 block flex flex-row items-center gap-2"},He={"text-":"","transform-origin-ct":"","transition-300":"","transition-transform":"","active:scale-95":"",class:"self-child msg-popper w-fit p-2 px-4 leading-1.2em shadow-sm card-default"},Ye={key:0,"mt-2":"",class:"flex-ml-a w-fit cursor-pointer truncate px-2 py-1 op-70 border-default card-default"},ze={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},Ge=E({__name:"Text",props:{data:{},index:{}},setup(s){var l;const a=s,{data:o}=Q(a),c=V(),d=P(),$=Date.now();function M(t){return $-+t>24*3600?A(t,"YYYY-MM-DD HH:mm:ss").value.toString():A(t,"HH:mm:ss").value.toString()}const n=((l=a.data.message)==null?void 0:l.body)||{},h=z(()=>n!=null&&n.atUidList&&(n==null?void 0:n.atUidList.length)>0?c.onOfflineList.filter(t=>{var r;return(r=n==null?void 0:n.atUidList)==null?void 0:r.includes(t.userId)}).map(t=>`@${t.nickName}`).join("、"):"");return(t,r)=>{var y,x,v,k,B,w,I;const i=X,f=q;return m(),g(j,null,[u("div",W(t.$attrs,{label:e(o).roomId,class:{self:((x=(y=e(o))==null?void 0:y.fromUser)==null?void 0:x.userId)===((v=e(d))==null?void 0:v.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","gap-4":"","p-2":"","py-3":""}),[O(i,{src:("BaseUrlImg"in t?t.BaseUrlImg:e(H))+e(o).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem flex-shrink-0 rounded-1/2 object-cover border-default"},null,8,["src"]),u("div",Re,[u("div",Le,[u("small",null,p(e(o).fromUser.nickName),1),e(o).fromUser.userId===e(d).userInfo.id?(m(),S(f,{key:0,class:"op-80",effect:"dark",size:"small"},{default:F(()=>[N(" 自己 ")]),_:1})):_("",!0)]),u("p",He,p(e(o).message.content),1),(k=e(n))!=null&&k.atUidList&&((B=e(n))!=null&&B.atUidList.length)?(m(),g("small",Ye,p(e(h)),1)):_("",!0),(w=e(n))!=null&&w.reply?(m(),g("small",{key:1,"mt-2":"",class:"cursor-pointer truncate px-2 py-1 op-70 border-default card-default",onClick:r[0]||(r[0]=Y=>{var C,D,R,L;return e(c).scrollReplyMsg((D=(C=e(n))==null?void 0:C.reply)==null?void 0:D.id,(L=(R=e(n))==null?void 0:R.reply)==null?void 0:L.gapCount)})}," 回复: "+p(`${e(n).reply.nickName}:${((I=e(n).reply)==null?void 0:I.body)||""}`),1)):_("",!0)])],16,De),t.index%8===0?(m(),g("p",ze,p(M(e(o).message.sendTime)),1)):_("",!0)],64)}}}),Oe=T(Ge,[["__scopeId","data-v-64b5db36"]]),at=E({__name:"Main",props:{data:{},index:{}},setup(s){const a=s,o={[b.TEXT]:Oe,[b.RECALL]:Be,[b.DELETE]:ye,[b.IMG]:Me,[b.SYSTEM]:Te,[b.AI_CHAT]:_e},c=V(),d=P();z(()=>{var t,r;return(r=(t=c.theContact)==null?void 0:t.member)==null?void 0:r.role}),z(()=>{var t,r;return((r=(t=c.theContact)==null?void 0:t.member)==null?void 0:r.role)===G.OWNER});const $=z(()=>{var t,r,i,f;return((r=(t=c.theContact)==null?void 0:t.member)==null?void 0:r.role)===G.OWNER||((f=(i=c.theContact)==null?void 0:i.member)==null?void 0:f.role)===G.ADMIN}),M=se();function n(t,r){t.preventDefault();const i=d.userInfo.id===r.fromUser.userId,f={x:t.x,y:t.y,theme:M.preference==="dark"?"mac dark":"wind10",items:[{label:"撤回",hidden:!i,customClass:"group",icon:"i-solar:backspace-broken group-btn-danger",onClick:()=>{h(r.message.roomId,r.message.id)}},{label:"删除",customClass:"group",icon:"i-solar:trash-bin-minimalistic-outline group-btn-danger",hidden:!$.value,onClick:()=>{l(r.message.roomId,r.message.id)}},{label:"@TA",customClass:"group",hidden:i,onClick:()=>{c.setAtUid(r.fromUser.userId)}},{label:"回复",icon:"i-solar:arrow-to-down-right-line-duotone -rotate-90 group-btn-info",hidden:i,onClick:()=>{c.setReplyMsg(r)}}]};ae.showContextMenu(f)}function h(t,r){J.confirm("是否确认撤回消息？","撤回提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0,callback:async i=>{if(i!=="confirm")return;(await re(t,r,d.getToken)).code===K.SUCCESS&&(Z.success("撤回成功！"),a.data.message.id===r&&(a.data.message.type=b.RECALL,a.data.message.content=`${c.theContact.type===oe.GROUP?`"${a.data.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,a.data.message.body=void 0))}})}function l(t,r){J.confirm("是否确认删除消息？","删除提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0,callback:async i=>{if(i!=="confirm")return;(await ne(t,r,d.getToken)).code===K.SUCCESS&&(Z.success("删除成功！"),a.data.message.id===r&&(a.data.message.type=b.RECALL,a.data.message.content="删除了一条消息",a.data.message.body=void 0))}})}return(t,r)=>{var i;return m(),S(ce(o[((i=t.data.message)==null?void 0:i.type)||e(b).TEXT]),W({index:t.index,data:t.data},t.$attrs,{onContextmenu:r[0]||(r[0]=f=>n(f,t.data))}),null,16,["index","data"])}}});export{de as C,at as _,G as a,qe as b,Xe as c,et as d,Ze as e,tt as f,Qe as g,st as h,Ke as i,Je as j};
