import{gE as ne,aN as re,gk as le,O as ce,T as ie,hM as ue,Q as de,U as pe,u as K,aO as me,B as _e,hN as he,c as fe,v as ve,d as ge,x as be,e as Q,f as W,n as j,br as we,hO as ke,r as ye}from"./entry.t-rqPOs0.js";import{s as q,a as E,I as xe,j as F,k as Ee,O as i,a7 as N,a2 as u,u as e,a4 as Ie,Z as C,ad as X,$ as v,X as Te,P as B,a8 as O,ae as Se,b as Ce,ap as z,ak as Ne,a0 as Oe,as as $e,ab as R,a6 as G,an as Z,ao as Y,Q as b,at as Be}from"./swiper-vue.Dj7aAS3P.js";import{_ as H}from"./nuxt-link.AUBdcVxd.js";import{_ as Me}from"./Main.vue.XLnSog5g.js";import{E as Le}from"./scrollbar.VqFpSCdd.js";import{_ as Pe}from"./ElImage.MMEIiX96.js";import{E as Ae}from"./index.uAaZKamD.js";import{E as Fe}from"./popper.b7Al0Wsi.js";/* empty css                */import{M as J}from"./contact.O0MKBF5K.js";import{a as S}from"./useWs.cWBkfbdz.js";/* empty css                */import"./tag.C0ahusY6.js";import"./debounce.0E-5_dMF.js";import"./notification.YJSnxgg5.js";const Ue={visibilityHeight:{type:Number,default:200},target:{type:String,default:""},right:{type:Number,default:40},bottom:{type:Number,default:40}},De={click:o=>o instanceof MouseEvent},Ve=(o,$,t)=>{const a=q(),l=q(),n=E(!1),p=()=>{a.value&&(n.value=a.value.scrollTop>=o.visibilityHeight)},r=g=>{var I;(I=a.value)==null||I.scrollTo({top:0,behavior:"smooth"}),$("click",g)},h=le(p,300,!0);return ne(l,"scroll",h),xe(()=>{var g;l.value=document,a.value=document.documentElement,o.target&&(a.value=(g=document.querySelector(o.target))!=null?g:void 0,a.value||re(t,`target does not exist: ${o.target}`),l.value=a.value),p()}),{visible:n,handleClick:r}},ee="ElBacktop",ze=F({name:ee}),Re=F({...ze,props:Ue,emits:De,setup(o,{emit:$}){const t=o,a=ce("backtop"),{handleClick:l,visible:n}=Ve(t,$,ee),p=Ee(()=>({right:`${t.right}px`,bottom:`${t.bottom}px`}));return(r,h)=>(i(),N(Se,{name:`${e(a).namespace.value}-fade-in`},{default:u(()=>[e(n)?(i(),B("div",{key:0,style:Ie(e(p)),class:C(e(a).b()),onClick:h[0]||(h[0]=X((...g)=>e(l)&&e(l)(...g),["stop"]))},[Te(r.$slots,"default",{},()=>[v(e(ie),{class:C(e(a).e("icon"))},{default:u(()=>[v(e(ue))]),_:1},8,["class"])])],6)):O("v-if",!0)]),_:3},8,["name"]))}});var He=de(Re,[["__file","/home/runner/work/element-plus/element-plus/packages/components/backtop/src/backtop.vue"]]);const je=pe(He),te=o=>(Z("data-v-e4156316"),o=o(),Y(),o),qe=te(()=>b("div",{class:"h-3rem w-3rem flex-row-c-c rounded-1/2 bg-[var(--el-color-primary)] shadow-[#5d33f9] shadow-md shadow-opacity-60"},[b("i",{class:"i-solar:ghost-bold bg-light p-0.8em"})],-1)),Je={key:0,class:"w-90vw md:w-450px"},Ke=te(()=>b("p",{class:"mb-2 text-[var(--el-color-primary)] font-600 tracking-0.2em"},[b("i",{class:"i-solar:ghost-bold mr-2 p-0.8em"}),G(" 极物AI ")],-1)),Qe={relative:"",flex:"","flex-col":""},We=F({__name:"AichatBar",setup(o){const $=E(!1),t=K(),a=E({role:"user",content:""}),l=E(S.CLOSE),n=E({ws:null}),p=E({header:{app_id:"3b3875ac",uid:t.userInfo.id},parameter:{chat:{domain:"general",temperature:.8,top_k:4,max_tokens:2028}},payload:{message:{text:[{role:"user",content:""}]}}}),r=E(!1),h=E();function g(){var c;l.value!==S.OPEN&&((c=h.value)==null||c.validate(d=>{d&&(r.value=!0,D(a.value.content,t.userInfo.id),M(),a.value.content="")}))}const I=me(`ai_chat_history_${t.userInfo.id}`,[]);function D(c,d){n.value.ws&&n.value.ws.OPEN===1||(I.value.push({fromUser:{userId:t.userInfo.id,avatar:t.userInfo.avatar,gender:t.userInfo.gender,nickName:t.userInfo.nickname},message:{id:Math.random()*1e3,roomId:0,sendTime:new Date().toDateString(),content:c,type:J.TEXT,body:{}}}),n.value.ws=new WebSocket("wss://spark-openapi.cn-huabei-1.xf-yun.com/v1/assistants/u8h3bh6wxkq8_v1"),l.value=S.OPEN,n.value.ws.onopen=T=>{var s;p.value.payload.message.text[0].content=c,p.value.header.uid=d,(s=n.value.ws)==null||s.send(JSON.stringify(p.value)),l.value=S.OPEN},n.value.ws.onclose=()=>{l.value=S.SAFE_CLOSE,n.value.ws=null,M()},n.value.ws.onerror=()=>{l.value=S.CLOSE,n.value.ws=null,M()},n.value.ws.onmessage=T=>{var w,k;const s=JSON.parse(T.data);if(s){l.value=s.header.code;const m=((k=(w=s==null?void 0:s.payload)==null?void 0:w.choices)==null?void 0:k.text)||[];m.value="",m.forEach(_=>{_&&_.role==="assistant"&&(m.value+=_.content)});const y=I.value.find(_=>{var x;return _.message.id===((x=s==null?void 0:s.header)==null?void 0:x.sid)});if(y){y.message.content+=m.value;return}I.value.push({fromUser:{userId:"1739333818150862850",avatar:"image/2023-12-27/1653240351484801026/fab3eab2-e721-4e82-a98f-0bdbdb6e0068",gender:he.DEFAULT,nickName:"极物AI客服"},message:{id:s.header.sid,roomId:0,sendTime:new Date().toDateString(),content:m.value,type:J.AI_CHAT,body:{}}})}l.value=S.CLOSE,M()})}Ce(l,(c,d)=>{c===S.OPEN?r.value=c===S.OPEN:(r.value=!1,n.value.ws=null)});const f=E();function M(){var c,d,T,s,w,k,m,y,_;(d=(c=f.value)==null?void 0:c.wrapRef)!=null&&d.scrollTo?(k=(T=f.value)==null?void 0:T.wrapRef)==null||k.scrollTo({top:((w=(s=f==null?void 0:f.value)==null?void 0:s.wrapRef)==null?void 0:w.scrollHeight)+20||0,behavior:"smooth"}):(_=f.value)==null||_.setScrollTop(((y=(m=f==null?void 0:f.value)==null?void 0:m.wrapRef)==null?void 0:y.scrollHeight)+20||0)}return(c,d)=>{const T=Me,s=Le,w=Pe,k=H,m=fe,y=ve,_=ge,x=be,P=Ae,A=Q,oe=z("auto-animate"),ae=z("auth");return i(),N(A,null,{default:u(()=>[v(P,{placement:"top",width:"fit-content",class:"shadow-lg",teleported:!0,"popper-class":"popover",transition:"fade",trigger:"click","append-to":"body","hide-after":0,onKeyup:d[1]||(d[1]=Ne(V=>$.value=!1,["esc"]))},{reference:u(()=>[qe]),default:u(()=>{var V;return[e(t).isLogin?(i(),B("section",Je,[Ke,v(s,{ref_key:"scollRef",ref:f,"view-class":"p-2 md:p-4 h-50vh md:h-400px",class:"bg-light card-default dark:bg-dark-9"},{default:u(()=>[R((i(),B("div",Qe,[(i(!0),B(Oe,null,$e(e(I),(L,se)=>(i(),N(T,{id:`chat-msg-${L.message.id}`,key:L.message.id,index:se,data:L},null,8,["id","index","data"]))),128))])),[[oe]])]),_:1},512),R((i(),N(x,{ref_key:"formRef",ref:h,model:e(a),disabled:!((V=e(t))!=null&&V.isLogin)||e(r),class:"sticky bottom-0 left-0 mt-2 flex items-center gap-3",onSubmit:X(g,["prevent"])},{default:u(()=>[v(k,{to:"/user/info"},{default:u(()=>[v(w,{src:e(t).userInfo.avatar?("BaseUrlImg"in c?c.BaseUrlImg:e(_e))+e(t).userInfo.avatar:"",class:"h-2.4rem w-2.4rem rounded-1/2 border-default"},null,8,["src"])]),_:1}),v(y,{prop:"content",class:"w-full",rules:[{required:!0,message:"内容不能为空！",trigger:"change"}]},{default:u(()=>[v(m,{modelValue:e(a).content,"onUpdate:modelValue":d[0]||(d[0]=L=>e(a).content=L),modelModifiers:{lazy:!0},disabled:!e(t).isLogin||e(r),placeholder:"快开始对话吧 ✨",class:"content border-0 border-b-1px pt-4 border-default"},null,8,["modelValue","disabled"])]),_:1}),v(_,{class:"group ml-a","icon-class":"i-solar:map-arrow-right-bold-duotone block mr-1",round:"",disabled:!e(t).isLogin||e(r),"transition-icon":"",type:"info",onClick:g},{default:u(()=>[G(" 发送  ")]),_:1},8,["disabled","onClick"])]),_:1},8,["model","disabled"])),[[ae]])])):O("",!0)]}),_:1})]),_:1})}}}),Xe=W(We,[["__scopeId","data-v-e4156316"]]),Ge=Be(()=>ye(()=>import("./ShopCartBar.w8A0YsyM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]),import.meta.url).then(o=>o.default||o)),U=o=>(Z("data-v-7fd9d690"),o=o(),Y(),o),Ze=U(()=>b("i",{class:"h-3/5 w-3/5","i-solar:alt-arrow-up-bold":"","text-light":""},null,-1)),Ye=U(()=>b("i",{class:"i-solar:alt-arrow-left-line-duotone h-2/3 w-2/3","mr-0.5":"","text-light":""},null,-1)),et=[Ye],tt=U(()=>b("i",{"i-solar:headphones-round-sound-line-duotone":"","bg-light":"","p-.7em":""},null,-1)),ot=U(()=>b("i",{class:"h-1/2 w-1/2","i-solar:pen-2-bold-duotone":"","text-light":""},null,-1)),at=[ot],st=F({__name:"index",props:{menu:{default:()=>["shopcart","backtop",{name:"service",methods:()=>{j({path:"/chat?type=service"})}},"aichat"]}},setup(o){const{menu:$}=o,t=new Map;$.forEach(r=>{typeof r=="string"?t.set(r,{name:r,iconClass:"",methods:()=>{}}):typeof r=="object"&&t.set(r.name,r)});const a=K(),l=we();function n(){history.length>1?l.back():j("/")}const p=E(!1);return(r,h)=>{const g=je,I=H,D=Xe,f=Ge,M=Fe,c=H,d=ke,T=Q,s=z("auto-animate");return i(),B("div",null,[v(T,null,{default:u(()=>{var w,k,m,y,_;return[R((i(),B("div",{id:"right-btns-menu",class:C(["group btns bottom-4 flex flex-col",e(p)?"right-2":"-right-10 hover:right-2 sm:right-2"])},[b("div",{key:"top",class:C(["flex-col animate-[300ms_zoom-in] justify-end btn-group",e(p)?"flex":"hidden  sm:flex"])},[v(g,{key:"backtop",class:C([{btn:!((w=e(t).get("backtop"))!=null&&w.isTeleport)},"btn cursor-pointer rounded-1/2 rounded-1/2 shadow-[#0bdb85] shadow-md shadow-opacity-60 transition-300"]),style:{overflow:"visible",width:"3rem",height:"3rem"}},{default:u(()=>[Ze]),_:1},8,["class"]),e(t).has("back")?(i(),B("span",{key:"back",class:"btn bg-[var(--el-color-primary)] shadow-[var(--el-color-primary)] shadow-md shadow-opacity-40","h-3rem":"","w-3rem":"","flex-row-c-c":"","cursor-pointer":"","rounded-4em":"","p-1":"","transition-300":"",onClick:n},et)):O("",!0),e(a).getTokenFn()&&e(t).has("service")?(i(),N(I,{key:"service",to:"/chat?type=service",class:C([{btn:!((k=e(t).get("service"))!=null&&k.isTeleport)},"h-3rem w-3rem flex-row-c-c cursor-pointer border-2px rounded-1/2 bg-[var(--el-color-info)] shadow-[var(--el-color-info)] shadow-lg transition-300 border-default"])},{default:u(()=>[tt]),_:1},8,["class"])):O("",!0),e(a).getTokenFn()&&e(t).has("aichat")?(i(),N(D,{key:2})):O("",!0),e(a).getTokenFn()&&e(t).has("shopcart")?(i(),N(f,{key:"shopcart",class:"h-3rem w-3rem"})):O("",!0),e(t).has("post")&&e(a).getTokenFn()?(i(),N(M,{key:4,placement:"left",content:"新建帖子",class:C({btn:(m=e(t).get("post"))==null?void 0:m.isTeleport}),"popper-class":"singleton-tooltip"},{default:u(()=>[b("span",{key:"post",class:"bg-[var(--el-color-info)] shadow-[var(--el-color-info)] shadow-md shadow-opacity-40","h-3rem":"","w-3rem":"","flex-row-c-c":"","cursor-pointer":"","rounded-4em":"","p-1":"","transition-300":"",onClick:h[0]||(h[0]=(...x)=>{var P,A;return((P=e(t).get("post"))==null?void 0:P.methods)&&((A=e(t).get("post"))==null?void 0:A.methods(...x))})},at)]),_:1},8,["class"])):O("",!0),e(t).has("home")?(i(),N(c,{key:"home",class:C([{btn:(y=e(t).get("home"))==null?void 0:y.isTeleport},"h-3rem w-3rem shadow-[var(--el-color-primary)] shadow-md shadow-opacity-40"]),to:"/",style:{"background-color":"var(--el-color-primary)"},"flex-row-c-c":"","rounded-4em":"","p-1":"","transition-300":"",onClick:(_=e(t).get("home"))==null?void 0:_.methods},{default:u(()=>{var x;return[b("i",{class:C(["i-solar:home-smile-outline p-2.6 text-light",((x=e(t).get("home"))==null?void 0:x.iconClass)||""])},null,2)]}),_:1},8,["class","onClick"])):O("",!0)],2),v(d,{key:"btn",class:"fold z-1 h-3rem w-3rem cursor-pointer rounded-1/2 bg-[var(--el-color-primary)] p-3 text-light transition-300 group-hover:-rotate-90",style:{"box-shadow":"1px 1px 6px var(--el-color-primary-light-3)"},onClick:h[1]||(h[1]=x=>p.value=!e(p))})],2)),[[s]])]}),_:1})])}}}),wt=W(st,[["__scopeId","data-v-7fd9d690"]]);export{wt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./ShopCartBar.w8A0YsyM.js","./checkbox.zfGg0ai0.js","./swiper-vue.Dj7aAS3P.js","./swiper-vue.CRufKKKm.css","./entry.t-rqPOs0.js","./entry.k6-BttGb.css","./isEqual.OSnr_sHV.js","./hasIn.6fummut8.js","./flatten.qRdZVAia.js","./checkbox.MJHvI1xB.css","./ShopLine.8vISMB1F.js","./ElImage.MMEIiX96.js","./debounce.0E-5_dMF.js","./ElImage.dg4y3aGk.css","./nuxt-link.AUBdcVxd.js","./select.CPu1gYEQ.js","./popper.b7Al0Wsi.js","./popper.2BhxBuwE.css","./scrollbar.VqFpSCdd.js","./scrollbar.Smf0pYfu.css","./tag.C0ahusY6.js","./tag.ItIytdvz.css","./strings.Y1vdtDWm.js","./index.dh5FAeg5.js","./select.WyCmEko8.css","./input-number.O-5fmpcb.js","./index.m5OxfFYg.js","./input-number.5AezeF1g.css","./sku.3bWIpLkz.js","./ShopLine.PGliGu9i.css","./AutoIncre.vue.cpfunnOh.js","./index.uAaZKamD.js","./useOrderStore.eUMUt3Tv.js","./index.T5JhbHk1.js","./ShopCartBar.iS6Wm7Is.css","./checkbox-group.d5XbR8TY.css","./popover.N-GW0j1A.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
