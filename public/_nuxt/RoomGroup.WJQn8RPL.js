import{_ as ae}from"./ElImage.H3VTC2Vd.js";import{u as ne,B as G,k as ve,l as Re,f as Q,E as P,m as Be,o as he,S as K,C as ye,p as Fe,c as Oe,d as ze,q as Ae,w as De,n as Ne,r as Ve,t as Ge}from"./entry.HuYbGiLS.js";import{a as Pe,E as je}from"./index.S0AyQ0ue.js";import{_ as we}from"./AutoIncre.vue.KpzenuDu.js";/* empty css              *//* empty css                    */import{u as H,a as qe,R as U,g as He,M as V,b as Xe,c as Ye}from"./contact.IOrl_V-3.js";import{j as D,a as k,k as Z,L as v,a5 as E,a0 as I,u as t,_ as A,Z as C,a3 as O,N as _,ar as q,M as $,x as le,am as ce,an as ue,a9 as de,aa as Ke,X as J,F as ie,W as be,b as z,U as re,a6 as se,ao as Ce,V as Ie,n as ke,a4 as W,ai as We,ab as Ze,o as Je}from"./swiper-vue.4ZhlhtKr.js";import{E as me}from"./scrollbar.ylZGouLy.js";import{E as Qe,a as et}from"./tabs.hIqoD_La.js";import{E as Le}from"./tag.Q9i6oaRN.js";import{_ as tt}from"./Main.vue.pw_WhY3f.js";import{u as fe}from"./useWs.6oZqrKhZ.js";import{E as ot,a as st}from"./select.Bh0wcPP9.js";import{_ as at}from"./OssFileUpload.5SsdOgf4.js";import{_ as nt}from"./nuxt-link.eZ5kOSgI.js";import"./popper.TZrEXPn8.js";import{u as Me}from"./composables.QNi8Zuou.js";import{O as lt,d as rt}from"./index.Rr0j-bh8.js";import{i as it,_ as ct}from"./ApplyDialog.vue.GpPMfClF.js";const ut=g=>(ce("data-v-cc675e82"),g=g(),ue(),g),dt={"w-full":"",flex:"","flex-col":""},mt={class:"group w-fit flex gap-2 bg-white p-2 transition-200 transition-shadow sm:w-full dark:bg-dark md:py-4 text-color"},ft={class:"hidden w-2/3 flex-col justify-between truncate pl-4 sm:flex"},pt={"overflow-hidden":"",truncate:""},gt={"overflow-hidden":"",truncate:"","op-70":""},_t={"ml-a":"","mt-a":"",hidden:"","w-7em":"","flex-shrink-0":"",truncate:"","text-right":"","text-0.7em":"","op-35":"","sm:block":"","group-hover:op-70":""},vt=ut(()=>_("small",{class:"block w-full text-center text-0.8rem opacity-60"}," 暂无更多 ",-1)),ht=D({__name:"ContactList",props:{dto:{}},setup(g){const f=g,u=k(!1),n=ne(),e=k({cursor:null,isLast:!1,size:10}),s=k([]);async function m(r){if(u.value||e.value.isLast)return;u.value=!0;const{data:o}=await qe(e.value.size,e.value.cursor,n.getToken);o.list&&((r==null?void 0:r.type)===U.GROUP?o.list.forEach(c=>{c.type===U.GROUP&&s.value.push(c)}):(r==null?void 0:r.type)===U.SELFT?o.list.forEach(c=>{c.type===U.SELFT&&s.value.push(c)}):s.value.push(...o.list)),e.value.isLast=o.isLast,e.value.cursor=o.cursor,u.value=!1}m(f.dto);const b=Date.now();function h(r){return b-+r>24*3600?ve(r,"YYYY-MM-DD").value.toString():ve(r,"HH:mm:ss").value.toString()}const p=H(),i=Z({get(){return p.theContact.roomId},set(r){const o=s.value.find(c=>c.roomId===r);o&&p.setContact(o)}});function l(r=20,o,c=!0,y){c?(s.value=[],e.value.cursor=null,e.value.isLast=!1,e.value.size=r,m(o||f.dto)):y&&a(y)}async function a(r){if(!r)return;const o=s.value.findIndex(y=>y.roomId===r);if(o===-1)return;const c=await He(r,U.GROUP,n.getToken);c&&(s.value[o]=c.data)}return p.onReloadContact=l,(r,o)=>{const c=ae,y=Re,x=Pe,R=we,X=je;return v(),E(X,{modelValue:t(i),"onUpdate:modelValue":o[1]||(o[1]=T=>le(i)?i.value=T:null),class:"w-full"},{default:I(()=>[_("div",dt,[C(R,{immediate:!0,"auto-stop":!1,"no-more":t(e).isLast,loading:t(u),onLoad:o[0]||(o[0]=T=>m(r.dto))},{done:I(()=>[vt]),default:I(()=>[(v(!0),$(A,null,q(t(s),T=>(v(),E(x,{key:T.roomId,style:{overflow:"hidden"},border:"",label:T.roomId},{default:I(()=>[_("div",mt,[T.unreadCount?(v(),E(y,{key:0,max:99,value:T.unreadCount,class:"h-2.6rem w-2.6rem flex-shrink-0"},{default:I(()=>[C(c,{src:("BaseUrlImg"in r?r.BaseUrlImg:t(G))+T.avatar,fit:"cover",class:"h-2.6rem w-2.6rem rounded-1/2 object-cover border-default"},null,8,["src"])]),_:2},1032,["value"])):(v(),E(c,{key:1,src:("BaseUrlImg"in r?r.BaseUrlImg:t(G))+T.avatar,fit:"cover",class:"h-2.6rem w-2.6rem flex-shrink-0 rounded-1/2 object-cover border-default"},null,8,["src"])),_("div",ft,[_("span",pt,O(T.name),1),_("small",gt,O(T.text),1)]),_("span",_t,O(h(T.activeTime)),1)])]),_:2},1032,["label"]))),128))]),_:1},8,["no-more","loading"])])]),_:1},8,["modelValue"])}}}),yt=Q(ht,[["__scopeId","data-v-cc675e82"]]),wt={class:"absolute right-0 top-0 z-99 cursor-pointer border py-2rem hover:text-[var(--el-color-info)]","h-full":"",flex:"","flex-col":"","justify-between":""},bt=_("span",{"p-1":""},null,-1),wo=D({__name:"ContactTabs",setup(g){const f=k("all"),u=k([{name:"all",title:"全部"},{name:"group",title:"群聊",dto:{type:U.GROUP}},{name:"self",title:"个人",dto:{type:U.SELFT}}]),n=k(!1),e=H();function s(){e.onReloadContact(),P.success("刷新成功!")}return(m,b)=>{const h=yt,p=me,i=Qe,l=et;return v(),$("div",{class:J(["group relative overflow-hidden transition-200 transition-width",t(n)?"w-0":"w-2/7 max-w-2/7"])},[de(C(l,{modelValue:t(f),"onUpdate:modelValue":b[0]||(b[0]=a=>le(f)?f.value=a:null),"tab-position":"top"},{default:I(()=>[(v(!0),$(A,null,q(t(u),(a,r)=>(v(),E(i,{key:r,class:"w-full transform-origin-center-top animate-[300ms_zoom-in]",lazy:"",name:a.name,label:a.title},{default:I(()=>[C(p,{"view-class":" tracking-0.1em pr-2","wrap-class":"w-full"},{default:I(()=>[C(h,{dto:a.dto},null,8,["dto"])]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"]),[[Ke,!t(n)]]),_("div",wt,[_("i",{"opacity-100":"","transition-300":"","group-hover:opacity-100":"","md:opacity-0":"",class:"i-solar:refresh-outline float-right block h-5 w-5 cursor-pointer bg-[var(--el-color-info)] transition-300 hover:rotate-180 text-color",onClick:s}),_("i",{transition:"all op-60 group-hover:op-100 300  cubic-bezier(0.61, 0.225, 0.195, 1.3)","i-solar:alt-arrow-left-bold":"","p-3":"",class:J({"rotate-180":t(n)}),onClick:b[1]||(b[1]=a=>n.value=!t(n))},null,2),bt])],2)}}}),Ct={key:"load","w-full":"","flex-row-c-c":"","py-2":"","text-center":"","text-bluegray":""},It={key:1,class:"animate-fade-in"},kt=D({__name:"DisAutoIncre",props:{noMore:{type:Boolean,default:!1},immediate:{type:Boolean,default:!0},delay:{default:400},loading:{type:Boolean,default:!1},loadingClass:{default:"mx-a my-0.6em h-1.4rem w-1.4rem animate-[spin_2s_infinite_linear] rounded-6px bg-[var(--el-color-primary)]"},autoStop:{type:Boolean,default:!0}},emits:["load"],setup(g,{expose:f,emit:u}){const n=g,e=u,s=k();ie(()=>{n.immediate&&e("load")});let m=Date.now();const{stop:b,isSupported:h}=Be(s,([i])=>{i.isIntersecting?requestAnimationFrame(p):m&&clearInterval(m)});function p(){const i=Date.now();i-m<n.delay||(n.noMore&&n.autoStop?(cancelAnimationFrame(m),b&&b()):(m=i,e("load")))}return n.immediate&&e("load"),be(()=>{cancelAnimationFrame(m),b(),m=null}),z(()=>n.noMore,i=>{i&&n.autoStop&&(cancelAnimationFrame(m),b&&b())}),z(()=>n.loading,i=>{i&&requestAnimationFrame(p)}),f({stop:b,loadMoreRef:s}),(i,l)=>(v(),$(A,null,[i.loading?(v(),$("div",{ref_key:"loadMoreRef",ref:s,key:"loadMoreRef",class:"min-h-1em"},[re(i.$slots,"load",{},()=>[_("div",Ct,[_("div",{class:J(i.loadingClass)},null,2)])])],512)):(v(),$("div",It,[re(i.$slots,"done",{},()=>[!i.noMore&&!i.loading?(v(),$("div",{key:"done","h-2":"","w-full":"","text-center":"","text-bluegray":"",onClick:l[0]||(l[0]=a=>!t(h)&&i.$emit("load"))})):se("",!0)])])),re(i.$slots,"default")],64))}}),Lt=D({__name:"MessageList",setup(g,{expose:f}){const u=H(),n=k(!1),e=ne(),s=k({cursor:null,isLast:!1,size:20});async function m(){var a;if(n.value||s.value.isLast||!u.theContact.roomId)return;n.value=!0;const{data:l}=await Xe(u.theContact.roomId,s.value.size,s.value.cursor,e.getToken);l.list&&l.list.length&&u.theContact.msgList.unshift(...l.list),!l.isLast&&(l!=null&&l.list)&&u.theContact.msgList.length===((a=l==null?void 0:l.list)==null?void 0:a.length)&&u.scrollBottom(),s.value.isLast=l.isLast,s.value.cursor=l.cursor,n.value=!1}z(()=>u.theContact.roomId,l=>{b(),l&&u.setReadList(l)},{immediate:!1}),ie(()=>{u.theContact.roomId&&u.setReadList(u.theContact.roomId)});function b(){u.theContact.msgList.splice(0),s.value={cursor:null,isLast:!1,size:20},m()}const h=fe();ie(()=>{b()}),z(()=>h.wsMsgList.newMsg,l=>{for(const a of l){if(a.message.roomId!==u.theContact.roomId||a.fromUser.userId===e.userInfo.id)continue;if(i(a.message.id))u.onReloadContact(void 0,void 0,!1,a.message.roomId);else{u.theContact.msgList.push(a),u.setReadList(u.theContact.roomId),u.onReloadContact(void 0,void 0,!1,a.message.roomId);return}}},{deep:!0}),z(()=>h.wsMsgList.recallMsg,l=>{for(const a of l){if(a.roomId!==u.theContact.roomId||a.recallUid===e.userInfo.id)continue;const r=i(a.msgId);if(r){r.message.type=V.RECALL,r.message.content=`${u.theContact.type===U.GROUP?`"${r.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,r.message.body=void 0,h.wsMsgList.recallMsg=h.wsMsgList.recallMsg.filter(o=>o.msgId!==a.msgId);return}}},{deep:!0});function p(l){l&&u.theContact.msgList.push(l)}function i(l){return u.theContact.msgList.find(a=>a.message.id===l)}return f({reload:b,appendMsg:p,findMsg:i}),(l,a)=>{const r=tt,o=kt,c=Ce("auto-animate");return de((v(),$("div",Ie({relative:""},l.$attrs,{"w-full":"",flex:"","flex-col":""}),[C(o,{"auto-stop":!1,"no-more":t(s).isLast,loading:t(n)||!t(s).isLast,onLoad:m},{default:I(()=>[(v(!0),$(A,null,q(t(u).theContact.msgList,(y,x)=>(v(),E(r,{id:`chat-msg-${y.message.id}`,key:y.message.id,index:x,data:y},null,8,["id","index","data"]))),128))]),_:1},8,["no-more","loading"])],16)),[[c,{duration:300,easing:"cubic-bezier(0.61, 0.225, 0.195, 1.19)"}]])}}}),Mt=D({__name:"MsgContentCard",props:{data:{}},setup(g){return(f,u)=>{var n,e,s,m;return v(),$("div",null,O(`${(e=(n=f.data)==null?void 0:n.fromUser)==null?void 0:e.nickName}:${(m=(s=f.data)==null?void 0:s.message)==null?void 0:m.content}`),1)}}}),xt=Q(Mt,[["__scopeId","data-v-7491fff6"]]);function Tt(g=null,f=10,u=null,n){return he.get("/chat/room/group/member/page",{roomId:g,pageSize:f,cursor:u},{headers:{Authorization:n}})}var xe=(g=>(g[g.ONLINE=1]="ONLINE",g[g.OFFLINE=0]="OFFLINE",g))(xe||{});function $t(g,f){return he.get(`/chat/room/group/member/list/${g}`,{},{headers:{Authorization:f}})}const Ut={class:"w-full flex animate-[300ms_fade-in] items-center rounded-6px bg-[#ffffff9c] p-2 shadow backdrop-blur-10px border-default dark:bg-dark"},Et={class:"flex flex-col rounded-b-0 px-4 py-2 shadow card-default"},St={class:"relative flex"},Rt={"w-full":"",flex:"","items-center":"","gap-3":""},Bt=D({__name:"MsgForm",emits:["submit"],setup(g,{emit:f}){const u=f,n=ne(),e=H(),s=k({roomId:e.theContact.roomId,msgType:V.TEXT,content:"",body:{}}),m=k();z(()=>{var d,w;return(w=(d=e.replyMsg)==null?void 0:d.message)==null?void 0:w.id},d=>{s.value.body.replyMsgId=d,ke(()=>{var w;m.value&&((w=m.value)==null||w.focus())})});const b=k(),h=k([]);function p(d,w,B){var F;const M=h.value.find(Y=>Y.key===d);if(d&&(M!=null&&M.file)){const Y=window.URL||window.webkitURL;let ee=0,te=0;const j=new Image;j.src=Y.createObjectURL(M==null?void 0:M.file),j.onload=function(){ee=j.width||0,te=j.height||0},s.value={roomId:e.theContact.roomId,msgType:V.IMG,content:s.value.content,body:{url:d,width:ee,height:te,size:(F=M==null?void 0:M.file)==null?void 0:F.size}}}}const i=k();function l(){var d;(d=i.value)==null||d.validate(async w=>{var M;if(s.value.msgType===V.TEXT&&(!s.value.content||((M=s.value.content)==null?void 0:M.trim().length)>500)&&P.error("消息内容不能超过500字！"),!w)return;const B=await Ye({...s.value,roomId:e.theContact.roomId},n.getToken);B.code===K.SUCCESS&&u("submit",B.data),s.value.content="",r()})}let a=0;z(()=>e.theContact.roomId,()=>{r(),a=setTimeout(()=>{var d;e.scrollBottom(),(d=m.value)==null||d.focus()},800)}),be(()=>{clearTimeout(a),clearInterval(a),a=null});function r(){s.value={roomId:e.theContact.roomId,msgType:V.TEXT,content:"",body:{}},h.value.splice(0),e.atUserList.splice(0),e.setReplyMsg({})}function o(){e.theContact.roomId&&(e.setReadList(e.theContact.roomId),setTimeout(()=>{e.scrollBottom()},400))}const c=fe(),y=Z(()=>c.wsMsgList.newMsg.filter(d=>d.roomId===e.theContact.roomId&&d.fromUser.userId===n.userInfo.id).length),x=Me();function R(d,w,B=0){d.preventDefault();const M={x:d.x,y:d.y,theme:x.preference==="dark"?"mac dark":"wind10",items:[{label:"删除",onClick:async()=>{if(!w)return;const F=await rt(w,n.getToken);F.code===K.SUCCESS?(h.value.splice(B,1),P.success("删除成功")):F.code===K.DELETE_ERR&&h.value.splice(B,1),b==null||b.value.resetInput()}}]};ye.showContextMenu(M)}const X=Z(()=>!(n!=null&&n.isLogin)),T=k([]);function S(){e.theContact.roomId&&$t(e.theContact.roomId,n.getToken).then(d=>{d.code===K.SUCCESS&&(T.value=d.data)}).catch(()=>{})}return(d,w)=>{const B=Le,M=Fe,F=ae,Y=xt,ee=ot,te=st,j=at,Te=nt,$e=Oe,Ue=ze,Ee=Ae,Se=Ce("auth");return de((v(),E(Ee,{ref_key:"formRef",ref:i,model:t(s),disabled:t(X),class:"absolute bottom-0 left-0 z-1 mt-2 w-full",onSubmit:Ze(l,["prevent"])},{default:I(()=>{var ge;return[t(y)>0?(v(),E(M,{key:0,class:"w-full cursor-pointer",style:{padding:"0 0.5rem",margin:"0","margin-bottom":"0.4rem",display:"flex","justify-content":"right"},onClick:o},{default:I(()=>[C(B,{type:"info",effect:"dark",round:"",class:"ml-a"},{default:I(()=>[W(" 有"+O(t(y))+"条新消息 ",1)]),_:1})]),_:1})):se("",!0),t(h).length>0?(v(),E(M,{key:1,class:"w-full cursor-pointer",style:{padding:"0 0.5rem",margin:"0","margin-bottom":"0.4rem",display:"flex","justify-content":"center","grid-gap":"0.2rem","margin-left":"auto"}},{default:I(()=>[(v(!0),$(A,null,q(t(h),(L,N)=>(v(),E(F,{key:N,"preview-teleported":"",loading:"lazy","preview-src-list":[L.id||("BaseUrlImg"in d?d.BaseUrlImg:t(G))+L.key],src:L.id||("BaseUrlImg"in d?d.BaseUrlImg:t(G))+L.key,class:"ml-a h-8rem w-8rem overflow-hidden rounded-6px p-2 border-default card-default",onContextmenu:oe=>R(oe,L.key,N)},null,8,["preview-src-list","src","onContextmenu"]))),128))]),_:1})):se("",!0),(ge=t(e).replyMsg)!=null&&ge.fromUser?(v(),E(M,{key:2,prop:"body.replyMsgId",class:"w-full",style:{padding:"0.4rem",margin:"0","margin-bottom":"0.2rem",display:"flex"}},{default:I(()=>[_("div",Ut,[C(B,{effect:"dark",class:"mr-2"},{default:I(()=>[W(" 回复 ")]),_:1}),C(Y,{class:"w-4/5 truncate",data:t(e).replyMsg},null,8,["data"]),_("div",{class:"i-solar:close-circle-bold text-dark op-80 transition-200 transition-color btn-default dark:text-light hover:text-[var(--el-color-danger)]","h-2em":"","w-2em":"",onClick:w[0]||(w[0]=L=>t(e).setReplyMsg({}))})])]),_:1})):se("",!0),_("div",Et,[_("div",St,[C(M,{disabled:t(s).msgType!==("MessageType"in d?d.MessageType:t(V)).TEXT,style:{padding:"0",margin:"0"},prop:"body.atUidList",class:"at-select w-12rem"},{default:I(()=>[C(te,{modelValue:t(e).atUserList,"onUpdate:modelValue":w[1]||(w[1]=L=>t(e).atUserList=L),disabled:t(s).msgType!==("MessageType"in d?d.MessageType:t(V)).TEXT,max:20,"max-collapse-tags":1,clearable:"",filterable:"","collapse-tags":"",multiple:"","default-first-option":"","reserve-keyword":!0,placeholder:"@其他人",onFocus:S,onChange:w[2]||(w[2]=L=>t(s).body.atUidList=L.map(N=>N.userId))},{default:I(()=>[(v(!0),$(A,null,q(t(T),L=>(v(),E(ee,{key:L.userId,label:`@${L.nickName}`,value:L},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["disabled"]),C(M,{style:{padding:"0",margin:"0","margin-left":"0.4em"},prop:"body.url",class:"cursor-pointer"},{default:I(()=>[C(j,{ref_key:"inputOssFileUploadRef",ref:b,modelValue:t(h),"onUpdate:modelValue":w[3]||(w[3]=L=>le(h)?h.value=L:null),multiple:!1,preview:!1,limit:1,class:"i-solar:album-line-duotone h-1.5rem w-1.5rem cursor-pointer","upload-type":("OssFileType"in d?d.OssFileType:t(lt)).IMAGE,"input-class":"op-0 h-1.5rem w-1.5rem cursor-pointer ","upload-quality":.5,onErrorMsg:w[4]||(w[4]=L=>{("ElMessage"in d?d.ElMessage:t(P)).error(L)}),onSubmit:p},null,8,["modelValue","upload-type"])]),_:1})]),_("div",Rt,[C(Te,{to:"/user/info"},{default:I(()=>[C(F,{src:t(n).userInfo.avatar?("BaseUrlImg"in d?d.BaseUrlImg:t(G))+t(n).userInfo.avatar:"",class:"h-2.4rem w-2.4rem rounded-1/2 border-default"},null,8,["src"])]),_:1}),C(M,{prop:"content",class:"w-full"},{default:I(()=>{var L,N,oe;return[C($e,{ref_key:"inputRef",ref:m,modelValue:t(s).content,"onUpdate:modelValue":w[5]||(w[5]=_e=>t(s).content=_e),modelModifiers:{lazy:!0},rows:(L=t(s))!=null&&L.content&&((oe=(N=t(s))==null?void 0:N.content)==null?void 0:oe.length)>30?4:1,maxlength:500,type:"textarea",placeholder:"来聊点什么吧 ✨",class:"input pt-4",onKeyup:w[6]||(w[6]=We(_e=>l(),["enter"]))},null,8,["modelValue","rows"])]}),_:1}),C(Ue,{round:"",disabled:!t(n).isLogin,class:"group ml-a","icon-class":"i-solar:map-arrow-right-bold-duotone block -rotate-45 mr-1",type:"info",onClick:w[7]||(w[7]=L=>l())},{default:I(()=>[W(" 发送  ")]),_:1},8,["disabled"])])])]}),_:1},8,["model","disabled"])),[[Se]])}}}),Ft=Q(Bt,[["__scopeId","data-v-46237e29"]]),Ot=g=>(ce("data-v-4b1243b6"),g=g(),ue(),g),zt={class:"relative flex flex-col"},At={class:"flex-row-bt-c border-0 border-b-1 rounded-0 p-4 border-default card-default md:p-4"},Dt={flex:"","items-center":"","gap-2":""},Nt={class:"relative mt-a flex-1 bg-light-5 p-4 shadow-sm dark:bg-dark-9"},Vt={key:1,class:"h-full w-full flex items-center justify-center"},Gt={flex:"","flex-col":""},Pt=Ot(()=>_("i",{"i-solar:double-alt-arrow-down-line-duotone":"","p-2":""},null,-1)),jt=[Pt],qt=D({__name:"Content",props:{roomId:{}},setup(g){const f=H(),u=Z(()=>{var i;let p="";switch((i=f==null?void 0:f.theContact)==null?void 0:i.type){case U.GROUP:p="群";break;case U.SELFT:p="个";break;case U.AICHAT:p="AI";break}return p}),n=k(),e=k();function s(p){var i;(i=n.value)==null||i.appendMsg(p),h()}const m=k(0);function b(p,i=0){var r;if(!p)return;const l=-10,a=document.querySelector(`#chat-msg-${p}`);!a||!((r=n.value)!=null&&r.findMsg(p))?m.value=setTimeout(()=>{var o;(o=e==null?void 0:e.value)==null||o.setScrollTop(0),b(p,i),a&&(m.value&&clearTimeout(m.value),m.value=null)},400):(m.value&&clearTimeout(m.value),m.value=null),ke(()=>{var o,c,y,x,R;a.classList.add("reply-shaing"),m.value=setTimeout(()=>{a.classList.remove("reply-shaing"),m.value=null},3e3),(c=(o=e.value)==null?void 0:o.wrapRef)!=null&&c.scrollTo?(x=(y=e.value)==null?void 0:y.wrapRef)==null||x.scrollTo({top:((a==null?void 0:a.offsetTop)||0)+l,behavior:"smooth"}):(R=e.value)==null||R.setScrollTop(((a==null?void 0:a.offsetTop)||0)+l)})}function h(){m.value=setTimeout(()=>{var p,i,l,a,r,o,c,y,x;(i=(p=e.value)==null?void 0:p.wrapRef)!=null&&i.scrollTo?(o=(l=e.value)==null?void 0:l.wrapRef)==null||o.scrollTo({top:((r=(a=e==null?void 0:e.value)==null?void 0:a.wrapRef)==null?void 0:r.scrollHeight)+20||0,behavior:"smooth"}):(x=e.value)==null||x.setScrollTop(((y=(c=e==null?void 0:e.value)==null?void 0:c.wrapRef)==null?void 0:y.scrollHeight)+20||0)},300)}return f.scrollBottom=h,f.scrollReplyMsg=b,Je(()=>{m.value&&clearTimeout(m.value),m.value=null}),(p,i)=>{const l=ae,a=Le,r=Lt,o=me,c=Ft;return v(),$("div",zt,[_("h4",At,[_("div",Dt,[C(l,{src:("BaseUrlImg"in p?p.BaseUrlImg:t(G))+t(f).theContact.avatar,class:"h-2.2rem w-2.2rem object-cover border-default card-default"},null,8,["src"]),W(" "+O(t(f).theContact.name)+" ",1),C(a,{effect:"dark",size:"small"},{default:I(()=>[W(O(t(u)),1)]),_:1})])]),_("div",Nt,[C(o,{ref_key:"scrollbarRef",ref:e,"wrap-class":"w-full h-70vh","view-class":"msg-list w-full h-70vh pr-2 "},{default:I(()=>[t(f).theContact.roomId?(v(),E(r,{key:0,ref_key:"ChatMessageListRef",ref:n,class:"pb-7rem pt-2rem",onScrollBottom:h},null,512)):(v(),$("div",Vt," 开启聊天吧 "))]),_:1},512),_("div",Gt,[_("div",{class:"ml-a w-fit rounded-10px p-1 px-3 btn-primary-bg border-default v-card",onClick:h},jt),C(c,{onSubmit:s})])])])}}}),bo=Q(qt,[["__scopeId","data-v-4b1243b6"]]),pe=g=>(ce("data-v-904808ef"),g=g(),ue(),g),Ht=pe(()=>_("i",{transition:"all  op-60 group-hover:op-100 300  cubic-bezier(0.61, 0.225, 0.195, 1.3)","i-solar:signpost-2-line-duotone":"","p-2.2":""},null,-1)),Xt=pe(()=>_("span",{"ml-4em":"",truncate:"","text-center":""},"群成员",-1)),Yt=[Ht,Xt],Kt=["onContextmenu","onClick"],Wt={class:"relative flex-row-c-c"},Zt=pe(()=>_("span",{class:"g-avatar"},null,-1)),Jt=D({__name:"RoomGroup",setup(g){const f=H(),u=k(!1),n=k(!1),e=ne(),s=k({cursor:null,isLast:!1,size:10});f.onOfflineList.splice(0);async function m(){if(n.value||s.value.isLast||f.theContact.type!==U.GROUP)return;n.value=!0;const{data:o}=await Tt(f.theContact.roomId,s.value.size,s.value.cursor,e.getToken);o.list&&f.onOfflineList.push(...o.list),s.value.isLast=o.isLast,s.value.cursor=o.cursor,n.value=!1}function b(){f.onOfflineList=[],s.value={cursor:null,isLast:!1,size:10},n.value=!1,m()}const h=k(),p=k(),i=Me();function l(o,c){o.preventDefault(),ye.showContextMenu({x:o.x,y:o.y,theme:i.preference==="dark"?"mac dark":"wind10",items:[{label:"个人主页",onClick:()=>{Ne({path:"/user/info",query:{id:c.userId},replace:!1})}},{label:"@他",onClick:()=>{f.setAtUid(c)}},{label:"添加好友",onClick:()=>{it({uidList:[c.userId]},e.getToken).then(y=>{if(y.code!==K.SUCCESS)return P.error(y.msg||"申请失败，请稍后再试！");const x=y.data.checkedList.find(R=>R.uid===c.userId);if(x&&x.isFriend)return P.error("申请失败，和对方已是好友！");h.value=c,p.value=!0}).catch(()=>{})}},{label:"其他",children:[{label:"分享",onClick:async()=>{await Ve(`${Ge}/user/info?id=${c.userId}`),P.success({message:"成功复制至剪贴板！",grouping:!0})}}]}]})}De(()=>f.theContact.roomId,o=>{o&&f.theContact.type===U.GROUP&&b()});const a=fe();z(()=>a.wsMsgList.onlineNotice,o=>{for(const c of o){if(!c.changeList)return;for(const y of f.onOfflineList)for(const x of c.changeList)if(x.userId===y.userId){y.activeStatus=x.activeStatus;break}}},{deep:!0,immediate:!1});const r=Z(()=>f.onOfflineList.sort((o,c)=>c.activeStatus-o.activeStatus));return(o,c)=>{var T;const y=ae,x=we,R=me,X=ct;return v(),$(A,null,[_("div",Ie(o.$attrs,{class:["relative flex flex-col gap-2 p-4 transition-200 transition-width",t(u)||t(f).theContact.type!==("RoomType"in o?o.RoomType:t(U)).GROUP?"w-0":"w-1/5"]}),[_("div",{class:J(["block cursor-pointer gap-2 border -ml-4 hover:text-[var(--el-color-info)]",{"":t(u)}]),onClick:c[0]||(c[0]=S=>u.value=!t(u))},Yt,2),C(R,{class:"py-2rem","view-class":"h-70vh tracking-0.1em","wrap-class":"w-full"},{default:I(()=>[C(x,{immediate:!0,"auto-stop":!1,"no-more":t(s).isLast,loading:t(n),onLoad:m},{default:I(()=>[(v(!0),$(A,null,q(t(r),S=>(v(),$("div",{key:S.userId,class:J(["hover:bg-while relative mb-2 flex items-center gap-1 truncate rounded-2rem p-2 filter-grayscale transition-300 transition-all active:scale-96 border-default hover:border-[var(--el-color-primary)] hover:op-100 hover:shadow hover:shadow-inset hover:dark:bg-dark-9",S.activeStatus===("ChatOfflineType"in o?o.ChatOfflineType:t(xe)).ONLINE?"live":"op-50 filter-grayscale filter-grayscale-100 "]),onContextmenu:d=>l(d,S),onClick:d=>l(d,S)},[_("div",Wt,[C(y,{src:("BaseUrlImg"in o?o.BaseUrlImg:t(G))+S.avatar,fit:"cover",class:"h-2.2em w-2.2em flex-shrink-0 overflow-auto rounded-1/2 object-cover border-default"},null,8,["src"]),Zt]),_("small",null,O(S.nickName||"未填写"),1)],42,Kt))),128))]),_:1},8,["no-more","loading"])]),_:1})],16),C(X,{show:t(p),"onUpdate:show":c[1]||(c[1]=S=>le(p)?p.value=S:null),"user-id":(T=t(h))==null?void 0:T.userId},null,8,["show","user-id"])],64)}}}),Co=Q(Jt,[["__scopeId","data-v-904808ef"]]);export{wo as _,bo as a,Co as b};
