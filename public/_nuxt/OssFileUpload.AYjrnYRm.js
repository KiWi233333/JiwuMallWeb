import{u as N,a9 as Q,S as _,E as X,B as Z,b5 as H,f as J}from"./entry.t-rqPOs0.js";import{E as K}from"./ElImage.MMEIiX96.js";import{E as W}from"./progress.FoUIz2xX.js";import{j as Y,a as C,k as x,b as ee,ap as te,ab as V,O as c,P as p,Q as m,$ as L,Z as y,u as f,a0 as $,as as M,a7 as O,X as E,ad as R,a8 as k,a5 as se,ac as ae}from"./swiper-vue.Dj7aAS3P.js";import{O as h,g as re,c as oe,u as le,a as ne,d as ie}from"./index.keDQovFV.js";const ue={class:"input-list relative flex cursor-pointer select-none"},ce=["multiple","accept","required","disabled","draggable"],de={class:"absolute left-0 top-0 h-full w-full flex-row-c-c"},pe={key:1,class:"pre-group-hover absolute h-full w-full flex-row-c-c gap-1 opacity-0 backdrop-blur-12px transition-300"},ve=["onClick"],me=["onClick"],fe=["src"],be={class:"absolute left-0 top-0 z-1 h-1/4 w-full flex-row-c-c"},he=["onClick"],ge={key:2,class:"pre-group-hover absolute left-0 top-0 h-full w-full flex-row-c-c gap-1 opacity-0 backdrop-blur-20px transition-300 v-card"},ye=["onClick"],ke=Y({__name:"OssFileUpload",props:{limit:{default:1},multiple:{type:Boolean,default:!1},required:{type:Boolean,default:!1},modelValue:{default:()=>[]},preview:{type:Boolean,default:!0},disable:{type:Boolean,default:!1},uploadQuality:{default:.6},accept:{default:"image/*"},uploadType:{default:h.IMAGE},size:{},draggable:{type:Boolean},errorClass:{},inputClass:{}},emits:["submit","errorMsg","update:modelValue"],setup(F,{expose:q,emit:j}){const a=F,b=j,I=N(),r=C(a.modelValue||[]),g=x(()=>D(r.value));function D(e){const s=[];if(e)for(let o=0;o<e.length;o++){const l=e[o];l.key&&s.push(l.key)}return s}const d=C(""),z=C();async function P(e){var o;if(a.disable)return;const s=e.target;if((o=s.files)!=null&&o.length)if(a.limit===1)await S({id:URL.createObjectURL(s.files[0]),key:void 0,status:"",percent:0,file:s.files[0]});else{if(s.files.length>a.limit||r.value.length+s.files.length>a.limit)return b("errorMsg",`最多只能上传${a.limit}个文件`),d.value=`最多只能上传${a.limit}个文件`;d.value="";const l=[...s.files].map(n=>({id:a.uploadType===h.IMAGE?URL.createObjectURL(n):Q+n,key:void 0,status:"",percent:0,file:n}));for(const n of l)S(n)}}async function S(e){var l,n;if(a.size!==void 0&&((l=e==null?void 0:e.file)!=null&&l.size)&&((n=e==null?void 0:e.file)==null?void 0:n.size)>a.size){d.value=`文件大小不能超过${a.size/1024/1024}M`;return}else d.value="";const s=await re(a.uploadType,I.getToken);if(s.code!==_.SUCCESS){d.value=s.message,e.status="warning";return}else e.key=s.data.key;const o={quality:a.uploadQuality||.6,noCompressIfLarger:!0};e!=null&&e.file&&(r.value.push(e),a.uploadType===h.IMAGE?oe(e==null?void 0:e.file,o).then(v=>{T(v.dist,(e==null?void 0:e.key)||"",s.data.uploadToken,e)}):T(e.file,(e==null?void 0:e.key)||"",s.data.uploadToken,e))}function T(e,s,o,l){const n=le(e,s,o),v=r.value.find(u=>u.key===s)||l,t=n.subscribe({next(u){v.percent=+u.total.percent.toFixed(2)},error(u){v.status="warning";const i=u;i!=null&&i.code?(d.value=ne(i==null?void 0:i.code)||"上传失败，请稍后再试！",b("errorMsg",d.value)):(v.status="success",X.error("上传失败，稍后再试！"))},complete(){const u=r.value.find(i=>i.key===s)||l;u.status="success",u.percent=100,b("update:modelValue",r.value),b("submit",v.key,g.value,r.value)}});l.subscribe=t}async function w(e){if(!e.key)return;let s=!1;if(e.key){const o=await ie(e.key,I.getToken);o.code===_.SUCCESS?(r.value.splice(r.value.findIndex(l=>l.key===e.key),1),s=!0):o.code===_.DELETE_ERR&&r.value.splice(r.value.findIndex(l=>l.key===e.key),1)}else r.value.splice(r.value.findIndex(o=>o.id===e.id),1);return b("update:modelValue",r.value),b("submit","",g.value,r.value),s}function A(){}const B=x(()=>{const e=[];return a.limit===1&&e.push("absolute top-0 z-1"),a.inputClass&&e.push(a==null?void 0:a.inputClass),e});q({inputRef:z,fileList:r,pathList:g,removeItem:w,resetInput:A}),ee(()=>a.modelValue,e=>{e&&(r.value=e)},{immediate:!0});const G=x(()=>a.preview?g.value.map(e=>Z+e):[]);return(e,s)=>{const o=H,l=K,n=W,v=te("auto-animate");return V((c(),p("div",ue,[m("div",{key:"inputs","flex-row-c-c":"","transition-300":"","hover:border":"[var(--el-color-primary)]",class:y(["relative z-1 backdrop-blur-12px border-default-dashed hover:text-[var(--el-color-primary)]",e.inputClass])},[m("input",{ref_key:"inputRef",ref:z,class:"z-10 block h-full w-full cursor-pointer opacity-0 absolute-center",type:"file",multiple:e.multiple,accept:e.accept,required:e.required,disabled:e.disable,draggable:e.draggable,onChange:P},null,40,ce),L(o,{class:"h-1/3 w-1/3 absolute-center"})],2),e.uploadType===f(h).IMAGE?(c(!0),p($,{key:0},M(f(r),(t,u)=>(c(),p("div",{key:t.id,class:y(["pre-group flex flex-shrink-0 overflow-hidden backdrop-blur-12px",f(B)])},[L(l,{loading:"lazy",alt:t.id,fit:"cover",src:t.id,"preview-src-list":f(G),"preview-teleported":"","initial-index":u,class:"relative h-full w-full select-none object-cover"},null,8,["alt","src","preview-src-list","initial-index"]),m("div",de,[t.status!=="success"?(c(),O(n,{key:0,style:{"aspect-ratio":"1/1",height:"100%",padding:"16%"},color:"var(--el-color-primary)",class:"backdrop-blur-12px",striped:"","striped-flow":"",type:"circle",percentage:t==null?void 0:t.percent,status:t.status},null,8,["percentage","status"])):(c(),p("div",pe,[E(e.$slots,"pre-btns",{},()=>[m("i",{class:"pre-btn hover:bg-[var(--el-color-danger)]","i-solar:trash-bin-trash-bold-duotone":"",onClick:R(i=>w(t),["stop"])},null,8,ve),t!=null&&t.percent&&(t==null?void 0:t.percent)<100?(c(),p("div",{key:0,class:"h-1/5 max-h-2rem max-w-2rem w-1/5 cursor-pointer hover:bg-[var(--el-color-danger)]","i-solar:close-circle-bold-duotone":"",onClick:R(i=>{var U;return(U=t==null?void 0:t.subscribe)==null?void 0:U.unsubscribe()},["stop"])},null,8,me)):k("",!0)],!0)]))])],2))),128)):k("",!0),e.uploadType===f(h).VIDEO?(c(!0),p($,{key:1},M(e.modelValue,t=>(c(),p("div",{key:t.id,class:y(["pre-group relative flex-shrink-0 overflow-hidden backdrop-blur-12px",f(B)])},[m("video",{src:t.id,controls:"","z-0":"","h-full":"","w-full":"","select-none":"","object-cover":""},null,8,fe),m("div",be,[t!=null&&t.percent&&(t==null?void 0:t.percent)<100?(c(),O(n,{key:0,style:{width:"100%",height:"100%",padding:"16%"},color:"var(--el-color-primary)",class:"backdrop-blur-12px",striped:"","striped-flow":"",type:"circle",percentage:t==null?void 0:t.percent,status:t==null?void 0:t.status},null,8,["percentage","status"])):k("",!0),!(t!=null&&t.percent)&&(t==null?void 0:t.percent)<100?(c(),p("div",{key:1,class:"z-2 h-1/5 max-h-2rem max-w-2rem w-1/5 cursor-pointer hover:bg-[var(--el-color-danger)]","i-solar:close-circle-bold":"",onClick:u=>{var i;return(i=t==null?void 0:t.subscribe)==null?void 0:i.unsubscribe()}},null,8,he)):(c(),p("div",ge,[E(e.$slots,"pre-btns",{},()=>[m("div",{class:"h-full max-h-2rem max-w-2rem w-1/5 cursor-pointer hover:bg-[var(--el-color-danger)]","i-solar:trash-bin-trash-bold-duotone":"",onClick:u=>w(t)},null,8,ye)],!0)]))])],2))),128)):k("",!0),E(e.$slots,"default",{},void 0,!0),V(m("div",{class:y([e.errorClass,"m-1 block w-full overflow-hidden truncate text-[var(--el-color-danger)] leading-1em opacity-80"])},se(f(d)),3),[[ae,f(d)]])])),[[v]])}}}),Ie=J(ke,[["__scopeId","data-v-1146d693"]]);export{Ie as _};
