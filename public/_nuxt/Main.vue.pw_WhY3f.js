import{_ as V}from"./ElImage.H3VTC2Vd.js";import{E as j}from"./tag.Q9i6oaRN.js";import{u as G,B as R,k as T,E as p,C as P,g as z,S as O,f as Y}from"./entry.HuYbGiLS.js";import{u as F,r as X,M,R as Z}from"./contact.IOrl_V-3.js";import{u as q}from"./composables.QNi8Zuou.js";import{j as H,C as J,L as i,M as u,N as d,Z as K,u as s,a3 as f,a5 as A,a0 as Q,a4 as W,a6 as m,V as L,_ as ee,a1 as se}from"./swiper-vue.4ZhlhtKr.js";const re=["label"],te={class:"flex flex-shrink-0 flex-col"},ae={class:"mb-2 block flex flex-row items-center gap-2"},oe={class:"self-child msg-popper w-fit p-2 px-4 leading-1.2em shadow-sm card-default"},ne={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},le=H({__name:"AiMsg",props:{data:{},index:{}},setup($){var g;const o=$,{data:t}=J(o),c=F(),a=G(),B=Date.now();function S(r){return B-+r>24*3600?T(r,"YYYY-MM-DD HH:mm:ss").value.toString():T(r,"HH:mm:ss").value.toString()}function N(r,e){z.confirm("是否确认撤回消息？","撤回提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0,callback:async l=>{if(l!=="confirm")return;(await X(r,e,a.getToken)).code===O.SUCCESS&&(p.success("撤回成功！"),o.data.message.id===e&&(o.data.message.type=M.RECALL,o.data.message.content=`${c.theContact.type===Z.GROUP?`"${o.data.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,o.data.message.body=void 0))}})}const D=q();function E(r,e){r.preventDefault();const l={x:r.x,y:r.y,theme:D.preference==="dark"?"mac dark":"wind10",items:[{label:"回复",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能回复自己的消息！");c.setReplyMsg(e)}},{label:"@TA",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能 @ 自己！");c.setAtUid({userId:e.fromUser.userId,nickName:e.fromUser.nickName,gender:e.fromUser.gender,avatar:e.fromUser.avatar})}}]};e.fromUser.userId===a.userInfo.id&&l.items.unshift({label:"撤回",onClick:()=>{e.fromUser.userId===a.userInfo.id&&N(e.message.roomId,e.message.id)}}),P.showContextMenu(l)}const n=((g=o.data.message)==null?void 0:g.body)||{};return(r,e)=>{var _,k,x,I,U;const l=V,y=j;return i(),u(ee,null,[d("div",L(r.$attrs,{label:s(t).roomId,class:{self:((k=(_=s(t))==null?void 0:_.fromUser)==null?void 0:k.userId)===((x=s(a))==null?void 0:x.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","flex-shrink-0":"","gap-4":"","p-2":"","py-3":"","transition-300":"","transition-transform":"","active:scale-95":"",onContextmenu:e[1]||(e[1]=C=>E(C,s(t)))}),[K(l,{src:("BaseUrlImg"in r?r.BaseUrlImg:s(R))+s(t).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem flex-shrink-0 rounded-1/2 object-cover border-default"},null,8,["src"]),d("div",te,[d("div",ae,[d("small",null,f(s(t).fromUser.nickName),1),s(t).fromUser.userId===s(a).userInfo.id?(i(),A(y,{key:0,class:"op-80",effect:"dark",size:"small"},{default:Q(()=>[W(" 自己 ")]),_:1})):m("",!0)]),d("p",oe,f(s(t).message.content),1),(I=s(n))!=null&&I.reply?(i(),u("small",{key:0,"mt-2":"",class:"cursor-pointer truncate px-2 py-1 op-70 border-default card-default",onClick:e[0]||(e[0]=C=>{var v,b,w,h;return s(c).scrollReplyMsg((b=(v=s(n))==null?void 0:v.reply)==null?void 0:b.id,(h=(w=s(n))==null?void 0:w.reply)==null?void 0:h.gapCount)})}," 回复: "+f(`${s(n).reply.nickName}:${((U=s(n).reply)==null?void 0:U.body)||""}`),1)):m("",!0)])],16,re),r.index%8===0?(i(),u("p",ne,f(S(s(t).message.sendTime)),1)):m("",!0)],64)}}}),ce=Y(le,[["__scopeId","data-v-e849e77c"]]),de=["label"],ie={class:"flex flex-col"},fe={class:"mb-2 block flex flex-row items-center gap-2"},me={class:"self-child msg-popper w-fit p-3 shadow-sm card-default",style:{"border-radius":"6px"}},ue={"mt-2":"","leading-1.2em":""},pe={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},ge=H({__name:"Img",props:{data:{},index:{}},setup($){var g;const o=$,{data:t}=J(o),c=F(),a=G(),B=Date.now();function S(r){return B-+r>24*3600?T(r,"YYYY-MM-DD HH:mm:ss").value.toString():T(r,"HH:mm:ss").value.toString()}function N(r,e){z.confirm("是否确认撤回消息？","撤回提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0,callback:async l=>{if(l!=="confirm")return;(await X(r,e,a.getToken)).code===O.SUCCESS&&(p.success("撤回成功！"),o.data.message.id===e&&(o.data.message.type=M.RECALL,o.data.message.content=`${c.theContact.type===Z.GROUP?`"${o.data.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,o.data.message.body=void 0))}})}const D=q();function E(r,e){r.preventDefault();const l={x:r.x,y:r.y,theme:D.preference==="dark"?"mac dark":"wind10",items:[{label:"回复",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能回复自己的消息！");c.setReplyMsg(e)}},{label:"@TA",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能 @ 自己！");c.setAtUid({userId:e.fromUser.userId,nickName:e.fromUser.nickName,gender:e.fromUser.gender,avatar:e.fromUser.avatar})}}]};e.fromUser.userId===a.userInfo.id&&l.items.unshift({label:"撤回",onClick:()=>{e.fromUser.userId===a.userInfo.id&&N(e.message.roomId,e.message.id)}}),P.showContextMenu(l)}const n=((g=o.data.message)==null?void 0:g.body)||{};return(r,e)=>{var _,k,x,I,U;const l=V,y=j;return i(),u(ee,null,[d("div",L(r.$attrs,{label:s(t).roomId,class:{self:((k=(_=s(t))==null?void 0:_.fromUser)==null?void 0:k.userId)===((x=s(a))==null?void 0:x.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","gap-4":"","p-2":"","py-3":"","transition-300":"","transition-transform":"","active:scale-95":"",onContextmenu:e[1]||(e[1]=C=>E(C,s(t)))}),[K(l,{src:("BaseUrlImg"in r?r.BaseUrlImg:s(R))+s(t).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem rounded-1/2 object-cover border-default"},null,8,["src"]),d("div",ie,[d("div",fe,[d("small",null,f(s(t).fromUser.nickName),1),s(t).fromUser.userId===s(a).userInfo.id?(i(),A(y,{key:0,class:"op-80",effect:"dark",size:"small"},{default:Q(()=>[W(" 自己 ")]),_:1})):m("",!0)]),d("div",me,[s(n).url?(i(),A(l,{key:0,src:("BaseUrlImg"in r?r.BaseUrlImg:s(R))+s(n).url,class:"h-8rem w-8rem border-default v-card","preview-teleported":"",alt:s(n).url,"preview-src-list":[("BaseUrlImg"in r?r.BaseUrlImg:s(R))+s(n).url]},null,8,["src","alt","preview-src-list"])):m("",!0),d("p",ue,f(s(t).message.content),1)]),(I=s(n))!=null&&I.reply?(i(),u("small",{key:0,"mt-2":"",class:"cursor-pointer truncate px-2 py-1 op-70 border-default card-default",onClick:e[0]||(e[0]=C=>{var v,b,w,h;return s(c).scrollReplyMsg((b=(v=s(n))==null?void 0:v.reply)==null?void 0:b.id,(h=(w=s(n))==null?void 0:w.reply)==null?void 0:h.gapCount)})}," 回复: "+f(`${s(n).reply.nickName}:${((U=s(n).reply)==null?void 0:U.body)||""}`),1)):m("",!0)])],16,de),r.index%8===0?(i(),u("p",pe,f(S(s(t).message.sendTime)),1)):m("",!0)],64)}}}),ye=Y(ge,[["__scopeId","data-v-154c941a"]]),_e={"w-full":"","flex-row-c-c":"",truncate:"","p-2":"","text-center":""},ke={class:"rounded-1em px-4 py-1 text-0.8rem font-500 op-60 border-default card-default"},xe=H({__name:"Recall",props:{data:{}},setup($){return(o,t)=>{var c,a;return i(),u("div",_e,[d("span",ke,f((a=(c=o.data)==null?void 0:c.message)==null?void 0:a.content),1)])}}}),Ie=Y(xe,[["__scopeId","data-v-fe0ffe77"]]),Ue=["label"],Ce={class:"flex flex-col"},ve={class:"mb-2 block flex flex-row items-center gap-2"},be={class:"self-child msg-popper w-fit p-2 px-4 leading-1.2em shadow-sm card-default"},we={key:0,"w-full":"","py-2":"","text-center":"","text-0.8em":"","op-80":""},he=H({__name:"Text",props:{data:{},index:{}},setup($){var g;const o=$,{data:t}=J(o),c=F(),a=G(),B=Date.now();function S(r){return B-+r>24*3600?T(r,"YYYY-MM-DD HH:mm:ss").value.toString():T(r,"HH:mm:ss").value.toString()}function N(r,e){z.confirm("是否确认撤回消息？","撤回提示",{lockScroll:!1,confirmButtonText:"确 认",confirmButtonClass:"el-button--primary is-plain border-default ",cancelButtonText:"取 消",center:!0,callback:async l=>{if(l!=="confirm")return;(await X(r,e,a.getToken)).code===O.SUCCESS&&(p.success("撤回成功！"),o.data.message.id===e&&(o.data.message.type=M.RECALL,o.data.message.content=`${c.theContact.type===Z.GROUP?`"${o.data.fromUser.nickName}"`:'"对方"'}撤回了一条消息`,o.data.message.body=void 0))}})}const D=q();function E(r,e){r.preventDefault();const l={x:r.x,y:r.y,theme:D.preference==="dark"?"mac dark":"wind10",items:[{label:"回复",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能回复自己的消息！");c.setReplyMsg(e)}},{label:"@TA",onClick:()=>{if(a.userInfo.id===e.fromUser.id)return p.warning("不能 @ 自己！");c.setAtUid({userId:e.fromUser.userId,nickName:e.fromUser.nickName,gender:e.fromUser.gender,avatar:e.fromUser.avatar})}}]};e.fromUser.userId===a.userInfo.id&&l.items.unshift({label:"撤回",onClick:()=>{e.fromUser.userId===a.userInfo.id&&N(e.message.roomId,e.message.id)}}),P.showContextMenu(l)}const n=((g=o.data.message)==null?void 0:g.body)||{};return(r,e)=>{var _,k,x,I,U;const l=V,y=j;return i(),u(ee,null,[d("div",L(r.$attrs,{label:s(t).roomId,class:{self:((k=(_=s(t))==null?void 0:_.fromUser)==null?void 0:k.userId)===((x=s(a))==null?void 0:x.userInfo.id)},"max-w-full":"","w-fit":"",flex:"","gap-4":"","p-2":"","py-3":"","transition-300":"","transition-transform":"","active:scale-95":"",onContextmenu:e[1]||(e[1]=C=>E(C,s(t)))}),[K(l,{src:("BaseUrlImg"in r?r.BaseUrlImg:s(R))+s(t).fromUser.avatar,fit:"cover",class:"avatar h-2.4rem w-2.4rem flex-shrink-0 rounded-1/2 object-cover border-default"},null,8,["src"]),d("div",Ce,[d("div",ve,[d("small",null,f(s(t).fromUser.nickName),1),s(t).fromUser.userId===s(a).userInfo.id?(i(),A(y,{key:0,class:"op-80",effect:"dark",size:"small"},{default:Q(()=>[W(" 自己 ")]),_:1})):m("",!0)]),d("p",be,f(s(t).message.content),1),(I=s(n))!=null&&I.reply?(i(),u("small",{key:0,"mt-2":"",class:"cursor-pointer truncate px-2 py-1 op-70 border-default card-default",onClick:e[0]||(e[0]=C=>{var v,b,w,h;return s(c).scrollReplyMsg((b=(v=s(n))==null?void 0:v.reply)==null?void 0:b.id,(h=(w=s(n))==null?void 0:w.reply)==null?void 0:h.gapCount)})}," 回复: "+f(`${s(n).reply.nickName}:${((U=s(n).reply)==null?void 0:U.body)||""}`),1)):m("",!0)])],16,Ue),r.index%8===0?(i(),u("p",we,f(S(s(t).message.sendTime)),1)):m("",!0)],64)}}}),Me=Y(he,[["__scopeId","data-v-aa241f3c"]]),Ee=H({__name:"Main",props:{data:{},index:{}},setup($){const o={[M.TEXT]:Me,[M.RECALL]:Ie,[M.IMG]:ye,[M.AI_CHAT]:ce};return(t,c)=>{var a;return i(),A(se(o[((a=t.data.message)==null?void 0:a.type)||s(M).TEXT]),L({index:t.index,data:t.data},t.$attrs),null,16,["index","data"])}}});export{Ee as _};
