import{u as Z,B as pe,S as R,f as te,E as B,g as fe,z as ge,v as ve,A as de,D as me,c as Ie,p as $e,q as xe,d as _e,j as Ue,P as G,F as Te,n as De,_ as Le,e as Be,a as qe}from"./entry.HuYbGiLS.js";import{_ as Pe}from"./OssFileUpload.5SsdOgf4.js";import{a as Fe,E as Oe}from"./index.S0AyQ0ue.js";import{_ as Me}from"./ElImage.H3VTC2Vd.js";import{E as be,a as ye}from"./select.Bh0wcPP9.js";import"./tag.Q9i6oaRN.js";import"./scrollbar.ylZGouLy.js";import"./popper.TZrEXPn8.js";import{a as Ne}from"./category.sBcSORba.js";import{j as Q,a as I,F as Re,L as m,M as V,N as M,Z as u,a0 as i,_ as H,u as t,a3 as X,a5 as U,ar as Y,V as he,x as ae,U as je,am as Ae,an as ze,k as K,ah as Ge,a9 as ke,r as He,a4 as L,a6 as ee,K as Ke}from"./swiper-vue.4ZhlhtKr.js";import{E as J}from"./notification.mMgfY760.js";import{g as Je,O as Ze,c as Qe,u as We,a as Xe,d as Ye}from"./index.Rr0j-bh8.js";import{_ as et}from"./StatusTag.12yTdzVi.js";/* empty css              *//* empty css                    */import{c as D,d as tt,u as at,e as ot,f as st,h as lt}from"./post.vbJ-6447.js";import"./progress.UYU20Rtn.js";import"./PreLoading.vue.RcEKquDI.js";import"./debounce.4-I_Xkye.js";import"./strings.PBHHvk2X.js";import"./isEqual.gU3elsgQ.js";import"./hasIn.gQarB0Dl.js";import"./index.O6n8D2HD.js";import"./isUndefined.IZwZ21d-.js";import"./fetch.3IR0ILJ_.js";const rt=T=>(Ae("data-v-d94657d1"),T=T(),ze(),T),nt={class:"flex flex-col"},it={class:"max-w-20rem w-16rem flex items-center border-gray-400 rounded-1rem border-default-dashed"},ut=rt(()=>M("i",{"i-solar:asteroid-line-duotone":"","mx-2":"","p-0.5em":"","opacity-70":""},null,-1)),dt={"h-3rem":"",flex:"","items-center":"","gap-2":"","text-center":""},mt=Q({__name:"CategorySelect",props:{modelValue:{default:""}},emits:["update:modelValue"],setup(T,{emit:q}){Z();const $=I(""),f=I([]),s=I(!1);async function p(){const o=await Ne();(o==null?void 0:o.code)===R.SUCCESS&&(f.value=(o==null?void 0:o.data)||[])}return Re(()=>{p()}),(o,S)=>{const d=Me,k=be,x=ye;return m(),V("div",nt,[M("div",it,[ut,u(x,he({modelValue:t($),"onUpdate:modelValue":S[0]||(S[0]=a=>ae($)?$.value=a:null),class:"select mr-2","no-data-text":"没有数据",multiple:!1,filterable:"",clearable:""},o.$attrs,{placeholder:"选择发布的圈子",loading:t(s),onFocus:p,onChange:S[1]||(S[1]=a=>o.$emit("update:modelValue",a))}),{default:i(()=>[(m(!0),V(H,null,Y(t(f),a=>(m(),U(k,{key:a.id,label:a.name,value:a.id,style:{height:"auto"},class:"relative"},{default:i(()=>[M("div",dt,[u(d,{fit:"cover",class:"mr-2 h-2.6rem w-2.6rem card-default",loading:"lazy",src:("BaseUrlImg"in o?o.BaseUrlImg:t(pe))+(a==null?void 0:a.image)},null,8,["src"]),M("span",null,X(a==null?void 0:a.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},16,["modelValue","loading"])]),je(o.$slots,"default",{data:t(f)},void 0,!0)])}}}),ct=te(mt,[["__scopeId","data-v-d94657d1"]]),ce="https://jiwu.api.kiwi2333.top/res/",pt=Q({__name:"MdEdit",props:{modelValue:{default:""},pathList:{},uploadImage:{type:Boolean,default:!1},autoSave:{type:Boolean,default:!1}},emits:["update:modelValue","update:pathList","submit"],setup(T,{expose:q,emit:$}){const f=T,s=$,p=Z(),o=I([]);function S(c,g,y){y.forEach(async v=>{if(!v)return;const b=await Je(Ze.IMAGE,p.getToken);b.code===R.SUCCESS?Qe(v,{quality:.6,noCompressIfLarger:!0}).then(C=>{d(C.dist,b.data.key,b.data.uploadToken,()=>{g({url:`${ce}${b.data.key}`,desc:v.name,width:"100%"}),o.value.push(b.data.key),f.autoSave&&E(),s("update:pathList",o.value)})}):B.warning("网络错误，请稍后再试！")})}function d(c,g,y,v){We(c,g,y).subscribe({next(){},error(C){const h=C;h!=null&&h.code?B.error(Xe(h==null?void 0:h.code)):B.error("上传失败，稍后再试！")},complete(){v&&v()}})}const k=I(!1),x=K({get(){return f.modelValue},set(c){s("update:modelValue",c)}});function a(c,g){k.value||c[g]&&fe.confirm("是否删除该图片？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",lockScroll:!1,center:!0,callback:async y=>{var v;if(y==="confirm"){const b=await Ye((v=c[g])==null?void 0:v.replace(ce,""),p.getToken);k.value=!0;const C=new RegExp(`!\\[.*?\\]\\((${c[g]})\\){{{width="100%"}}}`);o.value.splice(o.value.findIndex(h=>h===c[g]),1),s("update:modelValue",f.modelValue.replace(C,"")),s("update:pathList",o.value),b.code===R.SUCCESS?J.success({title:"删除提示",message:"删除成功！"}):(J.closeAll(),B.closeAll("error")),setTimeout(()=>{k.value=!1,f.autoSave&&E()},300)}}})}function E(){k.value||(k.value=!0,s("submit",f.modelValue),setTimeout(()=>{k.value=!1},300))}return q({pathList:()=>o.value}),(c,g)=>{const y=Ge("v-md-editor"),v=ge;return ke((m(),U(y,he(c.$attrs,{modelValue:t(x),"onUpdate:modelValue":g[0]||(g[0]=b=>ae(x)?x.value=b:null),placeholder:"请输入详情","toc-nav-position-right":!0,height:"60vh","disabled-menus":[],"include-level":[2,3,4,5],"left-toolbar":"undo redo clear | italic strikethrough quote | ul ol table hr | link image code | save",onSave:E,onUploadImage:S,onImageClick:a}),null,16,["modelValue"])),[[v,t(k)]])}}}),ft=te(pt,[["__scopeId","data-v-710ed78e"]]),gt={"flex-row-bt-c":"","flex-wrap":""},vt={class:"sticky bottom-1rem z-99 flex-row-bt-c rounded-t-2 p-4 shadow-sm border-default card-default"},_t=Q({__name:"PostForm",props:{cid:{default:""}},emits:["submit"],setup(T,{emit:q}){const $=q;He({massage:"未知状态",icon:"opacity-60",isShow:!1});const f={insert:{massage:"发布成功，等待审核中...⏳",icon:"i-solar:cup-hot-bold-duotone opacity-60",isShow:!0},delete:{massage:"移入回收站成功",icon:"i-solar:check-circle-bold op-60 text-[var(--el-color-danger)]",isShow:!0},recover:{massage:"帖子已被删除或移至回收站，可恢复🔔",icon:"i-solar:adhesive-plaster-broken op-60",isShow:!1}},s=ve(),p=Z(),o=I(!1),S=I(),d=I(),k=I([]),x=s.fullPath,a=de(x,{id:void 0,title:void 0,categoryId:void 0,cover:void 0,content:void 0,images:void 0,tags:void 0},{deep:!0}),E=de(`${s.path}_coverList`,[]),c=K(()=>{var e;const l=(e=d.value)==null?void 0:e.status;return l===D.DELETED||l===D.ADMIN_DELETED||l===D.REJECT}),g=K(()=>{var _;let l="立即发布";const e=(_=d.value)==null?void 0:_.status;return c.value?l="重新发布":e===D.PUBLISHED||e===D.UNDOING?l="确认修改":l="立即发布",l});function y(l){const e=f[l]||{};return $("submit",e)}async function v(l){var _,n,F,O,j;o.value=!0;const e=await tt(l,p.getToken);if(e.code===R.SUCCESS){[D.DELETED,D.ADMIN_DELETED].includes(e.data.status)&&(y("recover"),o.value=!1);const A=((_=e.data.images)==null?void 0:_.split(",").filter(W=>W))||[];a.value={...e.data,images:A,tags:(n=e.data.tags)!=null&&n.trim()?(F=e.data.tags)==null?void 0:F.split(","):[]},d.value={...e.data,images:A,tags:(O=e.data.tags)!=null&&O.trim()?(j=e.data.tags)==null?void 0:j.split(","):[]},a.value.cover&&(E.value=[{file:void 0,id:pe+a.value.cover,status:"success",percent:100,key:a.value.cover}])}else y("recover");o.value=!1}s!=null&&s.query.id?v(String(s.query.id)):P(),s!=null&&s.query.cid&&(a.value.categoryId=String(s.query.cid||"")||"");const b=K(()=>d.value&&!o.value?Object.keys(me(d.value,a.value)).length>0:!1);function C(l,e="insert",_="发布"){var n;o.value||(n=S.value)==null||n.validate(async F=>{F&&fe.confirm(`是否确认${_}？`,{title:"提示",customClass:"text-center",lockScroll:!1,showCancelButton:!0,cancelButtonText:"取 消",confirmButtonText:_,center:!0,callback:async O=>{O==="confirm"&&h(l,e,_)}})})}async function h(l,e="insert",_="发布"){o.value=!0;let n;if(e==="update"&&l)n=await at(l,me(d.value,a.value),p.getToken);else if(e==="insert")n=await ot({...a.value},p.getToken);else if(e==="delete"&&l)n=await st(l,p.getToken);else if(e==="hardDel"&&l)n=await lt(l,p.getToken);else{B.error("未知操作");return}n.code===R.SUCCESS?(J.success({title:"操作提示",message:`${_}成功！`}),e==="insert"?(y("insert"),P()):e==="delete"?(y("delete"),P()):e==="update"&&l&&c.value&&v(l)):J.error({title:"错误提示",message:n.message||`${_}失败，请稍后再试！`}),setTimeout(()=>{o.value=!1},300)}function N(){var l;o.value||(l=S.value)==null||l.validate(async e=>{var _,n;e&&(o.value=!0,(_=d.value)!=null&&_.id?h((n=d.value)==null?void 0:n.id,"update","保存"):B.success("暂存成功！"),o.value=!1)})}function P(){a.value={id:void 0,title:void 0,categoryId:void 0,content:void 0,cover:void 0,images:[],tags:[]},k.value=[],E.value=[]}return(l,e)=>{var oe,se,le,re,ne,ie;const _=Ie,n=$e,F=Pe,O=Fe,j=Oe,A=ct,W=be,we=ye,Se=ft,Ee=xe,Ce=et,z=_e,Ve=ge;return m(),V(H,null,[(m(),U(Ke,null,[ke((m(),U(Ee,{ref_key:"formRef",ref:S,disabled:t(o),"label-position":"top","hide-required-asterisk":"",model:t(a),class:"form"},{default:i(()=>[M("div",gt,[u(n,{prop:"title",rules:[{required:!0,message:"起一个标题吧 ~",trigger:"blur"},{min:5,max:100,message:"长度为5-100字符！",trigger:["change","blur"]}],label:"",class:"title-in order-1 w-1/2"},{default:i(()=>[u(_,{modelValue:t(a).title,"onUpdate:modelValue":e[0]||(e[0]=r=>t(a).title=r),placeholder:"起一个标题吧 ~ ",size:"large",style:{"font-size":"1.4rem"},class:"text w-full font-700"},null,8,["modelValue"])]),_:1}),u(n,{prop:"cover",rules:[{required:!0,message:"请选择封面",trigger:"blur"}],label:"封面",class:"group order-0 ml-a w-full flex md:order-1 md:h-10rem md:w-16rem"},{default:i(()=>[u(F,{key:"inputOssFileUploadRef",modelValue:t(E),"onUpdate:modelValue":e[1]||(e[1]=r=>ae(E)?E.value=r:null),multiple:!1,limit:1,class:"w-full w-full md:w-16rem md:w-auto","input-class":"h-18rem card-default md:h-10rem md:w-16rem w-full mr-2 flex-row-c-c flex-shrink-0","upload-quality":.5,onErrorMsg:e[2]||(e[2]=r=>{("ElMessage"in l?l.ElMessage:t(B)).error(r)}),onSubmit:e[3]||(e[3]=r=>{r&&(t(a).cover=r)})},null,8,["modelValue"])]),_:1})]),u(n,{prop:"categoryId",rules:[{required:!0,message:"圈子不能为空！",trigger:"blur"},{min:10,max:25,message:"长度为10-25字符！",trigger:["change","blur"]}],label:""},{default:i(()=>[u(A,{modelValue:t(a).categoryId,"onUpdate:modelValue":e[5]||(e[5]=r=>t(a).categoryId=r)},{default:i(r=>[r.data?(m(),U(j,{key:0,modelValue:t(a).categoryId,"onUpdate:modelValue":e[4]||(e[4]=w=>t(a).categoryId=w)},{default:i(()=>[(m(!0),V(H,null,Y(r.data,w=>(m(),U(O,{key:w.id,style:{border:"1px solid rgb(255 255 255 / 25.3%)",padding:"0.2rem 0.6rem",margin:"1rem 0.5rem 0 0"},label:w.id,class:"card-defult relative overflow-hidden shadow-sm"},{default:i(()=>[L(X(w.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])):ee("",!0)]),_:1},8,["modelValue"])]),_:1}),u(n,{prop:"tags",rules:[{type:"array",min:0,max:20,message:"最多添加20张标签！",trigger:["change","blur"]}],label:"",class:"round w-fit-content"},{default:i(()=>[u(we,{modelValue:t(a).tags,"onUpdate:modelValue":e[6]||(e[6]=r=>t(a).tags=r),"multiple-limit":20,"max-collapse-tags":4,"collection-tag-class":"border-default card-default",class:"tags-in w-16rem rounded-1rem border-default","collapse-tags-tooltip":!0,filterable:"","collapse-tags":"","allow-create":"",multiple:"","default-first-option":"","tag-effect":"dark","tag-type":"info",teleported:!1,placeholder:"填写文章标签"},{default:i(()=>[(m(!0),V(H,null,Y(t(k),r=>(m(),U(W,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),u(n,{prop:"content",rules:[{required:!0,message:"内容不能为空！",trigger:"blur"},{min:1,max:1024,message:"长度为10-1024字符！",trigger:["change","blur"]}],label:""},{default:i(()=>[u(Se,{"model-value":t(a).content,"onUpdate:modelValue":e[7]||(e[7]=r=>t(a).content=r),"path-list":t(a).images,"onUpdate:pathList":e[8]||(e[8]=r=>t(a).images=r),autofocus:!0,class:"my-2 min-h-50vh w-full",onSubmit:N},null,8,["model-value","path-list"])]),_:1})]),_:1},8,["disabled","model"])),[[Ve,t(o),void 0,{fullscreen:!0}]])],1024)),M("div",vt,[u(Ce,{status:(oe=t(d))==null?void 0:oe.status,size:"large"},null,8,["status"]),(se=t(d))!=null&&se.id&&!t(c)?(m(),U(z,{key:0,disabled:!((le=t(d))!=null&&le.id),class:"group ml-a animate-fade-in-left animate-ease-in-out shadow","icon-class":"i-solar:trash-bin-trash-broken   block  mr-1",type:"danger",plain:"",onClick:e[9]||(e[9]=r=>{var w;return C((w=t(a))==null?void 0:w.id,"delete","移入回收站")})},{default:i(()=>[L(" 回收站  ")]),_:1},8,["disabled"])):(re=t(d))!=null&&re.id&&t(c)?(m(),U(z,{key:1,disabled:!((ne=t(d))!=null&&ne.id),class:"group ml-a animate-fade-in-left animate-ease-in-out shadow","icon-class":"i-solar:trash-bin-trash-broken   block  mr-1",type:"danger",plain:"",onClick:e[10]||(e[10]=r=>{var w;return C((w=t(a))==null?void 0:w.id,"hardDel","彻底删除")})},{default:i(()=>[L(" 彻底删除  ")]),_:1},8,["disabled"])):ee("",!0),u(z,{disabled:t(o)||!t(b),class:"group ml-a animate-fade-in-left animate-ease-in-out shadow","icon-class":"i-solar:inbox-in-bold-duotone   block  mr-1",type:"info",plain:"",onClick:N},{default:i(()=>[L(" 存草稿  ")]),_:1},8,["disabled"]),u(z,{disabled:t(o)||((ie=t(d))==null?void 0:ie.id)&&!t(b),class:"group sticky bottom-0 ml-a animate-fade-in-left animate-ease-in-out shadow","icon-class":"i-solar:map-arrow-right-bold-duotone block  mr-1",type:"info",onClick:e[11]||(e[11]=r=>{var w,ue;return C((w=t(a))==null?void 0:w.id,(ue=t(a))!=null&&ue.id?"update":"insert",t(g))})},{default:i(()=>[L(X(t(g))+"  ",1)]),_:1},8,["disabled"])])],64)}}}),bt=te(_t,[["__scopeId","data-v-af0d7d0b"]]),yt={key:0},ht={key:0,"layout-default-se":""},kt={key:0,"my-6":""},wt={key:1,"my-6":""},St={key:1,class:"h-100vh w-full flex-row-c-c"},Zt=Q({__name:"new",setup(T){const q=ve();Ue({title:()=>{var s;return`${(s=q.query)!=null&&s.id?"修改":"新建"}帖子 - 社区 - 极物圈`},description:"新建帖子 - 社区 - 极物圈 开启你的极物之旅！",keywords:"社区,商城,极物之旅,主页,聊天,客服,购物,home,index,shop,chat"});const $=Z(),f=I();return(s,p)=>{var a;const o=bt,S=_e,d=Le,k=Be,x=qe;return m(),V("div",null,[u(x,{name:"second",footer:!1,header:!((a=t(f))!=null&&a.isShow),menu:["back","home"]},{default:i(()=>[u(k,null,{default:i(()=>{var E,c,g,y,v,b,C;return[(E=t($).userInfo)!=null&&E.id?(m(),V("div",yt,[(c=t(f))!=null&&c.isShow?(m(),V("div",St,[u(d,{msg:(b=t(f))==null?void 0:b.massage,icon:(C=t(f))==null?void 0:C.icon},{footer:i(()=>[u(S,{plain:"",type:"danger","icon-class":"i-solar:alt-arrow-left-line-duotone mr-2",onClick:p[1]||(p[1]=h=>{var N,P,l,e;return("clearError"in s?s.clearError:t(Te))({redirect:(P=(N=s._.provides[G]||s.$route)==null?void 0:N.query)!=null&&P.rollback?(e=(l=s._.provides[G]||s.$route)==null?void 0:l.query)==null?void 0:e.rollback.toString():"/"})})},{default:i(()=>[L(" 返回 ")]),_:1}),u(S,{type:"danger",onClick:p[2]||(p[2]=h=>("navigateTo"in s?s.navigateTo:t(De))("/user/post"))},{default:i(()=>[L(" 我的帖子 ")]),_:1})]),_:1},8,["msg","icon"])])):(m(),V("main",ht,[(y=(g=s._.provides[G]||s.$route)==null?void 0:g.query)!=null&&y.id?(m(),V("h2",wt," 编辑帖子 ✍ ")):(m(),V("h2",kt," 新建帖子 ✍ ")),u(o,{cid:`${((v=(s._.provides[G]||s.$route).query)==null?void 0:v.cid)||""}`,onSubmit:p[0]||(p[0]=h=>f.value=h)},null,8,["cid"])]))])):ee("",!0)]}),_:1})]),_:1},8,["header"])])}}});export{Zt as default};
