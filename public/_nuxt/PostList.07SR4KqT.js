import{_ as K}from"./ElImage.H3VTC2Vd.js";import{_ as Q}from"./nuxt-link.eZ5kOSgI.js";import{u as W,B as D,i as X,n as Y,E as j,d as tt,e as q,f as H,aa as et,w as at,S as ot}from"./entry.HuYbGiLS.js";import{E as st}from"./tag.Q9i6oaRN.js";import{_ as nt}from"./TagList.vue.OYkBucBE.js";import{_ as it}from"./CommentPreview.Y9bM1KWX.js";import{j as Z,k as B,a as $,ao as M,L as r,M as p,N as a,Z as d,a0 as c,u as s,a5 as L,a6 as U,a3 as C,a4 as O,ab as rt,_ as G,ar as J,a9 as S,am as lt,an as dt,r as ct,aa as mt}from"./swiper-vue.4ZhlhtKr.js";import{_ as ut}from"./AutoIncre.vue.KpzenuDu.js";import{m as pt}from"./post.vbJ-6447.js";import"./PreLoading.vue.RcEKquDI.js";import"./debounce.4-I_Xkye.js";import"./select.Bh0wcPP9.js";import"./popper.TZrEXPn8.js";import"./isUndefined.IZwZ21d-.js";import"./scrollbar.ylZGouLy.js";import"./strings.PBHHvk2X.js";import"./isEqual.gU3elsgQ.js";import"./hasIn.gQarB0Dl.js";import"./index.O6n8D2HD.js";import"./OssFileUpload.5SsdOgf4.js";import"./progress.UYU20Rtn.js";import"./index.Rr0j-bh8.js";import"./notification.mMgfY760.js";import"./fetch.3IR0ILJ_.js";const b=_=>(lt("data-v-17dcffa2"),_=_(),dt(),_),_t={"w-full":"",flex:"","grid-gap-2":""},ft={"max-w-20rem":"",flex:"","flex-col":"",truncate:""},gt={"mt-1":"","opacity-60":""},vt={class:"ml-a"},ht=b(()=>a("i",{"i-solar:crown-star-bold":"","mr-1":"","p-0.5em":""},null,-1)),wt={"mt-1":"","border-0":"","border-t-1px":"","pt-3":"","border-default":""},yt={for:"content",class:"truncate"},kt={class:"transition-[all_0.2s] grid grid-cols-2 mt-4 cursor-pointer gap-4 md:grid-cols-5"},$t={class:"grid mt-4 w-full flex grid-gap-2 truncate opacity-70"},Ct={class:"mt-4 w-full flex-row-bt-c"},Tt={class:"link-text"},bt=b(()=>a("i",{class:"i-solar:share-outline mr-1 p-0.5em"},null,-1)),It=b(()=>a("small",null,"分享",-1)),Lt=[bt,It],Bt={flex:""},St=b(()=>a("i",{class:"i-solar:chat-dots-outline mr-1 p-0.5em"},null,-1)),Et=b(()=>a("i",{class:"i-solar:like-outline mr-1 p-0.5em"},null,-1)),Pt={"overflow-hidden":""},xt=Z({__name:"PostLine",props:{data:{},userId:{}},setup(_){const{data:f}=_,i=W(),g=B(()=>{const t=(Date.now()-new Date(f.createTime).getTime())/1e3/60;return t>24?f.createTime:t>60?`${Math.floor(t/60)}小时前`:`${Math.floor(t)}分钟前`}),l=B(()=>{var n;const t=[];return t.push(D+f.cover),f.images&&t.push(...(n=f.images.split(",").filter(m=>m))==null?void 0:n.map(m=>D+m)),t});function y(t){j.warning("该功能未开放！")}function E(t,n){j.warning("该功能未开放！")}function o(t){if(!i.getToken)return i.showLoginForm=!0;t&&t()}const v=$(!1),k=`${location.protocol}/${location==null?void 0:location.host}`;return(t,n)=>{var z;const m=K,h=Q,e=tt,V=st,P=nt,I=q,x=it,N=M("copying"),w=M("auto-animate");return r(),p("div",{class:"group grid grid-gap-2 leading-1.4em",onDblclick:n[3]||(n[3]=u=>("navigateTo"in t?t.navigateTo:s(Y))(`/community/post/detail/${t.data.id}`))},[a("div",_t,[d(h,{to:{path:"/user/info",query:{id:(z=t.data)==null?void 0:z.userId}},class:"flex-row-c-c"},{default:c(()=>{var u,T,A,F,R;return[(T=(u=t.data)==null?void 0:u.user)!=null&&T.avatar?(r(),L(m,{key:0,src:("BaseUrlImg"in t?t.BaseUrlImg:s(D))+((F=(A=t.data)==null?void 0:A.user)==null?void 0:F.avatar),class:"mr-2 h-2.6rem w-2.6rem rounded-1/2 border-default card-default"},null,8,["src"])):U("",!0),a("div",ft,[a("span",null,C((R=t.data)==null?void 0:R.user.nickname),1),a("small",gt,C(s(g)),1)])]}),_:1},8,["to"]),a("div",vt,[d(e,{type:"info",plain:"",round:"",class:"ml-a opacity-0 group-hover:opacity-100","icon-class":"i-tabler:plus mr-2","transition-icon":!0,size:"small",onClick:n[0]||(n[0]=rt(u=>s(i).getTokenFn()&&y(t.userId),["stop"]))},{default:c(()=>[O(" 关注 ")]),_:1}),t.data.isEssence?(r(),L(V,{key:0,class:"font-600 shadow",round:"","ml-2":"",style:{padding:"0.2rem 0.4rem"},type:"warning",effect:"dark"},{default:c(()=>[ht,O(" 精选 ")]),_:1})):U("",!0)])]),a("main",wt,[d(h,{tag:"div",to:`/community/post/detail/${t.data.id}`},{default:c(()=>[a("label",yt,C(t.data.title),1)]),_:1},8,["to"]),a("div",kt,[(r(!0),p(G,null,J(s(l),(u,T)=>(r(),L(m,{key:T,fit:"cover",class:"h-8rem max-w-14rem object-cover border-default card-default",loading:"lazy","preview-teleported":"",src:u,"initial-index":T,"preview-src-list":s(l)},null,8,["src","initial-index","preview-src-list"]))),128))]),a("div",$t,[d(P,{tags:t.data.tags,effect:"light"},null,8,["tags"])]),a("div",Ct,[d(I,null,{default:c(()=>[S((r(),p("span",Tt,Lt)),[[N,`${k}/community/post/detail/${t.data.id}`,void 0,{toast:!0}]])]),_:1}),a("div",Bt,[a("span",{class:"link-text tip-group tip-group ml-4",onClick:n[1]||(n[1]=u=>o(()=>v.value=!s(v)))},[St,a("small",null,C(t.data.comments?`${t.data.comments>99?"99+":t.data.comments}`:"评论"),1)]),a("span",{class:"link-text ml-4",onClick:n[2]||(n[2]=u=>o(()=>E(t.data.id)))},[Et,a("small",null,C(`${t.data.likes>99?"99+":t.data.likes}`),1)])])]),S((r(),p("div",Pt,[d(I,null,{default:c(()=>[s(v)?(r(),L(x,{key:"CardCommentPreview","post-id":t.data.id,limit:10,dto:{isNew:("isTrue"in t?t.isTrue:s(X)).TRUE},class:"mt-4"},null,8,["post-id","dto"])):U("",!0)]),_:1})])),[[w]])])],32)}}}),Nt=H(xt,[["__scopeId","data-v-17dcffa2"]]),Dt={class:"grid grid-gap-6"},Ut=Z({__name:"PostList",props:{dto:{default:()=>({})},limit:{},class:{default:""},immediate:{type:Boolean,default:!0}},setup(_,{expose:f}){const i=_,g=$(!1),l=$([]),y=$(0),E=$(i.limit||10),o=ct({total:-1,pages:-1,current:-1}),v=B(()=>(o==null?void 0:o.total)===0&&o.pages===0),k=B(()=>o.pages>0&&(y.value>=o.pages||i.limit!==void 0&&i.limit<=l.value.length));async function t(){if(g.value||k.value||v.value)return;if(i.limit!==void 0&&l.value.length>=i.limit){g.value=!1;return}g.value=!0,y.value++;const e=await pt(y.value,E.value,i==null?void 0:i.dto);(e==null?void 0:e.code)===ot.SUCCESS&&(o.total=e==null?void 0:e.data.total,o.current=e==null?void 0:e.data.current,o.pages=e==null?void 0:e.data.pages,e!=null&&e.data.records&&(e!=null&&e.data.records.length)&&l.value.push(...e==null?void 0:e.data.records),g.value=!1)}function n(){l.value.splice(0),o.total=-1,o.pages=-1,o.current=-1,y.value=0}const m=et(i.dto),h=$();return at(m,async()=>{h.value||(n(),await t(),h.value=setTimeout(()=>{clearTimeout(h.value),h.value=null},400))},{immediate:i.immediate}),f({clearResult:n,loadPostListPage:t,postList:l,pageInfo:o}),(e,V)=>{const P=Nt,I=ut,x=q,N=M("auto-animate");return r(),p("div",null,[d(x,null,{default:c(()=>[S((r(),p("div",Dt,[d(I,{"loading-class":"mx-a my-0.6em h-1.4rem w-1.4rem animate-[spin_2s_infinite_linear] rounded-6px bg-[var(--el-color-info)]",immediate:e.immediate,loading:s(g),"no-more":s(k)||s(v),onLoad:t},{done:c(()=>[S(a("p",{class:"w-full py-8","text-center":"","text-bluegray":"","tracking-1":""},C(s(k)?"暂无更多帖子":"暂无帖子"),513),[[mt,s(k)||s(v)]])]),default:c(()=>[(r(!0),p(G,null,J(s(l),w=>(r(),p("div",{key:w.id},[d(P,{class:"p-4 transition-300 transition-shadow card-default md:p-6 hover:shadow",data:w,"user-id":w==null?void 0:w.userId},null,8,["data","user-id"])]))),128))]),_:1},8,["immediate","loading","no-more"])])),[[N]])]),_:1})])}}}),ie=H(Ut,[["__scopeId","data-v-4b37e8bc"]]);export{ie as default};
