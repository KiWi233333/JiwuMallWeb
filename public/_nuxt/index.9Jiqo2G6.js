import{gB as ae,aG as se,gm as ne,J as re,M as le,hC as ce,K as ie,N as de,u as j,aH as ue,B as pe,hD as me,c as _e,p as he,d as fe,q as ve,e as H,f as J,n as V,bt as ge,x as be,hE as we}from"./entry.HuYbGiLS.js";import{s as z,a as y,F as xe,j as F,k as ye,L as i,a5 as k,a0 as c,u as e,a2 as ke,X as N,ab as W,Z as p,U as Ee,M as B,a6 as E,ac as Ie,b as Se,ao as R,ai as Ce,_ as Te,ar as Ne,a9 as q,a4 as X,am as G,an as Z,N as m,at as Me}from"./swiper-vue.4ZhlhtKr.js";import{_ as U}from"./nuxt-link.eZ5kOSgI.js";import{_ as Be}from"./Main.vue.pw_WhY3f.js";import{E as $e}from"./scrollbar.ylZGouLy.js";import{_ as Le}from"./ElImage.H3VTC2Vd.js";import{E as Oe}from"./index.Uhk89Gac.js";import{E as Fe}from"./popper.TZrEXPn8.js";/* empty css                */import{M as K}from"./contact.IOrl_V-3.js";import{W as x}from"./useWs.6oZqrKhZ.js";/* empty css                */import"./tag.Q9i6oaRN.js";import"./composables.QNi8Zuou.js";import"./PreLoading.vue.RcEKquDI.js";import"./debounce.4-I_Xkye.js";import"./isUndefined.IZwZ21d-.js";const Pe={visibilityHeight:{type:Number,default:200},target:{type:String,default:""},right:{type:Number,default:40},bottom:{type:Number,default:40}},Ae={click:o=>o instanceof MouseEvent},De=(o,I,t)=>{const a=z(),n=z(),s=y(!1),r=()=>{a.value&&(s.value=a.value.scrollTop>=o.visibilityHeight)},d=_=>{var b;(b=a.value)==null||b.scrollTo({top:0,behavior:"smooth"}),I("click",_)},g=ne(r,300,!0);return ae(n,"scroll",g),xe(()=>{var _;n.value=document,a.value=document.documentElement,o.target&&(a.value=(_=document.querySelector(o.target))!=null?_:void 0,a.value||se(t,`target does not exist: ${o.target}`),n.value=a.value),r()}),{visible:s,handleClick:d}},Q="ElBacktop",Ue=F({name:Q}),Ve=F({...Ue,props:Pe,emits:Ae,setup(o,{emit:I}){const t=o,a=re("backtop"),{handleClick:n,visible:s}=De(t,I,Q),r=ye(()=>({right:`${t.right}px`,bottom:`${t.bottom}px`}));return(d,g)=>(i(),k(Ie,{name:`${e(a).namespace.value}-fade-in`},{default:c(()=>[e(s)?(i(),B("div",{key:0,style:ke(e(r)),class:N(e(a).b()),onClick:g[0]||(g[0]=W((..._)=>e(n)&&e(n)(..._),["stop"]))},[Ee(d.$slots,"default",{},()=>[p(e(le),{class:N(e(a).e("icon"))},{default:c(()=>[p(e(ce))]),_:1},8,["class"])])],6)):E("v-if",!0)]),_:3},8,["name"]))}});var ze=ie(Ve,[["__file","backtop.vue"]]);const Re=de(ze),Y=o=>(G("data-v-8344d7f6"),o=o(),Z(),o),qe=Y(()=>m("div",{class:"mt-3 h-3rem w-3rem flex-row-c-c rounded-1/2 bg-[var(--el-color-primary)] shadow-[#5d33f9] shadow-md shadow-opacity-60"},[m("i",{class:"i-solar:ghost-bold bg-light p-0.8em"})],-1)),Ke={key:0,class:"w-90vw md:w-460px"},je=Y(()=>m("p",{class:"mb-2 text-[var(--el-color-primary)] font-600 tracking-0.2em"},[m("i",{class:"i-solar:ghost-bold mr-2 p-0.8em"}),X(" 极物AI ")],-1)),He={relative:"","w-full":"",flex:"","flex-col":""},Je=F({__name:"AichatBar",setup(o){const I=y(!1),t=j(),a=y({role:"user",content:""}),n=y(x.CLOSE),s=y({ws:null}),r=y({header:{app_id:"3b3875ac",uid:t.userInfo.id},parameter:{chat:{domain:"general",temperature:.8,top_k:4,max_tokens:2028}},payload:{message:{text:[{role:"user",content:""}]}}}),d=y(!1),g=y();function _(){var u;n.value!==x.OPEN&&((u=g.value)==null||u.validate(h=>{h&&(d.value=!0,A(a.value.content,t.userInfo.id),a.value.content="")}))}const b=ue(`ai_chat_${t.userInfo.id}`,[]);y("");function A(u,h){s.value.ws&&s.value.ws.OPEN===1||(b.value.push({fromUser:{userId:t.userInfo.id,avatar:t.userInfo.avatar,gender:t.userInfo.gender,nickName:t.userInfo.nickname},message:{id:Math.random()*1e3,roomId:0,sendTime:new Date().toDateString(),content:u,type:K.TEXT,body:{}}}),s.value.ws=new WebSocket("wss://spark-openapi.cn-huabei-1.xf-yun.com/v1/assistants/u8h3bh6wxkq8_v1"),n.value=x.OPEN,s.value.ws.onopen=M=>{var l;r.value.payload.message.text[0].content=u,r.value.header.uid=h,(l=s.value.ws)==null||l.send(JSON.stringify(r.value)),n.value=x.OPEN},s.value.ws.onclose=()=>{n.value=x.SAFE_CLOSE,s.value.ws=null},s.value.ws.onerror=()=>{n.value=x.CLOSE,s.value.ws=null},s.value.ws.onmessage=M=>{var S,C;const l=JSON.parse(M.data);if(l){n.value=l.header.code;const f=((C=(S=l==null?void 0:l.payload)==null?void 0:S.choices)==null?void 0:C.text)||[];f.value="",f.forEach(v=>{v&&v.role==="assistant"&&(f.value+=v.content)});const T=b.value.find(v=>{var w;return v.message.id===((w=l==null?void 0:l.header)==null?void 0:w.sid)});if(T){T.message.content+=f.value;return}b.value.push({fromUser:{userId:"1739333818150862850",avatar:"image/2023-12-27/1653240351484801026/fab3eab2-e721-4e82-a98f-0bdbdb6e0068",gender:me.DEFAULT,nickName:"极物AI客服"},message:{id:l.header.sid,roomId:0,sendTime:new Date().toDateString(),content:f.value,type:K.TEXT,body:{}}})}n.value=x.CLOSE})}return Se(n,(u,h)=>{u===x.OPEN?d.value=u===x.OPEN:(d.value=!1,s.value.ws=null)}),(u,h)=>{const M=Be,l=$e,S=Le,C=U,f=_e,T=he,v=fe,w=ve,L=Oe,O=H,ee=R("auto-animate"),te=R("auth");return i(),k(O,null,{default:c(()=>[p(L,{placement:"top","shadow-lg":"",teleported:!0,"popper-class":"popover",transition:"fade",trigger:"click","hide-after":0,"popper-style":`width:fit-content; box-shadow:rgba(50, 50, 105, 0.15) 0px 2px 5px 0px, rgba(0, 0, 0, 0.05) 0px 1px 1px 0px;border-radius:6px;\r
      min-height:380px; padding: 1.2em 1em; right: 0;`,tabindex:"0",class:"relative",onKeyup:h[1]||(h[1]=Ce(D=>I.value=!1,["esc"]))},{reference:c(()=>[qe]),default:c(()=>{var D;return[e(t).isLogin?(i(),B("section",Ke,[je,p(l,{"wrap-class":" w-full","view-class":"card-default  h-360px p-2 md:p-4 bg-light darK:bg-dark"},{default:c(()=>[q((i(),B("div",He,[(i(!0),B(Te,null,Ne(e(b),($,oe)=>(i(),k(M,{id:`chat-msg-${$.message.id}`,key:$.message.id,index:oe,data:$},null,8,["id","index","data"]))),128))])),[[ee]])]),_:1}),q((i(),k(w,{ref_key:"formRef",ref:g,model:e(a),disabled:!((D=e(t))!=null&&D.isLogin)||e(d),class:"sticky bottom-0 left-0 mt-2 flex items-center gap-3",onSubmit:W(_,["prevent"])},{default:c(()=>[p(C,{to:"/user/info"},{default:c(()=>[p(S,{src:e(t).userInfo.avatar?("BaseUrlImg"in u?u.BaseUrlImg:e(pe))+e(t).userInfo.avatar:"",class:"h-2.4rem w-2.4rem rounded-1/2 border-default"},null,8,["src"])]),_:1}),p(T,{prop:"content",class:"w-full",rules:[{required:!0,message:"内容不能为空！",trigger:"change"}]},{default:c(()=>[p(f,{modelValue:e(a).content,"onUpdate:modelValue":h[0]||(h[0]=$=>e(a).content=$),modelModifiers:{lazy:!0},disabled:!e(t).isLogin||e(d),placeholder:"快开始对话吧 ✨",class:"content border-0 border-b-1px pt-4 border-default"},null,8,["modelValue","disabled"])]),_:1}),p(v,{class:"group ml-a","icon-class":"i-solar:map-arrow-right-bold-duotone block mr-1",round:"",disabled:!e(t).isLogin||e(d),"transition-icon":"",type:"info",onClick:_},{default:c(()=>[X(" 发送  ")]),_:1},8,["disabled","onClick"])]),_:1},8,["model","disabled"])),[[te]])])):E("",!0)]}),_:1})]),_:1})}}}),We=J(Je,[["__scopeId","data-v-8344d7f6"]]),Xe=Me(()=>be(()=>import("./ShopCartBar.HlQJjN-D.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url).then(o=>o.default||o)),P=o=>(G("data-v-1d1a6995"),o=o(),Z(),o),Ge={id:"right-btns-menu",class:"group btns flex flex-col px-2"},Ze={class:"btn-group flex flex-col justify-end py-3"},Qe=P(()=>m("i",{class:"h-3/5 w-3/5","i-solar:alt-arrow-up-bold":"","text-light":""},null,-1)),Ye=P(()=>m("i",{class:"i-solar:alt-arrow-left-line-duotone h-2/3 w-2/3","mr-0.5":"","text-light":""},null,-1)),et=[Ye],tt=P(()=>m("i",{"i-solar:headphones-round-sound-line-duotone":"","bg-light":"","p-.7em":""},null,-1)),ot=P(()=>m("i",{class:"h-1/2 w-1/2","i-solar:pen-2-bold-duotone":"","text-light":""},null,-1)),at=[ot],st=F({__name:"index",props:{menu:{default:()=>["shopcart","backtop",{name:"service",methods:()=>{V({path:"/chat?type=service"})}},"aichat"]}},setup(o){const{menu:I}=o,t=new Map;I.forEach(r=>{typeof r=="string"?t.set(r,{name:r,iconClass:"",methods:()=>{}}):typeof r=="object"&&t.set(r.name,r)});const a=j(),n=ge();function s(){history.length>1?n.back():V("/")}return(r,d)=>{const g=Re,_=U,b=We,A=Xe,u=Fe,h=U,M=we,l=H;return i(),B("div",null,[p(l,null,{default:c(()=>{var S,C,f,T,v;return[m("div",Ge,[m("div",Ze,[p(g,{key:"backtop",class:N([{btn:!((S=e(t).get("backtop"))!=null&&S.isTeleport)},"btn cursor-pointer rounded-1/2 rounded-1/2 shadow-[#0bdb85] shadow-md shadow-opacity-60 transition-300"]),style:{overflow:"visible",width:"3rem",height:"3rem"}},{default:c(()=>[Qe]),_:1},8,["class"]),e(t).has("back")?(i(),B("span",{key:"back",class:"btn bg-[var(--el-color-primary)] shadow-[var(--el-color-primary)] shadow-md shadow-opacity-40","mt-3":"","h-3rem":"","w-3rem":"","flex-row-c-c":"","cursor-pointer":"","rounded-4em":"","p-1":"","transition-300":"",onClick:s},et)):E("",!0),e(a).getTokenFn()&&e(t).has("service")?(i(),k(_,{key:"service",to:"/chat?type=service",class:N([{btn:!((C=e(t).get("service"))!=null&&C.isTeleport)},"mt-3 h-3rem w-3rem flex-row-c-c cursor-pointer border-2px rounded-1/2 bg-[var(--el-color-info)] shadow-[var(--el-color-info)] shadow-lg transition-300 border-default"])},{default:c(()=>[tt]),_:1},8,["class"])):E("",!0),e(a).getTokenFn()&&e(t).has("aichat")?(i(),k(b,{key:2})):E("",!0),e(a).getTokenFn()&&e(t).has("shopcart")?(i(),k(A,{key:"shopcart",class:"mt-3 h-3rem w-3rem"})):E("",!0),e(t).has("post")&&e(a).getTokenFn()?(i(),k(u,{key:4,placement:"left",content:"新建帖子",class:N({btn:(f=e(t).get("post"))==null?void 0:f.isTeleport}),"popper-class":"singleton-tooltip"},{default:c(()=>[m("span",{key:"post",class:"bg-[var(--el-color-info)] shadow-[var(--el-color-info)] shadow-md shadow-opacity-40","mt-3":"","h-3rem":"","w-3rem":"","flex-row-c-c":"","cursor-pointer":"","rounded-4em":"","p-1":"","transition-300":"",onClick:d[0]||(d[0]=(...w)=>{var L,O;return((L=e(t).get("post"))==null?void 0:L.methods)&&((O=e(t).get("post"))==null?void 0:O.methods(...w))})},at)]),_:1},8,["class"])):E("",!0)]),e(t).has("home")?(i(),k(h,{key:"home",class:N([{btn:(T=e(t).get("home"))==null?void 0:T.isTeleport},"mb-3 h-3rem w-3rem shadow-[var(--el-color-primary)] shadow-md shadow-opacity-40"]),to:"/",style:{"background-color":"var(--el-color-primary)"},"flex-row-c-c":"","rounded-4em":"","p-1":"","transition-300":"",onClick:(v=e(t).get("home"))==null?void 0:v.methods},{default:c(()=>{var w;return[m("i",{class:N(["i-solar:home-smile-outline p-2.6 text-light",((w=e(t).get("home"))==null?void 0:w.iconClass)||""])},null,2)]}),_:1},8,["class","onClick"])):E("",!0),p(M,{class:"fold z-1 h-3rem w-3rem cursor-pointer rounded-1/2 bg-[var(--el-color-primary)] p-3 text-light transition-300 group-hover:-rotate-90",style:{"box-shadow":"1px 1px 6px var(--el-color-primary-light-3)"}})])]}),_:1})])}}}),yt=J(st,[["__scopeId","data-v-1d1a6995"]]);export{yt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./ShopCartBar.HlQJjN-D.js","./checkbox.yoNbs0Nb.js","./swiper-vue.4ZhlhtKr.js","./swiper-vue.CRufKKKm.css","./entry.HuYbGiLS.js","./entry.NyAeeWMW.css","./isEqual.gU3elsgQ.js","./hasIn.gQarB0Dl.js","./flatten.lVx7POvc.js","./checkbox.MJHvI1xB.css","./ShopLine.mVFwCHL6.js","./ElImage.H3VTC2Vd.js","./PreLoading.vue.RcEKquDI.js","./debounce.4-I_Xkye.js","./ElImage.Pw9gT8La.css","./nuxt-link.eZ5kOSgI.js","./select.Bh0wcPP9.js","./popper.TZrEXPn8.js","./isUndefined.IZwZ21d-.js","./popper.nTJkgMH4.css","./scrollbar.ylZGouLy.js","./scrollbar.Smf0pYfu.css","./tag.Q9i6oaRN.js","./tag.WI6po7qa.css","./strings.PBHHvk2X.js","./index.O6n8D2HD.js","./select.AFHHgGgH.css","./input-number.dJQLWHXy.js","./index.RtMxj6Hn.js","./input-number.5AezeF1g.css","./sku.o_NVcctg.js","./fetch.3IR0ILJ_.js","./ShopLine.PGliGu9i.css","./AutoIncre.vue.KpzenuDu.js","./index.Uhk89Gac.js","./useOrderStore._PjEUjF8.js","./index.xV7eTSBk.js","./ShopCartBar.iS6Wm7Is.css","./checkbox-group.d5XbR8TY.css","./popover.LAISAeEG.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
